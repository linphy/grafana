{"version":3,"sources":["../src/space_ctrl.js"],"names":["MetricsPanelCtrl","moment","_","TimeSeries","echarts","$","SpaceDrawer","panelDefaults","kksStart","useCacheData","style","pointIndex","weekIndex","circleR","angelIndex","dataType","barringType","SpaceCtrl","$scope","$injector","$rootScope","templateSrv","templateChange","defaults","panel","basicPanel","sdTitle","xdTitle","waterTitle","sdAmplitude","xdAmplitude","waterdAmplitude","amplitude","options","value","dataTypeOptions","barringTypeOptions","events","on","onInitEditMode","bind","onDataReceived","wahterAmplitude","xdmin","spaceCacheData","xdmax","watermin","watermax","sdmin","sdmax","render","addEditorTab","dataList","targets","target","changeStart","wave_kks","page_name","dashboard","meta","slug","substring","data","length","console","info","scope","elem","attrs","ctrl","obj","find","html","textDiv","promise","getWaveData","then","doDraw","time","waveTime","datasource","undefined","formData","FormData","i","item","push","append","join","kdmUrl","method","linkUser","linkPassword","url","headers","Promise","resolve","reject","getLoginStatus","request","body","relogin","error","myDate","times","fullTime","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","number","index","cirlNumber","drawStyle","space","init","height","draw","templateUrl"],"mappings":"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","file":"space_ctrl.js","sourcesContent":["import {\r\n    MetricsPanelCtrl\r\n}\r\nfrom 'app/plugins/sdk';\r\nimport moment from 'moment';\r\nimport _ from 'lodash';\r\nimport './css/space.css!';\r\nimport TimeSeries from 'app/core/time_series';\r\nimport echarts from 'vendor/echarts/echarts.min.js';\r\nimport $ from 'jquery';\r\nimport SpaceDrawer from './space_drawer.js';\r\n\r\nvar panelDefaults = {\r\n    kksStart: \"EB001HP1\", //KKS索引（枕头坝）\r\n    useCacheData: true, //默认使用缓存，使用数据插件返回的数据\r\n    style: {\r\n        pointIndex: 0, //每周点索引\r\n        weekIndex: 0, //第几周数据索引\r\n        circleR: 45, //半径\r\n        angelIndex: -29, //旋转角度\r\n        dataType: 0, //0：单周轨迹，1： 双周， 2： 1倍频轨迹\r\n        barringType: 0 //0 不盘车 1上导盘车 2下导盘车\r\n    }\r\n}\r\n\r\nexport class SpaceCtrl extends MetricsPanelCtrl {\r\n    constructor($scope, $injector, $rootScope, templateSrv, templateChange) {\r\n        super($scope, $injector);\r\n        this.$rootScope = $rootScope;\r\n        this.templateChange = templateChange;\r\n        _.defaults(this.panel, panelDefaults);\r\n\r\n        //控制右边显示面板信息,用于用户选择盘车，不盘车的操作\r\n        this.basicPanel = true;\r\n        this.sdTitle = true;\r\n        this.xdTitle = true;\r\n        this.waterTitle = true;\r\n        this.sdAmplitude = false;\r\n        this.xdAmplitude = false;\r\n        this.waterdAmplitude = false;\r\n\r\n        this.amplitude = {\r\n            \"sdmin\": 0,\r\n            \"sdmax\": 0,\r\n            \"xdmin\": 0,\r\n            \"xdmax\": 0,\r\n            \"watermin\": 0,\r\n            \"watermax\": 0\r\n        };\r\n\r\n        var options = [{\r\n            \"name\": \"显示\",\r\n            value: true\r\n        }, {\r\n            \"name\": \"隐藏\",\r\n            value: false\r\n        }];\r\n        this.panel.options = options;\r\n\r\n        var dataTypeOptions = [{\r\n            \"name\": \"单周轨迹\",\r\n            value: 0\r\n        }, {\r\n            \"name\": \"多周轨迹\",\r\n            value: 1\r\n        }, {\r\n            \"name\": \"1倍频轨迹\",\r\n            value: 2\r\n        }];\r\n        this.panel.dataTypeOptions = dataTypeOptions;\r\n        this.panel.barringTypeOptions = [\"不盘车\", \"上导盘\", \"下导盘\"];\r\n\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n\r\n        this.panel.useCacheData = true;\r\n    }\r\n\r\n    pancheTypeChange(barringType) {\r\n        if (this.panel.style.barringType == 0) //不盘车\r\n        {\r\n            this.basicPanel = true;\r\n            this.sdTitle = true;\r\n            this.xdTitle = true;\r\n            this.waterTitle = true;\r\n            this.sdAmplitude = false;\r\n            this.xdAmplitude = false;\r\n            this.wahterAmplitude = false;\r\n        } else if (this.panel.style.barringType == 1) {\r\n            this.amplitude.xdmin = this.spaceCacheData.amplitude[0];\r\n            this.amplitude.xdmax = this.spaceCacheData.amplitude[1];\r\n            this.amplitude.watermin = this.spaceCacheData.amplitude[2];\r\n            this.amplitude.watermax = this.spaceCacheData.amplitude[3];\r\n            this.basicPanel = false;\r\n            this.sdTitle = false;\r\n            this.sdAmplitude = false;\r\n\r\n            this.xdTitle = true;\r\n            this.xdAmplitude = true;\r\n            this.waterTitle = true;\r\n            this.wahterAmplitude = true;\r\n        } else {\r\n            this.amplitude.sdmin = this.spaceCacheData.amplitude[4];\r\n            this.amplitude.sdmax = this.spaceCacheData.amplitude[5];\r\n            this.amplitude.watermin = this.spaceCacheData.amplitude[6];\r\n            this.amplitude.watermax = this.spaceCacheData.amplitude[7];\r\n            this.basicPanel = false;\r\n\r\n            this.sdTitle = true;\r\n            this.sdAmplitude = true;\r\n            this.xdTitle = false;\r\n            this.xdAmplitude = false;\r\n            this.waterTitle = true;\r\n            this.wahterAmplitude = true;\r\n        }\r\n        this.render();\r\n    }\r\n\r\n    onInitEditMode() {\r\n        this.addEditorTab('Options',\r\n            'public/plugins/oge-kdm-space/editor.html', 2);\r\n    }\r\n\r\n    onDataReceived(dataList) {\r\n        this.panel.kksStart = this.panel.targets[0].target;\r\n\r\n        //1、模板替换\r\n        this.panel.kksStart = this.templateChange.changeStart(this.panel.kksStart);\r\n\r\n        //2、根据kks规则，改变kksStart，主要是再次请求\r\n        if (this.templateSrv.wave_kks && this.templateSrv.page_name == this.dashboard.meta.slug) {\r\n            this.panel.kksStart = this.templateSrv.wave_kks[0].substring(0, 8);\r\n        }\r\n\r\n        if (dataList == null || dataList.data == \"error\" || dataList.length == 0) {\r\n            console.info(\"没有查询到有效数据\");\r\n            return;\r\n        }\r\n        this.spaceCacheData = dataList;\r\n        this.panel.useCacheData = true;\r\n        this.render();\r\n    }\r\n\r\n    onRender() {\r\n\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl) {\r\n        ctrl.events.on('render', () => {\r\n            var obj = elem.find('.data-panel');\r\n            obj.html(\"\");\r\n            var textDiv = elem.find('.text-panel');\r\n            textDiv.html(\"\");\r\n\r\n            if (!ctrl.panel.useCacheData || !ctrl.spaceCacheData) {\r\n                var promise = ctrl.getWaveData(ctrl.panel.style.weekIndex);\r\n                promise.then(data => {\r\n                    ctrl.spaceCacheData = data;\r\n                    if (data)\r\n                        this.doDraw(ctrl, obj);\r\n                });\r\n\r\n            } else if (ctrl.spaceCacheData)\r\n                this.doDraw(ctrl, obj);\r\n\r\n        });\r\n    }\r\n\r\n    getWaveData(dataType) {\r\n\r\n        var time;\r\n        if (this.spaceCacheData && this.spaceCacheData.waveTime) {\r\n            time = this.spaceCacheData.waveTime;\r\n        }\r\n        if (!this.datasource && !time)\r\n            return undefined;\r\n\r\n        var formData = new FormData();\r\n        var targets = [];\r\n        if (this.panel.targets && this.panel.targets.length > 1) {\r\n            for (var i = 0; i < this.panel.targets.length; i++) {\r\n                const item = this.panel.targets[i];\r\n                targets.push(item.target);\r\n            }\r\n        }\r\n        formData.append(\"kksStart\", targets.length == 0 ? this.panel.kksStart : targets.join(\",\"))\r\n        formData.append(\"waveTime\", time)\r\n        formData.append(\"cycleType\", dataType)\r\n        formData.append(\"kdmUrl\", this.datasource.kdmUrl)\r\n        var options = {\r\n            method: 'POST',\r\n            data: formData\r\n        };\r\n\r\n        //如果连接的数据源地址为KDM Link地址\r\n        if (this.datasource.linkUser && this.datasource.linkPassword) {\r\n            options.url = this.datasource.url + '/rest/v1/data-points/wave/getSpace';\r\n            options.headers = {\r\n                'Content-Type': undefined,\r\n            };\r\n        } else\r\n            options.url = this.datasource.url + '/wave/getSpace';\r\n\r\n        var promise = new Promise((resolve, reject) => {\r\n\r\n            this.datasource.getLoginStatus().then(data => {\r\n\r\n                this.datasource.request(options).then(body => {\r\n                    resolve(body.data);\r\n                }, error => {\r\n                    this.datasource.relogin(error, options).then(data => resolve(data.body), error => reject(error));\r\n                });\r\n            })\r\n\r\n        });\r\n        return promise;\r\n    }\r\n\r\n    getTimesByLongTime(myDate) {\r\n        var times = this.fullTime(myDate.getFullYear());\r\n        times += \"-\" + this.fullTime(myDate.getMonth() + 1);\r\n        times += \"-\" + this.fullTime(myDate.getDate());\r\n        times += \" \" + this.fullTime(myDate.getHours());\r\n        times += \":\" + this.fullTime(myDate.getMinutes());\r\n        times += \":\" + this.fullTime(myDate.getSeconds());\r\n        return times;\r\n    }\r\n\r\n    fullTime(number) {\r\n        if (number < 10) {\r\n            return \"0\" + number;\r\n        } else {\r\n            return number;\r\n        }\r\n    }\r\n\r\n    changeStyle(index) {\r\n        if (index == 0) {\r\n            this.panel.style.pointIndex++; //上一点\r\n        } else if (index == 1) {\r\n            this.panel.style.pointIndex--; //下一点\r\n        } else if (index == 2) {\r\n            this.panel.style.weekIndex++; //上一周\r\n        } else if (index == 3) {\r\n            this.panel.style.weekIndex--; //下一周\r\n        } else if (index == 4) {\r\n            this.panel.style.circleR = this.panel.style.circleR + 5; //\r\n        } else if (index == 5) {\r\n            this.panel.style.circleR = this.panel.style.circleR - 5; //缩小\r\n            if (this.panel.style.circleR <= 5) {\r\n                this.panel.style.circleR = 5; //最小\r\n            }\r\n        } else if (index == 6) {\r\n            this.panel.style.angelIndex++; //左旋转\r\n        } else if (index == 7) {\r\n            this.panel.style.angelIndex--; //右旋转\r\n        }\r\n\r\n        if (index == 2 || index == 3) {\r\n            this.panel.useCacheData = false;\r\n        } else {\r\n            this.panel.useCacheData = true;\r\n        }\r\n        this.render();\r\n    }\r\n\r\n\r\n\r\n    doDraw(ctrl, obj) {\r\n        //1、处理边缘样式 ： 每周点索引\r\n        if (ctrl.panel.style.pointIndex == -1) {\r\n            ctrl.panel.style.pointIndex = 255; //数据长度固定256\r\n        }\r\n        if (ctrl.panel.style.pointIndex == 256) {\r\n            ctrl.panel.style.pointIndex = 0; //数据长度固定256\r\n        }\r\n\r\n        //2、处理边缘样式 ： 周索引\r\n        var cirlNumber = ctrl.spaceCacheData.length;\r\n        if (ctrl.panel.style.weekIndex == -1) {\r\n            ctrl.panel.style.weekIndex = cirlNumber - 1;\r\n        }\r\n        if (ctrl.panel.style.weekIndex == cirlNumber) {\r\n            ctrl.panel.style.weekIndex = 0;\r\n        }\r\n\r\n        //3、绘图\r\n        ctrl.spaceCacheData.drawStyle = ctrl.panel.style;\r\n\r\n        var space = new SpaceDrawer();\r\n        space.init(obj[0], ctrl.height);\r\n\r\n        if (ctrl.panel.style.barringType == 0) //不盘车\r\n        {\r\n            space.draw(ctrl.spaceCacheData, ctrl.spaceCacheData.drawStyle, -1, 1, 2);\r\n        } else if (ctrl.panel.style.barringType == 1) //上导\r\n        {\r\n            space.draw(ctrl.spaceCacheData, ctrl.spaceCacheData.drawStyle, 0, 1, 2);\r\n        } else if (ctrl.panel.style.barringType == 2) //下导\r\n        {\r\n            space.draw(ctrl.spaceCacheData, ctrl.spaceCacheData.drawStyle, 1, 0, 2);\r\n        }\r\n        ctrl.panel.useCacheData = false;\r\n    }\r\n}\r\n\r\nSpaceCtrl.templateUrl = 'module.html';\r\n"]}