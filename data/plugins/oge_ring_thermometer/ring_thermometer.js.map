{"version":3,"sources":["../../src/ring_thermometer.js"],"names":["MetricsPanelCtrl","moment","_","TimeSeries","echarts","$","panelDefaults","min","max","dataPrecise","unit","colors","threshold","RingThermometerPanelCtrl","$scope","$injector","$rootScope","defaults","panel","events","on","onInitEditMode","bind","onDataReceived","addEditorTab","dataList","data","render","Object","prototype","toString","call","datapoints","length","CO","DP","num","fixedData","toFixed","Fdata","value","precise","ref","copy","scope","elem","attrs","ctrl","obj","find","fixed","height","row","isString","parseInt","replace","css","FD","str","split","j","push","percents","TfontSize","SfontSize","textColor","percent","color2","getData","itemStyle","normal","color","shadowBlur","shadowColor","myChart","init","option","title","text","x","y","itemGap","subtext","subtextStyle","fontSize","textStyle","fontWeight","series","type","radius","silent","label","show","animation","name","setOption","templateUrl"],"mappings":"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","file":"ring_thermometer.js","sourcesContent":["import {\r\n\tMetricsPanelCtrl\r\n} from 'app/plugins/sdk';\r\nimport moment from 'moment';\r\nimport _ from 'lodash';\r\nimport TimeSeries from 'app/core/time_series';\r\nimport './css/clock-panel.css!';\r\nimport echarts from 'vendor/echarts/echarts.min.js';\r\nimport $ from 'jquery';\r\n\r\nvar panelDefaults = {\r\n\tmin: 0,\r\n\tmax: 100,\r\n\tdataPrecise: 0,\r\n\tunit: \"℃\",\r\n\tcolors: [\"rgba(50, 172, 45, 0.97)\", \"rgba(237, 129, 40, 0.89)\", \"rgba(245, 54, 54, 0.9)\"],\r\n\tthreshold: '30,60'\r\n};\r\nexport class RingThermometerPanelCtrl extends MetricsPanelCtrl {\r\n\tconstructor($scope, $injector, $rootScope) {\r\n\t\tsuper($scope, $injector);\r\n\t\tthis.$rootScope = $rootScope;\r\n\t\t_.defaults(this.panel, panelDefaults); //将panelDefaults属性附加到this.panel上\t\t\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t}\r\n\tonInitEditMode() {\r\n\t\tthis.addEditorTab('Options', 'public/plugins/oge_ring_thermometer/editor.html', 2);\r\n\t}\r\n\tonDataReceived(dataList) {\r\n\t\tthis.data = dataList;\r\n\t\tthis.render();\r\n\r\n\t}\r\n\tfixed() {\r\n\t\tif (Object.prototype.toString.call(this.data) === '[object Array]') {\r\n\t\t\tif (this.data[0].datapoints.length == 0) {\r\n\t\t\t\tthis.panel.CO = \"red\"\r\n\t\t\t} else {\r\n\t\t\t\tvar DP = this.data[0].datapoints;\r\n\t\t\t\tvar num = this.data[0].datapoints[DP.length-1][0];\r\n\t\t\t\tvar fixedData = num.toFixed(this.panel.dataPrecise);\r\n\t\t\t\tthis.data.Fdata = fixedData;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar num = this.data.value;\r\n\t\t\tif (this.data.precise == null) {\r\n\t\t\t\tvar fixedData = num.toFixed(this.panel.dataPrecise);\r\n\t\t\t} else {\r\n\t\t\t\tvar fixedData = num.toFixed(this.data.precise);\r\n\t\t\t}\r\n\t\t\tthis.data.Fdata = fixedData;\r\n\t\t}\r\n\t}\r\n\tonRender() {\r\n\r\n\t}\r\n\tinvertColorOrder() {\r\n\t\tvar ref = this.panel.colors;\r\n\t\tvar copy = ref[0];\r\n\t\tref[0] = ref[2];\r\n\t\tref[2] = copy;\r\n\t}\r\n\tlink(scope, elem, attrs, ctrl) {\r\n\t\tctrl.events.on('render', function() {\r\n\t\t\tvar obj = elem.find('.ring-thermometer-panel');\r\n\t\t\tctrl.fixed();\r\n\t\t\tvar height = ctrl.height || ctrl.row.height;\r\n\t\t\tif (_.isString(height)) {\r\n\t\t\t\theight = parseInt(height.replace('px', ''), 10);\r\n\t\t\t}\r\n\t\t\tobj.css('height', height + 'px');\r\n\t\t\tctrl.data.FD = parseInt(ctrl.data.Fdata, 10);\r\n\t\t\tctrl.data.threshold = [];\r\n\t\t\tif (ctrl.panel.threshold == null) {\r\n\t\t\t\tctrl.data.threshold = []\r\n\t\t\t} else {\r\n\t\t\t\tvar str = ctrl.panel.threshold.split(\",\");\r\n\t\t\t\tfor (var j = 0; j < 3; j++) {\r\n\t\t\t\t\tctrl.data.threshold.push(parseInt(str[j]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (ctrl.data.FD < ctrl.data.threshold[0]) {\r\n\t\t\t\tctrl.panel.CO = ctrl.panel.colors[0]\r\n\t\t\t} else if (ctrl.panel.threshold[0] <= ctrl.data.FD && ctrl.data.FD < ctrl.data.threshold[1]) {\r\n\t\t\t\tctrl.panel.CO = ctrl.panel.colors[1]\r\n\t\t\t} else if (ctrl.data.threshold[1] <= ctrl.data.FD) {\r\n\t\t\t\tctrl.panel.CO = ctrl.panel.colors[2]\r\n\t\t\t}\r\n\t\t\tvar percents = ctrl.data.Fdata;\r\n\t\t\tvar TfontSize = (height * 0.13);\r\n\t\t\tvar SfontSize = (height * 0.08);\r\n\t\t\tvar textColor = '#98a0c4';\r\n\t\t\tif (ctrl.panel.unit ==null){\r\n\t\t\t\tvar unit = null \r\n\t\t\t}else{\r\n\t\t\t\tvar unit = ctrl.panel.unit;\r\n\t\t\t}\r\n\t\t\tvar max = ctrl.panel.max;\r\n\t\t\tvar min = ctrl.panel.min;\r\n\t\t\tvar value = max - percents;\r\n\t\t\tvar percent = percents - min;\r\n\t\t\tvar color2 = '#888';\r\n\r\n\t\t\tfunction getData() {\r\n\t\t\t\treturn [{\r\n\t\t\t\t\tvalue: percent,\r\n\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\tcolor: ctrl.panel.CO, //外环颜色\r\n\t\t\t\t\t\t\tshadowBlur: 5,\r\n\t\t\t\t\t\t\tshadowColor: ctrl.panel.CO,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}, {\r\n\t\t\t\t\tvalue: value,\r\n\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\tcolor: 'transparent' //透明部分\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}];\r\n\t\t\t}\r\n\t\t\tvar myChart = echarts.init(obj[0]);\r\n\t\t\tvar option = {\r\n\t\t\t\t//backgroundColor: 'while',\r\n\r\n\t\t\t\ttitle: {\r\n\t\t\t\t\ttext: percent + unit, //值的大小\r\n\t\t\t\t\tx: 'center',\r\n\t\t\t\t\ty: 'center',\r\n\t\t\t\t\titemGap: 1,\r\n\t\t\t\t\tsubtext: 'max:' + max + '\\n' + 'min:' + min,\r\n\t\t\t\t\tsubtextStyle: {\r\n\t\t\t\t\t\tfontSize: SfontSize,\r\n\t\t\t\t\t},\r\n\t\t\t\t\ttextStyle: {\r\n\t\t\t\t\t\tcolor: textColor, //中间字体颜色\r\n\t\t\t\t\t\tfontWeight: 'bolder', //中间字体风格\r\n\t\t\t\t\t\tfontSize: TfontSize, //中间字体大小\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tseries: [{\r\n\t\t\t\t\t\ttype: 'pie',\r\n\t\t\t\t\t\tradius: ['50%', '50%'],\r\n\t\t\t\t\t\tsilent: true,\r\n\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\t\tshow: false,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tanimation: false\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: 'pie',\r\n\t\t\t\t\t\tradius: ['55%', '75%'], //[内环空心据远点距离，外环剧远点距离]\r\n\t\t\t\t\t\tsilent: true,\r\n\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\t\tshow: false,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tdata: [{\r\n\t\t\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\t\t\tcolor: color2, //圆环颜色\r\n\t\t\t\t\t\t\t\t\tshadowBlur: 50, //阴影宽度\r\n\t\t\t\t\t\t\t\t\tshadowColor: color2 //阴影颜色\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}], //黑圆环\r\n\r\n\t\t\t\t\t\tanimation: false //圆环动画,默认开启，所以需要取消\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: 'main',\r\n\t\t\t\t\t\ttype: 'pie',\r\n\t\t\t\t\t\tradius: ['75%', '85%'],\r\n\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\t\tshow: false,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tdata: getData(),\r\n\t\t\t\t\t} //外层圆环\r\n\t\t\t\t]\r\n\t\t\t};\r\n\r\n\t\t\t// 使用刚指定的配置项和数据显示图表。\r\n\t\t\tmyChart.setOption(option);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nRingThermometerPanelCtrl.templateUrl = 'module.html';"]}