{"version":3,"sources":["../../src/statelist.js"],"names":["MetricsPanelCtrl","moment","_","TimeSeries","echarts","$","panelDefaults","defaultColor","threshold","sizecolor","stateListPanelCtrl","$scope","$injector","$rootScope","defaults","panel","length","push","thresholds","colors","name","events","on","onInitEditMode","bind","onDataReceived","addEditorTab","dataList","data","render","Object","prototype","toString","call","datapoints","DP","num","fixedData","toFixed","dataPrecise","Fdata","value","precise","index","splice","everyHeight","scope","elem","attrs","ctrl","obj","find","fixed","height","row","isString","parseInt","replace","css","i","FD","str","split","thresholdss","j","Number","CO","templateUrl"],"mappings":"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","file":"statelist.js","sourcesContent":["import {\r\n\tMetricsPanelCtrl\r\n} from 'app/plugins/sdk';\r\nimport moment from 'moment';\r\nimport _ from 'lodash';\r\nimport TimeSeries from 'app/core/time_series';\r\nimport echarts from 'vendor/echarts/echarts.min.js';\r\nimport $ from 'jquery';\r\n\r\nvar panelDefaults = {\r\n\tdefaultColor: 'rgba(117, 117, 117,0.3)',\r\n\tthreshold:[],\r\n\tsizecolor:'rgba(0, 0, 0, 0.96)',\r\n};\r\nexport class stateListPanelCtrl extends MetricsPanelCtrl {\r\n\tconstructor($scope, $injector, $rootScope) {\r\n\t\tsuper($scope, $injector);\r\n\t\tthis.$rootScope = $rootScope;\r\n\t\t_.defaults(this.panel, panelDefaults); //将panelDefaults属性附加到this.panel上\r\n\t\tif(this.panel.threshold.length == 0){\r\n\t\tthis.panel.threshold.push({ thresholds: '30,60', colors: this.panel.defaultColor, name: '未定义' });\r\n\t\t}\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t}\r\n\tonInitEditMode() {\r\n\t\tthis.addEditorTab('Options', 'public/plugins/oge_statelist/editor.html', 2);\r\n\t}\r\n\tonDataReceived(dataList) {\r\n\t\tthis.data = dataList;\r\n\t\tthis.render();\r\n\r\n\t}\r\n\tfixed() {\r\n\t\tif (Object.prototype.toString.call(this.data) === '[object Array]') {\r\n\t\t\tif (this.data[0].datapoints.length == 0) {\r\n\t\t\t} else {\r\n\t\t\t\tvar DP = this.data[0].datapoints;\r\n\t\t\t\tvar num = this.data[0].datapoints[DP.length-1][0];\r\n\t\t\t\tvar fixedData = num.toFixed(this.panel.dataPrecise);\r\n\t\t\t\tthis.data.Fdata = fixedData;\r\n\t\t\t}\r\n\t\t} else if (this.data.value == null) {\r\n\t\t\treturn\r\n\t\t} else {\r\n\t\t\tvar num = this.data.value;\r\n\t\t\tif (this.data.precise == null) {\r\n\t\t\t\tvar fixedData = num.toFixed(this.panel.dataPrecise);\r\n\t\t\t} else {\r\n\t\t\t\tvar fixedData = num.toFixed(this.data.precise);\r\n\t\t\t}\r\n\t\t\tthis.data.Fdata = fixedData;\r\n\t\t}\r\n\t}\r\n\tonRender() {}\r\n\tonDelete(index) {\r\n    this.panel.threshold.splice(index,1);\r\n    this.render()\r\n\t}\r\n\tonAdd() {\r\n    this.panel.threshold.push({ thresholds: '30,60', colors:this.panel.defaultColor, name: '未定义' ,everyHeight: '25px'});\r\n    this.render()\r\n  }\r\n\r\n\tlink(scope, elem, attrs, ctrl) {\r\n\t\tctrl.events.on('render', function() {\r\n\t\t\tvar obj = elem.find('.stateList-panel');\r\n\t\t\tctrl.fixed();\r\n\t\t\tvar height = ctrl.height || ctrl.row.height;\r\n\t\t\tif (_.isString(height)) {\r\n\t\t\t\theight = parseInt(height.replace('px', ''), 10);\r\n\t\t\t}\r\n\t\t\tobj.css('height', height + 'px');\r\n\t\t\tvar everyHeight = height/ctrl.panel.threshold.length - 5 + 'px';\t\t\t\r\n            for (var i = 0; i < ctrl.panel.threshold.length; i++) {\t\t\t\t\r\n\t\t\t\tctrl.data.FD = parseInt(ctrl.data.Fdata, 10);\r\n\t            if (ctrl.panel.threshold[i].thresholds == null) {\r\n\t\t\t\t\treturn\r\n\t            } else {\r\n\t            \tvar str = ctrl.panel.threshold[i].thresholds.split(\",\");\r\n\t\t\t\t\tctrl.panel.threshold[i].thresholdss=[];\r\n\t                for (var j = 0; j < 2; j++) {\r\n\t                    ctrl.panel.threshold[i].thresholdss.push(Number(str[j]));\r\n\t                }\r\n\t            }\r\n\t            ctrl.panel.threshold[i].everyHeight = everyHeight;\r\n\t\t\t\tctrl.panel.threshold[i].CO='';\r\n\t\t\t\tif(ctrl.panel.threshold[i].thresholdss[0]<=ctrl.data.FD && ctrl.data.FD < ctrl.panel.threshold[i].thresholdss[1]){\r\n\t\t\t\t\tctrl.panel.threshold[i].CO = ctrl.panel.threshold[i].colors;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctrl.panel.threshold[i].CO = ctrl.panel.defaultColor\r\n\t\t\t\t}\r\n            }\r\n\r\n\t\t});\r\n\t}\r\n}\r\n\r\nstateListPanelCtrl.templateUrl = 'module.html';"]}