{"version":3,"sources":["../../src/liquidfill.js"],"names":["MetricsPanelCtrl","moment","_","TimeSeries","echarts","liquidFill","$","panelDefaults","min","max","dataPrecise","defaultColor","unit","colors","fontSizes","shapes","bgcolors","names","liquidDillPanelCtrl","$scope","$injector","$rootScope","defaults","panel","shapesOption","name","value","events","on","onInitEditMode","bind","onDataReceived","addEditorTab","dataList","data","render","Object","prototype","toString","call","datapoints","length","CO","DP","num","fixedData","toFixed","Fdata","precise","reverse","push","pop","scope","elem","attrs","ctrl","obj","find","fixed","height","row","isString","parseInt","replace","css","myChart","init","a","b","c","d","e","option","series","type","radius","color","shape","waveAnimation","label","normal","formatter","textStyle","fontSize","backgroundStyle","setOption","templateUrl"],"mappings":"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","file":"liquidfill.js","sourcesContent":["import {\r\n\tMetricsPanelCtrl\r\n} from 'app/plugins/sdk';\r\nimport moment from 'moment';\r\nimport _ from 'lodash';\r\nimport TimeSeries from 'app/core/time_series';\r\nimport echarts from 'echarts';\r\nimport liquidFill from 'vendor/echarts/echarts-liquidfill.js';\r\nimport $ from 'jquery';\r\n\r\nvar panelDefaults = {\r\n\tmin: 0,\r\n\tmax: 100,\r\n\tdataPrecise: 0,\r\n\tdefaultColor: 'rgba(0, 0, 0, 0.5)',\r\n\tunit: \"m\",\r\n\tcolors: ['rgba(253,238,199,0.9)', 'rgba(121,159,162,0.9)', 'rgba(40,37,54,0.9)'],\r\n\tfontSizes: 40,\r\n\tshapes: 'circle',\r\n\tbgcolors: 'rgba(255, 255, 255, 0.9)',\r\n\tnames: '水位',\r\n};\r\nexport class liquidDillPanelCtrl extends MetricsPanelCtrl {\r\n\tconstructor($scope, $injector, $rootScope) {\r\n\t\tsuper($scope, $injector);\r\n\t\tthis.$rootScope = $rootScope;\r\n\t\t_.defaults(this.panel, panelDefaults); //将panelDefaults属性附加到this.panel上\t\r\n\t\tvar shapesOption = [{\r\n\t\t\tname: '圆形',\r\n\t\t\tvalue: 'circle'\r\n\t\t}, {\r\n\t\t\tname: '菱形',\r\n\t\t\tvalue: 'diamond'\r\n\t\t}, {\r\n\t\t\tname: '矩形',\r\n\t\t\tvalue: 'rect'\r\n\t\t}, {\r\n\t\t\tname: '圆矩',\r\n\t\t\tvalue: 'roundRect'\r\n\t\t}, {\r\n\t\t\tname: '针形',\r\n\t\t\tvalue: 'pin'\r\n\t\t}];\r\n\t\tthis.panel.shapesOption = shapesOption;\r\n\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t}\r\n\tonInitEditMode() {\r\n\t\tthis.addEditorTab('Options', 'public/plugins/oge_liquidfill/editor.html', 2);\r\n\t}\r\n\tonDataReceived(dataList) {\r\n\t\tthis.data = dataList;\r\n\t\tthis.render();\r\n\t}\r\n\tfixed() {\r\n\t\tif (Object.prototype.toString.call(this.data) === '[object Array]') {\r\n\t\t\tif (this.data[0].datapoints.length == 0) {\r\n\t\t\t\tthis.panel.CO = \"red\"\r\n\t\t\t} else {\r\n\t\t\t\tvar DP = this.data[0].datapoints;\r\n\t\t\t\tvar num = this.data[0].datapoints[DP.length-1][0];\r\n\t\t\t\tvar fixedData = num.toFixed(this.panel.dataPrecise);\r\n\t\t\t\tthis.data.Fdata = fixedData;\r\n\t\t\t}\r\n\t\t} else if (this.data.value == null) {\r\n\t\t\treturn\r\n\t\t} else {\r\n\t\t\tvar num = this.data.value;\r\n\t\t\tif (this.data.precise == null) {\r\n\t\t\t\tvar fixedData = num.toFixed(this.panel.dataPrecise);\r\n\t\t\t} else {\r\n\t\t\t\tvar fixedData = num.toFixed(this.data.precise);\r\n\t\t\t}\r\n\t\t\tthis.data.Fdata = fixedData;\r\n\t\t}\r\n\t}\r\n\tonRender() {\r\n\r\n\t}\r\n\r\n\tinvertColorOrder() {\r\n\t\tthis.panel.colors.reverse() //颠倒数组中元素顺序\r\n\t}\r\n\tonEditorAddColors() {\r\n\t\tthis.panel.colors.push(this.panel.defaultColor); // 添加默认颜色到Color数组\r\n\t\tthis.render()\r\n\t}\r\n\r\n\tonEditorDeleteColors() {\r\n\t\tthis.panel.colors.pop(); //删除Color数组的最后一条\r\n\t\tthis.render()\r\n\t}\r\n\tlink(scope, elem, attrs, ctrl) {\r\n\t\tctrl.events.on('render', function() {\r\n\t\t\tvar obj = elem.find('.liquidfill-panel');\r\n\t\t\tctrl.fixed();\r\n\t\t\tvar height = ctrl.height || ctrl.row.height;\r\n\t\t\tif (_.isString(height)) {\r\n\t\t\t\theight = parseInt(height.replace('px', ''), 10);\r\n\t\t\t}\r\n\t\t\tobj.css('height', height + 'px');\r\n\t\t\tvar myChart = echarts.init(obj[0]);\r\n\t\t\tvar a = ctrl.data.Fdata / (ctrl.panel.max - ctrl.panel.min);\r\n\t\t\tvar b = a * 0.9;\r\n\t\t\tvar c = b * 0.9;\r\n\t\t\tvar d = c * 0.9;\r\n\t\t\tvar e = d * 0.9;\r\n\t\t\tvar option = {\r\n\t\t\t\tseries: [{\r\n\t\t\t\t\ttype: 'liquidFill',\r\n\t\t\t\t\tdata: [a, b, c, d, e], //波浪高度：中心文字默认展示第一个值\r\n\t\t\t\t\tradius: '90%',\r\n\t\t\t\t\tcolor: ctrl.panel.colors, //波浪颜色，值比颜色多时会自动循环\r\n\t\t\t\t\tshape: ctrl.panel.shapes, //水球图内置颜色roundRect diamond roundRect\r\n\t\t\t\t\twaveAnimation: true, //左右波动，默认波动为true40,37,54\r\n\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\tformatter: ctrl.panel.names + '\\n' + ctrl.data.Fdata + ctrl.panel.unit, //中心文字，默认为百分比\r\n\t\t\t\t\t\t\ttextStyle: {\r\n\t\t\t\t\t\t\t\tfontSize: ctrl.panel.fontSizes,\r\n\t\t\t\t\t\t\t\t//color: '#D94854'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbackgroundStyle: {\r\n\t\t\t\t\t\tcolor: ctrl.panel.bgcolors, //背景颜色\r\n\t\t\t\t\t}\r\n\t\t\t\t}]\r\n\t\t\t};\r\n\t\t\t// 使用刚指定的配置项和数据显示图表。\r\n\t\t\tmyChart.setOption(option);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nliquidDillPanelCtrl.templateUrl = 'module.html';"]}