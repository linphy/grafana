{"version":3,"sources":["../../src/graph_ctrl.js"],"names":["MetricsPanelCtrl","moment","_","TimeSeries","$","panelDefaults","precise","color","valueSize","fontSize","timeSize","showName","EchartsCtrl","$scope","$injector","$rootScope","console","info","defaults","panel","modeOption","name","value","preciseOption","valueSizeOption","fontSizeOption","timeSizeOption","colorOption","backgroundColor","events","on","onInitEditMode","bind","onDataReceived","addEditorTab","dataList","undefined","mode","number","myDate","Date","time","datapoints","length","times","getFullYear","fullTime","getMonth","getDate","getHours","getMinutes","getSeconds","alarmCode","split","num","Array","i","push","parseFloat","data","toFixed","Math","random","doJudgment","getTimes","fixed","setColor","render","scope","elem","attrs","ctrl","templateUrl"],"mappings":"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","file":"graph_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\r\nimport moment from 'moment';\r\nimport _ from 'lodash';\r\nimport TimeSeries from 'app/core/time_series';\r\nimport './css/clock-panel.css!';\r\nimport $ from 'jquery';\r\n\r\nvar panelDefaults = { \r\n\tprecise: 2,\r\n\tcolor:'0,0,0',\r\n\tvalueSize:'2',\r\n\tfontSize:'2',\r\n\ttimeSize:'2',\r\n\tshowName:true\r\n\t//alarmColor:[\"rgba(0, 255, 0, 0.7)\", \"rgba(0, 170, 0, 0.7)\", \"rgba(255, 255, 0, 0.7)\", \"rgba(255, 0, 0, 0.7)\"] //告警颜色等级0-3 00ff00\\00aa00\\ffff00,#ff0003\r\n};\r\n\r\nexport class EchartsCtrl extends MetricsPanelCtrl {\r\n  constructor($scope, $injector, $rootScope) {\r\n    super($scope, $injector);\r\n\tthis.$rootScope = $rootScope;\r\n\tconsole.info(\"action onRenderdasd\");\r\n\t_.defaults(this.panel, panelDefaults); \r\n\tvar modeOption = [\r\n      {name: 'json', value: \"json\"},\r\n\t  {name: '默认数据源', value:\"default\"},\r\n    ];\r\n\tvar preciseOption =[\r\n\t  {name:'0',value:0},\r\n\t  {name:'1',value:1},\r\n\t  {name:'2',value:2},\r\n\t  {name:'3',value:3},\r\n\t  {name:'4',value:4},\r\n\t  {name:'5',value:5},\r\n\t  {name:'6',value:6},\r\n\t];\r\n\tvar valueSizeOption = 2,fontSizeOption = 2,timeSizeOption = 2;\r\n\t//var showName;\r\n\t//this.panel.showName = showName;\r\n\tthis.panel.valueSizeOption = valueSizeOption;\r\n\tthis.panel.fontSizeOption = fontSizeOption;\r\n\tthis.panel.timeSizeOption = timeSizeOption;\r\n\tvar colorOption = '0,0,0';\r\n\tvar backgroundColor = '';\r\n\tthis.panel.backgroundColor = backgroundColor;\r\n\tthis.panel.colorOption = colorOption;\r\n\tthis.panel.preciseOption = preciseOption;\r\n\tthis.panel.modeOption = modeOption;\r\n\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n  }\r\n  \r\n  onInitEditMode() {\r\n    this.addEditorTab('Options', 'public/plugins/grafana-zxx-graphs/editor.html', 2);\r\n  }\t\r\n\tdoJudgment(){\r\n\t\tif(this.dataList.value == undefined){\r\n\t\t\tthis.panel.mode = 'default';\r\n\t\t}\r\n\t\telse {this.panel.mode = 'json';}\r\n\t}\r\n    fullTime(number) {\r\n\t\t\tif (number < 10) {\r\n\t\t\t\treturn \"0\" + number;\r\n\t\t\t} else {\r\n\t\t\t\treturn number;\r\n\t\t\t}\r\n\t\t}\r\n\tgetTimes(){\r\n\t\tvar myDate;\r\n\tif (this.panel.mode == 'json'){\r\n\t\t\tmyDate = new Date(this.dataList.time);\r\n\t}\r\n\telse \r\n\t{\r\n\t\tif (this.dataList[0].datapoints.length == 0){\r\n\t\t\tmyDate = new Date();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tmyDate = new Date(this.dataList[0].datapoints[0][1]);\r\n\t\t}\r\n\t}\r\n\tvar times = myDate.getFullYear();\r\n\t\ttimes += \"-\" + this.fullTime((myDate.getMonth()+1));\r\n\t\ttimes += \"-\" + this.fullTime(myDate.getDate());\r\n\t\ttimes += \" \" + this.fullTime(myDate.getHours());\r\n\t\ttimes += \":\" + this.fullTime(myDate.getMinutes());\r\n\t\ttimes += \":\" + this.fullTime(myDate.getSeconds());\r\n\t\tthis.panel.time = times;\r\n\t}\r\n\tsetColor(){\r\n\t\tif (this.panel.mode == 'json'){\r\n\t\t\tif (this.dataList.alarmCode == 0){\r\n\t\t\t\tthis.panel.backgroundColor = '#00ff00';\r\n\t\t\t}\r\n\t\t\telse if (this.dataList.alarmCode == 1){\r\n\t\t\t\tthis.panel.backgroundColor= '#00aa00';\r\n\t\t\t}\r\n\t\t\telse if (this.dataList.alarmCode == 2){\r\n\t\t\t\tthis.panel.backgroundColor =  '#ffff00';\r\n\t\t\t}\r\n\t\t\telse { this.panel.backgroundColor = '#ff0003';}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (this.dataList[0].datapoints.length == 0 ){\r\n\t\t\t\tthis.panel.backgroundColor = '#00ff00'\r\n\t\t\t}\r\n\t\t\telse if (this.dataList[0].datapoints.length != 0 ){\r\n\t\t\tvar color = this.panel.color.split(\",\"); \r\n\t\t\tvar num = new Array;\r\n\t\t\tfor (var i=0;i<color.length;i++){\r\n\t\t\tnum.push(parseFloat(color[i]));\r\n\t\t\t}\r\n\t\t\tvar datapoints = this.dataList[0].datapoints[0][0];\r\n\t\t\t\tif (datapoints < num[0]){\r\n\t\t\t\tthis.panel.backgroundColor = '#00ff00';\r\n\t\t\t\t}\r\n\t\t\t\telse if ((num[0] <= datapoints) && (datapoints< num[1])){\r\n\t\t\t\tthis.panel.backgroundColor= '#00aa00';\r\n\t\t\t\t}\r\n\t\t\t\telse if ((num[1] <= datapoints)&& (datapoints< num[2])){\r\n\t\t\t\tthis.panel.backgroundColor =  '#ffff00';\r\n\t\t\t\t}\r\n\t\t\t\telse if (datapoints >= num[2]){\r\n\t\t\t\tthis.panel.backgroundColor = '#ff0003';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\telse {\r\n\t\t\tthis.panel.backgroundColor= '';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\tfixed(){\r\n\tif (this.panel.mode == 'json'){\r\n\t\tvar num = this.dataList.value;\r\n\t\tif(num == -9999){\r\n\t\tthis.panel.data = \"-\";\r\n\t\t}\r\n\t\telse{\r\n\t\tthis.panel.data = num.toFixed(this.dataList.precise);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tif (this.dataList[0].datapoints.length == 0){//没值时给随机数\r\n\t\t\tvar num =parseFloat(Math.random()*10+2);\r\n\t\t}\r\n\t\telse if(this.dataList[0].datapoints[0][0] == -9999){//过滤掉-9999\r\n\t\t\tthis.panel.data = \"-\";\r\n\t\t}\r\n\t\telse{\r\n\t\t\tvar num = this.dataList[0].datapoints[0][0];\r\n\t\t\tthis.panel.data = num.toFixed(this.panel.precise);\r\n\t\t}\r\n\t\t}\r\n\t}\r\n  setfontSize(){\r\n\t\tif (this.panel.fontSize == undefined){\r\n\t\t\tthis.panel.fontSize =\"请输入0~5的数字\";\r\n\t\t}\r\n\t\telse{\r\n\t\t}\r\n\t}\r\n\tsetvalueSize(){\r\n\t\tif (this.panel.valueSize == undefined){\r\n\t\t\tthis.panel.valueSize =\"请输入0~5的数字\";\r\n\t\t}\r\n\t\telse {\r\n\t\t}\r\n\t}\r\n\tsettimeSize(){\r\n\t\tif (this.panel.timeSize == undefined){\r\n\t\t\tthis.panel.timeSize =\"请输入0~5的数字\";\r\n\t\t}\r\n\t\telse {\r\n\t\t}\r\n\t}\r\n  onDataReceived(dataList) {\r\n\tthis.dataList = dataList;\r\n\tthis.doJudgment();\r\n\tthis.getTimes();\r\n\tthis.fixed();\r\n\tthis.setColor();\r\n\tthis.render();\r\n  }\r\n  onRender(){\r\n\t \r\n  }\r\n  \r\n  link(scope, elem, attrs, ctrl) { \r\n  }\r\n}\r\n\r\n\r\nEchartsCtrl.templateUrl = 'module.html';\r\n"]}