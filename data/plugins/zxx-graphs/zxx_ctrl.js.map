{"version":3,"sources":["../../src/zxx_ctrl.js"],"names":["MetricsPanelCtrl","OgeAlertMetricsPanelCtrl","moment","_","TimeSeries","$","panelDefaults","precise","valueSize","fontSize","timeSize","showName","unit","EchartsCtrl","$scope","$injector","$rootScope","defaults","panel","modeOption","name","value","preciseOption","valueSizeOption","fontSizeOption","timeSizeOption","backgroundColor","events","on","onInitEditMode","bind","onDataReceived","onRender","addEditorTab","dataList","undefined","mode","number","myDate","Date","time","datapoints","length","DP","times","getFullYear","fullTime","getMonth","getDate","getHours","getMinutes","getSeconds","alarm","level","color","getAlertLevelColor","num","data","parseInt","toFixed","num1","doJudgment","getTimes","fixed","render","setColor","scope","elem","attrs","ctrl","templateUrl"],"mappings":"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","file":"zxx_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\r\nimport moment from 'moment';\r\nimport _ from 'lodash';\r\nimport TimeSeries from 'app/core/time_series';\r\nimport './css/clock-panel.css!';\r\nimport $ from 'jquery';\r\nimport {OgeAlertMetricsPanelCtrl} from 'app/plugins/sdk';\r\n\r\nvar panelDefaults = { \r\n\t\tprecise: 2,\r\n\t\tvalueSize:'2',\r\n\t\tfontSize:'2',\r\n\t\ttimeSize:'2',\r\n\t\tshowName:true,\r\n\t\tunit: ''\r\n\t};\r\nexport class EchartsCtrl extends OgeAlertMetricsPanelCtrl {\r\n  constructor($scope, $injector, $rootScope) {\r\n    super($scope, $injector);\r\n\tthis.$rootScope = $rootScope;\r\n\t_.defaults(this.panel, panelDefaults); \r\n\tvar modeOption = [\r\n      {name: 'json', value: \"json\"},\r\n\t  {name: '默认数据源', value:\"default\"},\r\n    ];\r\n\tvar preciseOption =[//精度\r\n\t  {name:'0',value:0},\r\n\t  {name:'1',value:1},\r\n\t  {name:'2',value:2},\r\n\t  {name:'3',value:3},\r\n\t  {name:'4',value:4},\r\n\t  {name:'5',value:5},\r\n\t  {name:'6',value:6},\r\n\t];\r\n\tvar valueSizeOption = 2,fontSizeOption = 2,timeSizeOption = 2;\r\n\tthis.panel.valueSizeOption = valueSizeOption;\r\n\tthis.panel.fontSizeOption = fontSizeOption;\r\n\tthis.panel.timeSizeOption = timeSizeOption;\r\n\tvar backgroundColor = '';\r\n\tthis.panel.backgroundColor = backgroundColor;\r\n\tthis.panel.preciseOption = preciseOption;\r\n\tthis.panel.modeOption = modeOption;\r\n\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\tthis.events.on('render', this.onRender.bind(this));\r\n  }\r\n  \r\n\tonInitEditMode() {\r\n    this.addEditorTab('Options', 'public/plugins/zxx-graphs/editor.html', 2);\r\n  }\t\r\n\tdoJudgment(){\r\n\t\tif(this.dataList.value == undefined){\r\n\t\t\tthis.panel.mode = 'default';\r\n\t\t}\r\n\t\telse {this.panel.mode = 'json';}\r\n\t}\r\n    fullTime(number) {\r\n\t\t\tif (number < 10) {\r\n\t\t\t\treturn \"0\" + number;\r\n\t\t\t} else {\r\n\t\t\t\treturn number;\r\n\t\t\t}\r\n\t\t}\r\n\tgetTimes(){\r\n\tvar myDate;\r\n\tif (this.panel.mode == 'json'){\r\n\t\t\tmyDate = new Date(this.dataList.time);\r\n\t}\r\n\telse \r\n\t{\r\n\t\tif (this.dataList[0].datapoints.length == 0){\r\n\t\t\tmyDate = new Date();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar DP=this.dataList[0].datapoints;\r\n\t\t\tmyDate = new Date(this.dataList[0].datapoints[DP.length-1][1]);\r\n\t\t}\r\n\t}\r\n\tvar times = myDate.getFullYear();\r\n\t\ttimes += \"-\" + this.fullTime((myDate.getMonth()+1));\r\n\t\ttimes += \"-\" + this.fullTime(myDate.getDate());\r\n\t\ttimes += \" \" + this.fullTime(myDate.getHours());\r\n\t\ttimes += \":\" + this.fullTime(myDate.getMinutes());\r\n\t\ttimes += \":\" + this.fullTime(myDate.getSeconds());\r\n\t\tthis.panel.time = times;\r\n\t}\r\n\tsetColor(){\r\n\t\tif (this.dataList == undefined ){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.dataList !== null && this.dataList.length > 0 && this.dataList[0].alarm !== undefined) {\r\n\t\t\tvar level = this.dataList[0].alarm.level;\r\n\t\t\tvar color = this.getAlertLevelColor(level);\r\n\t\t\tif (color) {\r\n\t\t\t\tthis.panel.backgroundColor = color;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.panel.backgroundColor = '';\r\n\t\t}\r\n\t\t\r\n\t}\r\n\tfixed(){\r\n\tif (this.panel.mode == 'json'){\r\n\t\tvar num = this.dataList.value;\r\n\t\tif(num == -9999){\r\n\t\tthis.panel.data = \"-\";\r\n\t\t}\r\n\t\telse if(num == parseInt (num + \"\")){\r\n\t\t\tthis.panel.data = num;\r\n\t\t}\r\n\t\telse{\r\n\t\tthis.panel.data = num.toFixed(this.dataList.precise+2);//临时加2\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tvar num1 = this.dataList[0].datapoints.length-1;\r\n\t\tif (this.dataList[0].datapoints.length == 0){//没值时给随机数\r\n\t\t\tthis.panel.data = 'NAN';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar num = this.dataList[0].datapoints[num1][0];\r\n\t\t\tthis.panel.data = num.toFixed(this.panel.precise);\r\n\t\t}\r\n\t\t}\r\n\t}\r\n    setfontSize(){\r\n\t\tif (this.panel.fontSize == undefined){\r\n\t\t\tthis.panel.fontSize =\"请输入0~5的数字\";\r\n\t\t}\r\n\t\telse{\r\n\t\t}\r\n\t}\r\n\tsetvalueSize(){\r\n\t\tif (this.panel.valueSize == undefined){\r\n\t\t\tthis.panel.valueSize =\"请输入0~5的数字\";\r\n\t\t}\r\n\t\telse {\r\n\t\t}\r\n\t}\r\n\tsettimeSize(){\r\n\t\tif (this.panel.timeSize == undefined){\r\n\t\t\tthis.panel.timeSize =\"请输入0~5的数字\";\r\n\t\t}\r\n\t\telse {\r\n\t\t}\r\n\t}\r\n\t\r\n  onDataReceived(dataList) {\r\n\tthis.dataList = dataList;\r\n\tthis.doJudgment();\r\n\tthis.getTimes();\r\n\tthis.fixed();\r\n\tthis.render();\r\n  }\r\n  onRender(){\r\n\tthis.setColor();\r\n  }\r\n  \r\n  link(scope, elem, attrs, ctrl) { \r\n  \tif (ctrl.panel.unit == null) {\r\n\t\treturn;\r\n\t}\r\n  }\r\n}\r\n\r\n\r\n\r\nEchartsCtrl.templateUrl = 'module.html';\r\n"]}