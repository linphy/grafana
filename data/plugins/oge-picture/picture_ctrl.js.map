{"version":3,"sources":["../src/picture_ctrl.js"],"names":["MetricsPanelCtrl","moment","_","TimeSeries","$","panelDefaults","pictureName","pictureType","direct","XOption","name","value","pictureOption","EchartsCtrl","$scope","$injector","$rootScope","$location","linkSrv","defaults","panel","events","on","onInitEditMode","bind","onDataReceived","addEditorTab","dataList","val","datapoints","num","length","o","A","B","imgUrl","picStyleObj","evt","links","undefined","scopedVars","extend","linkInfo","$timeout","drilldownTooltip","getPanelLinkAnchorInfo","parents","target","redirectWindow","window","open","href","location","indexOf","url","detach","e","text","title","place_tt","pageX","pageY","tooltip","doJud","getPic","render","templateUrl"],"mappings":"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","file":"picture_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport TimeSeries from 'app/core/time_series';\nimport './css/clock-panel.css!';\nimport $ from 'jquery';\n\n\nvar panelDefaults = { \n\tpictureName: '冲击式',\n\tpictureType: 1,\n\tdirect: 'shun'\n};\n\nvar XOption = [\n\t{name:'顺时针旋转',value:'shun'},\n\t{name:'逆时针旋转',value:'ni'},\n];\n\nvar pictureOption = [\n\t'冲击式', \n\t'贯流式', \n\t'混流半伞式',\n\t'混流半伞无下机架', \n\t'混流全伞三导', \n\t'混流全伞无上导', \n\t'混流悬挂式',\n\t'轴混全伞三导',\n\t'轴流半伞',\n\t'轴流半伞无下机架',\n\t'轴流全伞无上导',\n\t'轴流悬挂式'\n];\n\nexport class EchartsCtrl extends MetricsPanelCtrl {\n\t\n\tconstructor($scope, $injector, $rootScope, $location, linkSrv) {\n\t\tsuper($scope, $injector);\n\t\tthis.$rootScope = $rootScope;\n\t\tthis.$location = $location;\n\t\tthis.linkSrv = linkSrv;\n\t\tthis.XOption = XOption;\n\t\tthis.pictureOption = pictureOption;\n\t\t_.defaults(this.panel, panelDefaults);\n\t_.defaults(this.panel, panelDefaults); \n\t\t_.defaults(this.panel, panelDefaults);\n\t_.defaults(this.panel, panelDefaults); \n\t\t_.defaults(this.panel, panelDefaults);\n\t\tthis.panel.pictureType = 1;//默认动态图，动图为1，静态图为0\n\t\tthis.panel.direct = 'shun';//默认顺时针转\n\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\n\t}\n\t\n\tonInitEditMode() {\n\t\tthis.addEditorTab('Options', 'public/plugins/oge-picture/editor.html', 2);\n\t}\t\n\t\n\tdoJud(){//判断图片是动态还是静态\n\t\tif (this.dataList[0] === null) {\n\t\t\treturn;\n\t\t}\n\t\telse{\n\t\t\tlet val = this.dataList[0].datapoints;\n\t\t\tlet num = val.length-1;\n\t\t\tthis.panel.pictureType = (val[num][0] > 1) ? 1: o;\n\t\t}\n\t}\n\n\tgetPic(){\n\t\tlet A = this.panel.pictureType;\n\t\tlet B = this.panel.direct;\n\t\tlet name = (this.panel.pictureName == '冲击式' || this.panel.pictureName == '贯流式')\n\t\t? \n\t\tthis.panel.pictureName \n\t\t: \n\t\t(B=='shun' ? this.panel.pictureName+'顺' : this.panel.pictureName+'逆');\n\n\t\tlet imgUrl = 'public/plugins/oge-picture/src/img/'+name+'.'+ (A?'gif':'jpg');\n\t\tthis.panel.picStyleObj = {\n\t\t\t'background-image' : 'url(\"' + imgUrl + '\")',\n\t\t\t'background-size' : '100% 100%',\n\t\t\t'width' : '100%',\n\t\t\t'max-width' : '700px',\n\t\t\t'height' : '100%',\n\t\t\t'margin' : '0 auto'\n\t\t};\n\t}\n\t\n\tonClick(evt) {\n\t\tif(this.panel.links == undefined || this.panel.links.length === 0){\n\t\t\treturn;\n\t\t};\n\t\tvar scopedVars = _.extend({}, this.panel.scopedVars);\n\t\tvar linkInfo;\n\t\tvar linkSrv = this.linkSrv;\n\t\tvar $location = this.$location;\n\t\tvar $timeout = this.$timeout;\n\t\tvar drilldownTooltip = $('<div id=\"tooltip\" class=\"\">hello</div>\"');\n\t\tif (this.panel.links.length > 0) {\n\t\tlinkInfo = linkSrv.getPanelLinkAnchorInfo(this.panel.links[0], scopedVars);\n\t\t} \n\t\telse {\n\t\tlinkInfo = null;\n\t\t}\n\t\tif (!linkInfo) { return; }\n\t\tif ($(evt).parents('.panel-header').length > 0) { return; }\n\n\t\tif (linkInfo.target === '_blank') {\n\t\t\tvar redirectWindow = window.open(linkInfo.href, '_blank');\n\t\t\tredirectWindow.location;\n\t\t\treturn;\n\t\t}\n\n\t\tif (linkInfo.href.indexOf('http') === 0) {\n\t\t\twindow.location.href = linkInfo.href;\n\t\t} \n\t\telse {\n\t\t\t$timeout(function() {\n\t\t\t$location.url(linkInfo.href);\n\t\t\t})\n\t\t}\n\t\tdrilldownTooltip.detach();\n\t}  \n\t\n\tmouseMove(e) {\n\tif(this.panel.links == undefined || this.panel.links.length === 0){\n\t\treturn;\n\t};\n\tvar scopedVars = _.extend({}, this.panel.scopedVars);\n    var linkInfo;\n    var linkSrv = this.linkSrv;\n\tvar drilldownTooltip = $('<div id=\"tooltip\" class=\"\">hello</div>\"');\n\t   if (this.panel.links.length > 0) {\n        linkInfo = linkSrv.getPanelLinkAnchorInfo(this.panel.links[0], scopedVars);\n      } \n\t  else {\n        linkInfo = null;\n      }\n      if (!linkInfo) { return;}\n      drilldownTooltip.text('点击跳转至: ' + linkInfo.title);\n\t  drilldownTooltip.place_tt(e.pageX+20, e.pageY-15);\n\t}\n\t\n\tmouseLeave(){\n\t\tif(this.panel.links == undefined || this.panel.links.length === 0){\n\t\t\treturn;\n\t\t};\n\t\tthis.$timeout(function() {\n          $(tooltip).detach();\n\t\t});\n\t}\n\t\n\tonDataReceived(dataList) {\n\t\tif (!dataList || dataList.length==0 || !dataList[0].datapoints || dataList[0].datapoints.length==0) return;\n\n\t\tthis.dataList = dataList;\n\t\tthis.doJud();\n\t\tthis.getPic();\n\t\tthis.render();\n\t}\n\n\tonRender(){\n\n  \t}\n  \n  }\n\n\nEchartsCtrl.templateUrl = 'module.html';\n"]}