{"version":3,"sources":["../src/wave_ctrl.js"],"names":["MetricsPanelCtrl","moment","_","TimeSeries","echarts","$","panelDefaults","tabIsShow","tabIndex","timeIsShow","timeIndex","currentSymbol","showType","times","WaveCtrl","$scope","$injector","$rootScope","templateSrv","templateChange","defaults","panel","options","value","tabOptions","symbolArr","showTypeArr","events","on","onDataReceived","bind","onInitEditMode","addEditorTab","dataList","length","console","error","sType","timeList","i","push","time","render","index","inputTime","dataType","kksInfo","datasource","undefined","kksCode","changeStart","formData","FormData","append","kdmUrl","method","data","linkUser","linkPassword","url","promise","Promise","resolve","reject","getLoginStatus","then","request","body","relogin","scope","elem","attrs","ctrl","systemColor","getTempData","kksName","xAxis","x","name","axisLabel","show","targets","formatStr","formatter","getFormatter","yAxis","min","splitLine","lineStyle","color","series","type","y","showSymbol","symbol","barWidth","barMaxWidth","normal","width","itemStyle","num","unit","parseInt","toFixed","initGraph","xArr","yArr","sArr","kksNameArr","divArr","myChart","init","option","title","text","grid","left","top","bottom","right","tooltip","trigger","showDelay","axisPointer","zlevel","legend","z","orient","textStyle","group","dataZoom","handleSize","handleIcon","backgroundColor","fillerColor","showDataShadow","borderColor","handleStyle","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","setOption","obj","find","html","allHeight","height","marginTrue","showSplitCharts","showCoaxialCharts","charts","wave_kks","page_name","dashboard","meta","slug","checkWaves","target","codeTimes","forEach","tag","promises","dataTime","div","array","split","getWaveDataByTime","all","isArray","item","temp","keyPhaseOffsetData","keyPhaseOffsetIndex","symbolSize","chart","connect","catch","firstData","j","series1","eoption","templateUrl"],"mappings":"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","file":"wave_ctrl.js","sourcesContent":["import {\r\n    MetricsPanelCtrl\r\n}\r\nfrom 'app/plugins/sdk';\r\nimport moment from 'moment';\r\nimport _ from 'lodash';\r\nimport TimeSeries from 'app/core/time_series';\r\nimport echarts from 'vendor/echarts/echarts.min.js';\r\nimport $ from 'jquery';\r\n\r\nvar panelDefaults = {\r\n    tabIsShow: true, //是否显示标签页\r\n    tabIndex: 0, //显示哪一个标签页, 获取波形的什么数据\r\n    timeIsShow: true, //是否显示时间选择框\r\n    timeIndex: 0, //默认数据索引\r\n    currentSymbol: \"circle\", //键相显示方式\r\n    showType: false,\r\n    times: '',\r\n}\r\n\r\nexport class WaveCtrl extends MetricsPanelCtrl {\r\n    constructor($scope, $injector, $rootScope, templateSrv, templateChange) {\r\n        super($scope, $injector);\r\n        this.$rootScope = $rootScope;\r\n        this.templateChange = templateChange;\r\n        _.defaults(this.panel, panelDefaults);\r\n\r\n        //是否显示下拉框\r\n        var options = [{\r\n            \"name\": \"显示\",\r\n            value: true\r\n        }, {\r\n            \"name\": \"隐藏\",\r\n            value: false\r\n        }];\r\n\r\n        //默认tabIndex下拉框\r\n        var tabOptions = [{\r\n            \"name\": \"原始波形\",\r\n            value: 0\r\n        }, {\r\n            \"name\": \"阶次比\",\r\n            value: 1\r\n        }, {\r\n            \"name\": \"功率谱\",\r\n            value: 2\r\n        }, {\r\n            \"name\": \"相位谱\",\r\n            value: 3\r\n        }];\r\n\r\n        //键相图标：symbolArr: ['circle', 'rect', 'roundRect', 'triangle', 'diamond', 'pin', 'arrow']\r\n        var symbolArr = [{\r\n            \"name\": \"圆形\",\r\n            value: \"circle\"\r\n        }, {\r\n            \"name\": \"正方形\",\r\n            value: \"rect\"\r\n        }, {\r\n            \"name\": \"正方形（圆角）\",\r\n            value: \"roundRect\"\r\n        }, {\r\n            \"name\": \"三角形\",\r\n            value: \"triangle\"\r\n        }, {\r\n            \"name\": \"钻石形\",\r\n            value: \"diamond\"\r\n        }, {\r\n            \"name\": \"大头针\",\r\n            value: \"pin\"\r\n        }, {\r\n            \"name\": \"箭头\",\r\n            value: \"arrow\"\r\n        }];\r\n\r\n        //显示方式：同轴，分轴\r\n        var showTypeArr = [{\r\n            \"name\": \"分轴\",\r\n            value: 0\r\n        }, {\r\n            \"name\": \"同轴\",\r\n            value: 1\r\n        }];\r\n\r\n        this.panel.options = options;\r\n        this.panel.tabOptions = tabOptions;\r\n        this.panel.symbolArr = symbolArr;\r\n        this.panel.showTypeArr = showTypeArr;\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    }\r\n\r\n    onInitEditMode() {\r\n        this.addEditorTab('Options', 'public/plugins/oge-kdm-wave/editor.html', 2);\r\n    }\r\n\r\n    onDataReceived(dataList) {\r\n\r\n        if (dataList == null || dataList.length == 0) {\r\n            console.error(\"no data found wave\");\r\n            return;\r\n        }\r\n        var sType = typeof dataList[0];\r\n        if (sType != \"string\") {\r\n            console.error(\"不匹配的数据类型，请检查数据源是否正确\");\r\n            return;\r\n        }\r\n        this.panel.times = dataList[0];\r\n        var timeList = [];\r\n        for (var i = 0; i < dataList.length; i++) {\r\n            timeList.push({\r\n                value: i,\r\n                time: dataList[i]\r\n            });\r\n        }\r\n        this.panel.timeIndex = timeList.length - 1; //显示最后一条（最新一条）\r\n        this.panel.timeList = timeList;\r\n        this.render();\r\n    }\r\n\r\n    onRender() {\r\n\r\n    }\r\n\r\n    changeViewType() {\r\n        this.render();\r\n    }\r\n\r\n    changeWaveTab(index) {\r\n        this.panel.tabIndex = index;\r\n        this.render();\r\n    }\r\n\r\n    getWaveDataByTime(inputTime, dataType, kksInfo) {\r\n        if (this.datasource == undefined)\r\n            return;\r\n\r\n        kksInfo.kksCode = this.templateChange.changeStart(kksInfo.kksCode);\r\n\r\n\r\n        let formData = new FormData();\r\n        formData.append(\"kksCodes\", kksInfo.kksCode)\r\n        formData.append(\"waveTime\", inputTime)\r\n        formData.append(\"waveType\", dataType)\r\n        formData.append(\"kdmUrl\", this.datasource.kdmUrl)\r\n        var options = {\r\n            method: 'POST',\r\n            data: formData\r\n        };\r\n        //如果连接的数据源地址为KDM Link地址\r\n        if (this.datasource.linkUser && this.datasource.linkPassword) {\r\n            options.url = this.datasource.url + '/rest/v1/data-points/wave/getWaves';\r\n        } else\r\n            options.url = this.datasource.url + '/wave/getWaves';\r\n\r\n\r\n\r\n        let promise = new Promise((resolve, reject) => {\r\n            this.datasource.getLoginStatus().then(data => {\r\n\r\n                this.datasource.request(options).then(body => {\r\n                    body.data.kksInfo = kksInfo;\r\n                    resolve(body.data);\r\n                }, error => {\r\n                    this.datasource.relogin(error, options).then(data => {\r\n                        body.data.kksInfo = kksInfo;\r\n                        resolve(data.body)\r\n                    }, error => reject(error));\r\n                });\r\n            })\r\n        });\r\n        return promise;\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl, templateSrv) {\r\n        var systemColor = [\"#7eb26d\", \"#EE0000\", \"#0000EE\", \"#EEEE00\", \"#8DEEEE\", \"#1874CD\", \"#00EE00\", \"#008B8B\"];\r\n\r\n        function getTempData(data, index, kksName, tabIndex) {\r\n            var xAxis = {\r\n                data: data.x,\r\n                name: \"时间\",\r\n                axisLabel: {\r\n                    show: false\r\n                }\r\n            };\r\n\r\n            if (index == ctrl.panel.targets.length - 1) {\r\n                xAxis.axisLabel.show = true;\r\n\r\n                var formatStr = '';\r\n                if (tabIndex == 0)\r\n                    formatStr = 's';\r\n                if (tabIndex == 1 || tabIndex == 3)\r\n                    formatStr = 'X';\r\n                if (tabIndex == 2)\r\n                    formatStr = 'Hz';\r\n\r\n                xAxis.axisLabel.formatter = getFormatter(2, formatStr);\r\n            }\r\n\r\n            var yAxis = {\r\n                min: \"dataMin\",\r\n                axisLabel: {\r\n                    formatter: getFormatter(0, \"\")\r\n                },\r\n                splitLine: {\r\n                    lineStyle: {\r\n                        color: ['#444343']\r\n                    }\r\n                }\r\n            };\r\n            var series = {\r\n                name: kksName,\r\n                type: tabIndex == 0 || tabIndex == 2 ? 'line' : 'bar',\r\n                data: data.y,\r\n                showSymbol: false, //不显示与X轴对应的坐标\r\n                symbol: \"circle\",\r\n                barWidth: 1,\r\n                barMaxWidth: 1,\r\n                lineStyle: {\r\n                    normal: {\r\n                        width: 1\r\n                    }\r\n                },\r\n                itemStyle: {\r\n                    normal: {\r\n                        color: systemColor[index]\r\n                    }\r\n                }\r\n            };\r\n            return [xAxis, yAxis, series];\r\n        }\r\n\r\n        //根据精度，单位； 返回echarts图表中的formatter对象\r\n        function getFormatter(num, unit) {\r\n            var formatter = function (value, index) {\r\n                if (value == undefined) {\r\n                    return \"\";\r\n                }\r\n                if (value == 0 || value == parseInt(value)) { //如果数据本身就是一个正数，就不需要保留小数了\r\n                    return value;\r\n                }\r\n                if (unit == null) {\r\n                    unit = \"\";\r\n                }\r\n                if (num == 0) {\r\n                    return parseInt(value) + unit;\r\n                }\r\n                return value.toFixed(num) + unit;\r\n            }\r\n            return formatter;\r\n        }\r\n\r\n        function initGraph(xArr, yArr, sArr, kksNameArr, index, divArr) {\r\n            var myChart = echarts.init(divArr[index]);\r\n\r\n            var option = {\r\n                title: {\r\n                    text: '波形频谱',\r\n                    show: false\r\n                },\r\n                grid: {\r\n                    left: 40,\r\n                    top: 5,\r\n                    bottom: 5,\r\n                    right: 8\r\n                },\r\n                tooltip: {\r\n                    trigger: 'axis',\r\n                    showDelay: 0,\r\n                    axisPointer: {\r\n                        show: true,\r\n                        type: 'line',\r\n                        lineStyle: {\r\n                            type: 'dashed',\r\n                            width: 2\r\n                        }\r\n                    },\r\n                    zlevel: 1\r\n                },\r\n                legend: {\r\n                    data: kksNameArr,\r\n                    right: \"0px\",\r\n                    top: \"0px\",\r\n                    z: 3,\r\n                    orient: \"horizontal\",\r\n                    textStyle: {\r\n                        color: \"white\" //图例字体颜色\r\n                    }\r\n                },\r\n                textStyle: {\r\n                    color: \"white\"\r\n                }\r\n            };\r\n            option.xAxis = xArr;\r\n            option.yAxis = yArr;\r\n            option.series = sArr;\r\n            myChart.group = \"index_\" + index;\r\n\r\n            var dataZoom = [{\r\n                show: false,\r\n                handleSize: '80%',\r\n                handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',\r\n                backgroundColor: 'transparent',\r\n                fillerColor: 'rgba(0,0,0,0.4)',\r\n                showDataShadow: false,\r\n                borderColor: 'transparent',\r\n                bottom: 30,\r\n                handleStyle: {\r\n                    color: 'rgba(255,255,255,0.7)',\r\n                    shadowBlur: 3,\r\n                    shadowColor: 'rgba(0, 0, 0, 0.6)',\r\n                    shadowOffsetX: 2,\r\n                    shadowOffsetY: 2\r\n                }\r\n            }]\r\n\r\n            //最后一个图表，展示最下测的数据筛选功能\r\n            if (index == divArr.length - 1) {\r\n                dataZoom[0].show = true;\r\n                option.grid.bottom = 60;\r\n            }\r\n            option.dataZoom = dataZoom;\r\n\r\n            myChart.setOption(option);\r\n            return myChart;\r\n        }\r\n\r\n        ctrl.events.on('render', function () {\r\n            var obj = elem.find('.data-panel');\r\n            obj.html(\"\");\r\n\r\n            var allHeight = ctrl.height;\r\n            var marginTrue = false;\r\n            if (ctrl.panel.tabIsShow || ctrl.panel.timeIsShow) {\r\n                allHeight = allHeight - 40; //顶部标签页 + 时间选择\r\n                marginTrue = true;\r\n            }\r\n            ctrl.panel.marginTrue = marginTrue; //是否距离上边距40的像素，否则遮住了下拉框，无法选择\r\n\r\n            if (!ctrl.panel.showType) {\r\n                showSplitCharts(obj, allHeight); //分轴显示\r\n            } else {\r\n                showCoaxialCharts(obj, allHeight); //同轴显示\r\n            }\r\n        });\r\n\r\n        function showSplitCharts(obj, allHeight) {\r\n\r\n            allHeight = allHeight - 50; // 最下面的图表（数据筛选条 + 坐标）共占据50像素高度\r\n            let divArr = [];\r\n            let charts = [];\r\n            let targets = [];\r\n\r\n            if (ctrl.templateSrv.wave_kks && ctrl.templateSrv.page_name == ctrl.dashboard.meta.slug) {\r\n                var checkWaves = ctrl.templateSrv.wave_kks;\r\n                for (var i = 0; i < checkWaves.length; i++) {\r\n                    targets.push({\r\n                        target: checkWaves[i]\r\n                    });\r\n                }\r\n            } else {\r\n                targets = ctrl.panel.targets;\r\n            }\r\n\r\n\r\n\r\n            //过滤掉波形时刻为空的监测量\r\n            let codeTimes = [];\r\n            ctrl.panel.timeList.forEach((value, index) => {\r\n\r\n                if (value && value != \"\") {\r\n\r\n                    codeTimes.push({\r\n                        time: value.time,\r\n                        tag: targets[index]\r\n                    });\r\n\r\n                }\r\n            });\r\n\r\n\r\n            if (codeTimes.length == 0)\r\n                return;\r\n\r\n            let height = allHeight / codeTimes.length;\r\n            let promises = [];\r\n            for (let i = 0; i < codeTimes.length; i++) {\r\n                let dataTime = codeTimes[i].time;\r\n                if (dataTime && dataTime != \"\") {\r\n\r\n                    if (i == codeTimes.length - 1) {\r\n                        height += 50; //最后一个图表的高度 = 平局高度 + 50;\r\n                    }\r\n                    let div = $(\"<div class='myDiv_\" + i + \"' style='height:\" + height + \"px'></div>\");\r\n                    divArr.push(div[0]);\r\n                    obj.append(div);\r\n\r\n                    var array = codeTimes[i].tag.target.split(\"_\"); //kks, name\r\n\r\n                    //异步请求数据返回的顺序可能不一致,所以在此处需要重新构建一个kksInfo对象\r\n                    let kksInfo = {\r\n                        kksCode: array[0],\r\n                        name: array[1]\r\n                    };\r\n                    var promise = ctrl.getWaveDataByTime(dataTime, ctrl.panel.tabIndex, kksInfo);\r\n                    promises.push(promise);\r\n                }\r\n            }\r\n\r\n            Promise.all(promises).then(data => {\r\n\r\n                if (!_.isArray(data))\r\n                    return;\r\n\r\n                data.forEach((item, index) => {\r\n\r\n                    if (!item)\r\n                        return;\r\n                    let kksNameArr = [];\r\n                    let xArr = [];\r\n                    let yArr = [];\r\n                    let sArr = [];\r\n                    let temp = getTempData(item, index, item.kksInfo.name, ctrl.panel.tabIndex);\r\n                    kksNameArr.push(item.kksInfo.name);\r\n\r\n                    xArr.push(temp[0]);\r\n                    yArr.push(temp[1]);\r\n                    sArr.push(temp[2]);\r\n\r\n                    if (ctrl.panel.tabIndex == 0 && item.y.length > 0) {\r\n                        //原始波形，显示键相\r\n                        var keyPhaseOffsetData = [];\r\n                        var keyPhaseOffsetIndex = item.keyPhaseOffsetIndex;\r\n                        for (var i = 0; i < keyPhaseOffsetIndex.length; i++) {\r\n                            keyPhaseOffsetData.push([keyPhaseOffsetIndex[i], item.y[keyPhaseOffsetIndex[i]]]);\r\n                        }\r\n                        var series = {\r\n                            name: '键相',\r\n                            symbol: ctrl.panel.currentSymbol,\r\n                            data: keyPhaseOffsetData,\r\n                            type: 'scatter',\r\n                            symbolSize: 5,\r\n                            itemStyle: {\r\n                                normal: {\r\n                                    color: \"white\"\r\n                                }\r\n                            } //键相全部显示白色\r\n                        };\r\n                        sArr.push(series);\r\n                        kksNameArr.push(\"键相\");\r\n                    }\r\n                    let chart = initGraph(xArr, yArr, sArr, kksNameArr, index, divArr);\r\n                    charts.push(chart);\r\n                });\r\n                echarts.connect(charts);\r\n            }).catch(console.error);\r\n        }\r\n\r\n\r\n        function showCoaxialCharts(obj, height) {\r\n\r\n            var div = $(\"<div class='myDiv' style='height:\" + height + \"px'></div>\");\r\n            obj.append(div);\r\n            var myChart = echarts.init(div[0]);\r\n            var targets = [];\r\n\r\n            if (ctrl.templateSrv.wave_kks && ctrl.templateSrv.page_name == ctrl.dashboard.meta.slug) {\r\n                var checkWaves = ctrl.templateSrv.wave_kks;\r\n                for (var i = 0; i < checkWaves.length; i++) {\r\n                    targets.push({\r\n                        target: checkWaves[i]\r\n                    });\r\n                }\r\n            } else {\r\n                targets = ctrl.panel.targets;\r\n            }\r\n\r\n            var kksNameArr = [];\r\n            var firstData;\r\n            var sArr = [];\r\n\r\n            let promises = [];\r\n            for (var i = 0; i < targets.length; i++) {\r\n\r\n                let dataTime = ctrl.panel.timeList[i].time;\r\n                if (dataTime && dataTime != \"\") {\r\n\r\n                    var array = targets[i].target.split(\"_\");\r\n                    var kksName = array.length == 2 ? array[1] : \"未定义\";\r\n                    kksNameArr.push(kksName);\r\n\r\n                    let kksInfo = {\r\n                        kksCode: array[0],\r\n                        name: kksName\r\n                    };\r\n                    let promise = ctrl.getWaveDataByTime(dataTime, ctrl.panel.tabIndex, kksInfo);\r\n                    promises.push(promise);\r\n\r\n                }\r\n\r\n            }\r\n\r\n            Promise.all(promises).then((data) => {\r\n\r\n                if (!_.isArray(data))\r\n                    return;\r\n                data.forEach((item, index) => {\r\n\r\n                    if (index == 0) {\r\n                        firstData = item;\r\n                    }\r\n                    var series = {\r\n                        name: item.kksInfo.name,\r\n                        type: ctrl.panel.tabIndex == 0 || ctrl.panel.tabIndex == 2 ? 'line' : 'bar',\r\n                        data: item.y,\r\n                        showSymbol: false, //不显示与X轴对应的坐标\r\n                        symbol: \"circle\",\r\n                        lineStyle: {\r\n                            normal: {\r\n                                width: 1\r\n                            }\r\n                        },\r\n                        barWidth: 1,\r\n                        barMaxWidth: 1,\r\n                        itemStyle: {\r\n                            normal: {\r\n                                color: systemColor[index]\r\n                            }\r\n                        }\r\n\r\n                    };\r\n                    sArr.push(series);\r\n\r\n\r\n                    if (ctrl.panel.tabIndex == 0 && item.y && item.y.length > 0) {\r\n\r\n                        //原始波形，显示键相\r\n                        var keyPhaseOffsetData = [];\r\n                        var keyPhaseOffsetIndex = item.keyPhaseOffsetIndex;\r\n                        for (var j = 0; j < keyPhaseOffsetIndex.length; j++) {\r\n                            keyPhaseOffsetData.push([keyPhaseOffsetIndex[j], item.y[keyPhaseOffsetIndex[j]]]);\r\n                        }\r\n\r\n                        var series1 = {\r\n                            name: '键相',\r\n                            symbol: ctrl.panel.currentSymbol,\r\n                            data: keyPhaseOffsetData,\r\n                            type: 'scatter',\r\n                            symbolSize: 5,\r\n                            itemStyle: {\r\n                                normal: {\r\n                                    color: \"white\"\r\n                                }\r\n                            } //键相全部显示白色\r\n                        };\r\n                        sArr.push(series1);\r\n                        kksNameArr.push(\"键相\");\r\n                    }\r\n                });\r\n\r\n                var formatStr = '';\r\n                if (ctrl.panel.tabIndex == 0)\r\n                    formatStr = 's';\r\n                if (ctrl.panel.tabIndex == 1 || ctrl.panel.tabIndex == 3)\r\n                    formatStr = 'X';\r\n                if (ctrl.panel.tabIndex == 2)\r\n                    formatStr = 'Hz';\r\n\r\n                var eoption = {\r\n                    title: {\r\n                        text: '波形频谱',\r\n                        show: false\r\n                    },\r\n                    grid: {\r\n                        left: 40,\r\n                        top: 5,\r\n                        bottom: 60,\r\n                        right: 8\r\n                    },\r\n                    tooltip: {\r\n                        trigger: 'axis',\r\n                        showDelay: 0,\r\n                        axisPointer: {\r\n                            show: true,\r\n                            type: 'line',\r\n                            lineStyle: {\r\n                                type: 'dashed',\r\n                                width: 2\r\n                            }\r\n                        },\r\n                        zlevel: 1\r\n                    },\r\n                    legend: {\r\n                        data: kksNameArr,\r\n                        right: \"0px\",\r\n                        top: \"0px\",\r\n                        z: 3,\r\n                        orient: \"horizontal\",\r\n                        textStyle: {\r\n                            color: \"white\" //图例字体颜色\r\n                        }\r\n                    },\r\n                    textStyle: {\r\n                        color: \"white\"\r\n                    },\r\n                    xAxis: {\r\n                        data: firstData.x,\r\n                        name: \"时间\",\r\n                        axisLabel: {\r\n                            show: true,\r\n                            formatter: getFormatter(2, formatStr)\r\n                        }\r\n                    },\r\n                    yAxis: {\r\n                        min: \"dataMin\",\r\n                        axisLabel: {\r\n                            formatter: getFormatter(0, '')\r\n                        },\r\n                        splitLine: {\r\n                            lineStyle: {\r\n                                color: ['#444343']\r\n                            }\r\n                        }\r\n                    },\r\n                    dataZoom: [{\r\n                        show: true,\r\n                        handleSize: '80%',\r\n                        handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',\r\n                        backgroundColor: 'transparent',\r\n                        fillerColor: 'rgba(0,0,0,0.4)',\r\n                        showDataShadow: false,\r\n                        borderColor: 'transparent',\r\n                        bottom: 30,\r\n                        handleStyle: {\r\n                            color: 'rgba(255,255,255,0.7)',\r\n                            shadowBlur: 3,\r\n                            shadowColor: 'rgba(0, 0, 0, 0.6)',\r\n                            shadowOffsetX: 2,\r\n                            shadowOffsetY: 2\r\n                        }\r\n                    }],\r\n                    series: sArr\r\n\r\n                };\r\n\r\n                myChart.setOption(eoption);\r\n\r\n            }).catch(error => {\r\n                console.error(error);\r\n            });\r\n\r\n        }\r\n    }\r\n}\r\n\r\nWaveCtrl.templateUrl = 'module.html';"]}