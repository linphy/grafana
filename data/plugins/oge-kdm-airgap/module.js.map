{"version":3,"sources":["../src/module.js"],"names":["_","$","MetricsPanelCtrl","AirgapCircleCtrl","AirgapChartsCtrl","DatasourceUtil","panelDefaults","tabIndex","isCoaxial","bar","isAlignPhase","isShowOutline","isShowExtension","circle","canvasShow","JXYTC","ZZZXY","CJZSZ","JXCKY","DZCKY","ZZCKY","SZXBC","WHXBC","TDBJH","AirgapCtrl","$scope","$injector","$rootScope","$timeout","get","templateSrv","defaultsDeep","panel","ctrlCircle","ctrlCharts","events","on","onDataReceived","bind","onInitEditMode","onDataError","onRender","e","console","error","data","log","datasource","kdmUrl","currentTime","isEmpty","kksList","time","info","jz","replace","i","temp","kks","indexof","indexOf","substring","render","_render","elem","_dataReceived","then","scope","attrs","ctrl","obj","prop","isRender","index","dataType","kksInfo","getWaveDataByTime","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import './css/style.css!';\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport {\r\n  MetricsPanelCtrl\r\n}\r\nfrom 'app/plugins/sdk';\r\nimport AirgapCircleCtrl from './airgap_circle_ctrl.js';\r\nimport AirgapChartsCtrl from './airgap_charts_ctrl.js';\r\nimport DatasourceUtil from './datasource_util.js';\r\n\r\n\r\nvar panelDefaults = {\r\n  // 显示设置\r\n  tabIndex: 2, //显示哪一个标签页, 获取波形的什么数据\r\n  isCoaxial: false, //是否同轴\r\n  bar: {\r\n    isAlignPhase: false, //相位对齐\r\n    isShowOutline: false, //显示轮廓\r\n    isShowExtension: false //显示伸长\r\n  },\r\n  circle: {\r\n    canvasShow: {\r\n      JXYTC: true, //间隙圆填充（黄色块）\r\n      ZZZXY: true, //转子中心圆\r\n      CJZSZ: true, //磁极指示针\r\n      JXCKY: true, //间隙参考圆\r\n      DZCKY: true, //定子参考圆（外圈圆，青色）\r\n      ZZCKY: false, //转子参考圆（内圈圆，所有定子平均值，绿色）\r\n      SZXBC: true, //十字型标尺\r\n      WHXBC: true, //五环型标尺\r\n      TDBJH: true, //通道标记号\r\n    }\r\n  }\r\n}\r\n\r\nexport class AirgapCtrl extends MetricsPanelCtrl {\r\n  constructor($scope, $injector, $rootScope) {\r\n    super($scope, $injector);\r\n    this.$timeout = $injector.get('$timeout');\r\n    this.templateSrv = $injector.get('templateSrv');\r\n    _.defaultsDeep(this.panel, panelDefaults);\r\n\r\n    this.ctrlCircle = new AirgapCircleCtrl(this);\r\n    this.ctrlCharts = new AirgapChartsCtrl(this);\r\n\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    this.events.on('data-error', this.onDataError.bind(this));\r\n    this.events.on('render', this.onRender.bind(this));\r\n  }\r\n\r\n  onDataError(e) {\r\n    console.error(e);\r\n  }\r\n\r\n  onInitEditMode() {\r\n    // this.addEditorTab('Options','public/plugins/oge-kdm-airgap/editor.html', 2);\r\n  }\r\n\r\n  onDataReceived(data) {\r\n    console.log(\"onDataReceived.....\", data);\r\n\r\n    if (!this.datasource || !this.datasource.kdmUrl) {\r\n      console.error(\"数据源没有配置KDM地址,请选择正确的数据源\");\r\n      return;\r\n    }\r\n\r\n    if (!data || !data.currentTime || _.isEmpty(data.kksList)) {\r\n      this.time = null;\r\n      console.info(\"该时间段内没有波形数据!\");\r\n      return;\r\n    }\r\n\r\n    this.kksList = data.kksList;\r\n    //更换机组号\r\n    var jz = this.templateSrv.replace(\"$jz\");\r\n    if (jz !== \"$jz\") {\r\n      for (var i = 0; i < this.kksList; i++) {\r\n        var temp = this.kksList[i].kks;\r\n        if (temp) {\r\n          var indexof = temp.indexOf('HP', 1);\r\n          if (indexof !== -1) {\r\n            this.kksList[i].kks = temp.substring(0, indexof + 2) + jz + temp.substring(indexof + 3);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    this.time = data.currentTime;\r\n    this.render();\r\n  }\r\n\r\n  onRender() {\r\n    //气隙轮廓; 棒图\r\n    if (this.kksList) {\r\n      if (this.panel.tabIndex <= 1) {\r\n        this.ctrlCharts._render(this.elem);\r\n      } else {\r\n\r\n        this.ctrlCircle._dataReceived(this.kksList, this.time).then(data => {\r\n          this.ctrlCircle._render(this.elem);\r\n        });\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  link(scope, elem, attrs, ctrl) {\r\n    ctrl.elem = elem;\r\n  }\r\n\r\n  changeSwitch(obj, prop, isRender) {\r\n    obj[prop] = !obj[prop];\r\n    if (isRender) this.render();\r\n  }\r\n\r\n  //改变棒图的展示方式\r\n  changeWaveTab(index) {\r\n    this.panel.tabIndex = index;\r\n    this.render();\r\n  }\r\n\r\n  getWaveDataByTime(time, dataType, kksInfo) {\r\n    return DatasourceUtil.getWaveDataByTime(this.datasource, time, dataType,\r\n      kksInfo);\r\n  }\r\n\r\n}\r\n\r\nAirgapCtrl.templateUrl = 'module.html';\r\n\r\nexport {\r\n  AirgapCtrl as PanelCtrl\r\n};"]}