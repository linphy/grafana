{"version":3,"sources":["../src/datasource_util.js"],"names":["$","_","moment","DatasourceUtil","datasource","inputTime","dataType","kksInfo","formData","FormData","append","kks","kdmUrl","options","method","data","linkUser","linkPassword","url","promise","Promise","resolve","reject","getLoginStatus","then","request","body","relogin","error","num","unit","value","index","undefined","parseInt","toFixed","xAxisData","isShowLabel","i","length","xAxis","name","axisLabel","show","formatter","getFormatter","kksNameArr","isShowDatazoom","title","text","grid","left","top","bottom","right","tooltip","trigger","showDelay","axisPointer","type","lineStyle","width","zlevel","legend","z","orient","textStyle","color","dataZoom","handleSize","handleIcon","backgroundColor","fillerColor","showDataShadow","borderColor","handleStyle","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","keyPhaseOffsetData","keyPhaseOffsetIndex","push","y","series","symbol","symbolSize","itemStyle","normal"],"mappings":"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","file":"datasource_util.js","sourcesContent":["import $ from 'jquery';\r\nimport _ from 'lodash';\r\nimport moment from 'moment';\r\n\r\nexport default class DatasourceUtil {\r\n\r\n  static getWaveDataByTime(datasource, inputTime, dataType, kksInfo) {\r\n    if (inputTime === \"无效数据\") {\r\n      return null;\r\n    }\r\n    this.datasource = datasource;\r\n\r\n\r\n    let formData = new FormData();\r\n    formData.append(\"kksCodes\", kksInfo.kks ? kksInfo.kks : kksInfo)\r\n    formData.append(\"waveTime\", inputTime)\r\n    formData.append(\"waveType\", dataType)\r\n    formData.append(\"kdmUrl\", this.datasource.kdmUrl)\r\n    var options = {\r\n      method: 'POST',\r\n      data: formData\r\n    };\r\n\r\n\r\n    //如果连接的数据源地址为KDM Link地址\r\n    if (this.datasource.linkUser && this.datasource.linkPassword) {\r\n      options.url = this.datasource.url + '/rest/v1/data-points/wave/getAirgap';\r\n    } else\r\n      options.url = this.datasource.url + '/wave/getAirgap';\r\n\r\n\r\n    let promise = new Promise((resolve, reject) => {\r\n      this.datasource.getLoginStatus().then(data => {\r\n\r\n        this.datasource.request(options).then(body => {\r\n          if (body.data)\r\n            body.data.kksInfo = kksInfo;\r\n          resolve(body.data);\r\n        }, error => {\r\n          this.datasource.relogin(error, options).then(body => {\r\n            if (body.data)\r\n              body.data.kksInfo = kksInfo;\r\n            resolve(body.data)\r\n          }, error => reject(error));\r\n        });\r\n      })\r\n    });\r\n    return promise;\r\n  }\r\n\r\n\r\n  static getFormatter(num, unit) {\r\n    return function (value, index) {\r\n      if (value == undefined) {\r\n        return \"\";\r\n      }\r\n      if (value == 0 || value == parseInt(value)) {\r\n        return value;\r\n      }\r\n      if (unit == null) {\r\n        unit = \"\";\r\n      }\r\n      if (num == 0) {\r\n        return parseInt(value) + unit;\r\n      }\r\n      return value.toFixed(num) + unit;\r\n    }\r\n  }\r\n\r\n\r\n  static getXAxis(xAxisData, isShowLabel, dataType) {\r\n    if (dataType == 1) { //棒图\r\n      for (var i = 0; i < xAxisData.length; i++) {\r\n        xAxisData[i] = (i + 1) + \"#\";\r\n      }\r\n    }\r\n\r\n    var xAxis = {\r\n      data: xAxisData,\r\n      name: \"时间\",\r\n      axisLabel: {\r\n        show: false\r\n      }\r\n    };\r\n\r\n    if (isShowLabel) {\r\n      xAxis.axisLabel.show = true;\r\n      if (dataType == 0) {\r\n        xAxis.axisLabel.formatter = DatasourceUtil.getFormatter(2, \"s\");\r\n      }\r\n    }\r\n\r\n    return xAxis;\r\n  }\r\n\r\n  static getChartDefaults(kksNameArr, isShowDatazoom) {\r\n    return {\r\n      title: {\r\n        text: '气隙',\r\n        show: false\r\n      },\r\n      grid: {\r\n        left: 40,\r\n        top: 5,\r\n        bottom: 30,\r\n        right: 8\r\n      },\r\n      tooltip: {\r\n        trigger: 'axis',\r\n        showDelay: 0,\r\n        axisPointer: {\r\n          show: true,\r\n          type: 'line',\r\n          lineStyle: {\r\n            type: 'dashed',\r\n            width: 2\r\n          }\r\n        },\r\n        zlevel: 1\r\n      },\r\n      legend: {\r\n        data: kksNameArr,\r\n        right: \"0px\",\r\n        top: \"0px\",\r\n        z: 3,\r\n        orient: \"horizontal\",\r\n        textStyle: {\r\n          color: \"white\" //图例字体颜色\r\n        }\r\n      },\r\n      textStyle: {\r\n        color: \"white\"\r\n      },\r\n      dataZoom: [{\r\n        show: isShowDatazoom,\r\n        handleSize: '80%',\r\n        handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',\r\n        backgroundColor: 'transparent',\r\n        fillerColor: 'rgba(0,0,0,0.4)',\r\n        showDataShadow: false,\r\n        borderColor: 'transparent',\r\n        bottom: 0,\r\n        handleStyle: {\r\n          color: 'rgba(255,255,255,0.7)',\r\n          shadowBlur: 3,\r\n          shadowColor: 'rgba(0, 0, 0, 0.6)',\r\n          shadowOffsetX: 2,\r\n          shadowOffsetY: 2\r\n        }\r\n      }]\r\n    };\r\n  }\r\n\r\n  static getKeyPhaseSeries(data) {\r\n    var keyPhaseOffsetData = [];\r\n    var keyPhaseOffsetIndex = data.keyPhaseOffsetIndex;\r\n    for (var i = 0; i < keyPhaseOffsetIndex.length; i++) {\r\n      keyPhaseOffsetData.push([keyPhaseOffsetIndex[i], data.y[\r\n        keyPhaseOffsetIndex[i]]]);\r\n    }\r\n    var series = {\r\n      name: '键相',\r\n      symbol: \"circle\", //键相显示方式,\r\n      data: keyPhaseOffsetData,\r\n      type: 'scatter',\r\n      symbolSize: 5,\r\n      itemStyle: {\r\n        normal: {\r\n          color: \"white\"\r\n        }\r\n      } //键相全部显示白色\r\n    }\r\n    return series;\r\n  }\r\n\r\n}"]}