{"version":3,"sources":["../src/airgap_circle_ctrl.js"],"names":["$","_","AirgapCirclePainter","AirgapCircleCtrl","ctrl","time","kksList","data","style","size","info","waves","current","JXJD","CJBH","CJJD","JSQX","rotor","BYD","PXL","PXJ","character","CLZXQX","CLZXCJBH","JSZXQXFW","CLZDQX","CLZDCJBH","JSZDQXFW","canvases","name","description","Promise","resolve","reject","isEmpty","kksCodes","i","length","push","kks","all","getWaveDataByTime","join","then","y","catch","error","elem","$cd","find","$cdv","parent","min","width","height","painter","draw","$timeout","prevIndex","infoCurrent","nextIndex","prevRotor","nextRotor","canvasShow","panel","isArray","each","n"],"mappings":"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","file":"airgap_circle_ctrl.js","sourcesContent":["import $ from 'jquery';\r\nimport _ from 'lodash';\r\nimport AirgapCirclePainter from './airgap_circle_painter.js';\r\n\r\nexport default class AirgapCircleCtrl {\r\n  constructor(ctrl) {\r\n    // ctrl\r\n    this.ctrl = ctrl;\r\n\r\n    // data\r\n    this.time = null;\r\n    this.kksList = null;\r\n    this.data = null;\r\n    this.style = {\r\n      size: 0\r\n    };\r\n\r\n    // view\r\n    this.info = {\r\n      waves: [],\r\n      current: { // 当前测点\r\n        JXJD: null, // 间相角度\r\n        CJBH: null, // 磁极编号\r\n        CJJD: null, // 磁极角度\r\n        JSQX: null, // 计算气隙\r\n      },\r\n      rotor: { // 转子信息\r\n        BYD: null, // 不圆度\r\n        PXL: null, // 偏心量\r\n        PXJ: null, // 偏心角\r\n      },\r\n      character: { // 特征信息\r\n        CLZXQX: null, // 测量最小气隙\r\n        CLZXCJBH: null, // 测量最小磁极编号\r\n        JSZXQXFW: null, // 计算最小气隙方位\r\n        CLZDQX: null, // 测量最大气隙\r\n        CLZDCJBH: null, // 测量最大磁极编号\r\n        JSZDQXFW: null, // 计算最大气隙方位\r\n      }\r\n    };\r\n\r\n    this.canvases = [{\r\n        name: \"JXYTC\",\r\n        description: \"间隙圆填充\"\r\n      },\r\n      {\r\n        name: \"ZZZXY\",\r\n        description: \"转子中心圆\"\r\n      },\r\n      {\r\n        name: \"CJZSZ\",\r\n        description: \"磁极指示针\"\r\n      },\r\n      {\r\n        name: \"JXCKY\",\r\n        description: \"间隙参考圆\"\r\n      },\r\n      {\r\n        name: \"DZCKY\",\r\n        description: \"定子参考圆\"\r\n      },\r\n      {\r\n        name: \"ZZCKY\",\r\n        description: \"转子参考圆\"\r\n      },\r\n      {\r\n        name: \"SZXBC\",\r\n        description: \"十字型标尺\"\r\n      },\r\n      {\r\n        name: \"WHXBC\",\r\n        description: \"五环型标尺\"\r\n      },\r\n      {\r\n        name: \"TDBJH\",\r\n        description: \"通道标记号\"\r\n      }\r\n    ];\r\n  }\r\n\r\n  _dataReceived(kksList, time) {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      if (!_.isEmpty(this.data) && time == this.time && _.isEmpty(kksList,\r\n          this.kksList)) {\r\n        resolve([\"AirgapCircleCtrl_dataReceived: 使用缓存数据\"]);\r\n        return;\r\n      }\r\n\r\n      let kksCodes = [];\r\n      for (let i = 0; i < kksList.length; i++) {\r\n        kksCodes.push(kksList[i].kks)\r\n      }\r\n\r\n      Promise.all([this.ctrl.getWaveDataByTime(time, 2, kksCodes.join(\",\")), this\r\n          .ctrl.getWaveDataByTime(time, 3,kksCodes.join(\",\"))\r\n        ])\r\n        .then(data => {\r\n          if (!data || !data.length || !data[0] || !data[1]) {\r\n            reject([\"getWaveDataByTime 获取数据不正确\", data]);\r\n          }\r\n\r\n          this.data = {\r\n            \"airgapData\": data[1].y ? data[1] : data[0],\r\n            \"yData\": data[1].y ? data[1].y : data[0].y\r\n          }\r\n\r\n          this.time = time;\r\n          this.kksList = kksList;\r\n          resolve([\"getWaveDataByTime 获取数据成功\"]);\r\n        }).catch(error => {\r\n          reject([\"getWaveDataByTime 获取数据异常\", error]);\r\n        });\r\n    });\r\n  }\r\n\r\n  _render(elem) {\r\n\r\n    var $cd = elem.find('.data-panel-circle');\r\n    var $cdv = $cd.parent();\r\n\r\n    var size = _.min([elem.parent().width() - 22, (this.ctrl.height >= 550 ? this.ctrl.height : 550) - 78]);\r\n    this.style.size = size;\r\n\r\n    if (_.isEmpty(this.kksList)) return;\r\n\r\n    this.painter = new AirgapCirclePainter($cd, size, this.kksList, {});\r\n    this.painter.draw(this.data);\r\n    this.ctrl.$timeout(() => {\r\n      this.painter.info(this.info);\r\n    });\r\n  }\r\n\r\n  prevIndex() {\r\n    if (this.painter) {\r\n      this.painter.prevIndex();\r\n      this.painter.infoCurrent(this.info.current);\r\n    }\r\n  }\r\n  nextIndex() {\r\n    if (this.painter) {\r\n      this.painter.nextIndex();\r\n      this.painter.infoCurrent(this.info.current);\r\n    }\r\n  }\r\n  prevRotor() {\r\n    if (this.painter) {\r\n      this.painter.prevRotor();\r\n      this.painter.infoCurrent(this.info.current);\r\n    }\r\n  }\r\n  nextRotor() {\r\n    if (this.painter) {\r\n      this.painter.nextRotor();\r\n      this.painter.infoCurrent(this.info.current);\r\n    }\r\n  }\r\n  switchShow(name) {\r\n    var canvasShow = this.ctrl.panel.canvasShow;\r\n    if (!_.isArray(name)) {\r\n      canvasShow[name] = !canvasShow[name];\r\n      return;\r\n    }\r\n    _.each(name, n => {\r\n      canvasShow[n] = !canvasShow[n];\r\n    })\r\n  }\r\n}"]}