{"version":3,"sources":["../src/worldmap.js"],"names":["_","L","kbn","tileServers","url","attribution","subdomains","WorldMap","ctrl","mapContainer","createMap","circles","that","panel","thePositronUrl","theDarkUrl","mapCenter","window","latLng","parseFloat","mapCenterLatitude","mapCenterLongitude","map","worldCopyJump","center","fitWorld","zoomIn","parseInt","initialZoom","panTo","selectedTileServer","tileServer","tileLayer","maxZoom","reuseTiles","detectRetina","addTo","legend","control","position","onAdd","_div","DomUtil","create","update","thresholds","data","legendHtml","colors","index","length","getColor","innerHTML","locations","sort","dataPoints","isEqual","filter","o","hideEmpty","isNil","value","hideZero","circlesLayer","clearLayers","removeCircles","filterEmptyAndZeroValues","needToRedrawCircles","clearCircles","createCircles","updateCircles","forEach","dataPoint","locationName","push","createCircle","addCircles","circle","find","cir","options","location","key","setRadius","calcCircleSize","setStyle","color","fillColor","fillOpacity","unbindPopup","createPopup","valueRounded","clickTrun","circleMarker","locationLatitude","locationLongitude","radius","dataPointValue","circleMinSize","circleMaxSize","valueRange","dataFactor","lowestValue","circleSizeRange","unit","unitSingular","unitPlural","label","trim","bindPopup","point","stickyLabels","on","onMouseOver","evt","layer","target","bringToFront","openPopup","onMouseOut","closePopup","onClickDown","i","deciEveryUrl","currentPoint","regexOne","stringToJsRegex","dataTypeOne","theUseName","j","dataList","datapoints","match","link","type","dashUri","undefined","str","wordCut","reg","eval","theUrlRegex","arr","exec","inputParams","paramsOne","exceParams","paramsReplace","n","ind","text","toUpperCase","replace","params","theTemplates","templateSrv","variables","linkInfo","linkSrv","getPanelLinkAnchorInfo","paramsNum","href","indexOf","paramsNew","theTemplatesSectences","open","first","invalidateSize","mapCenterMoved","removeFrom","layerGroup","removeLayer","zoomFactor","setZoom","removeLegend","remove"],"mappings":"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","file":"worldmap.js","sourcesContent":["import _ from 'lodash';\r\n/* eslint-disable id-length, no-unused-vars */\r\nimport L from './libs/leaflet';\r\n/* eslint-disable id-length, no-unused-vars */\r\nimport kbn from 'app/core/utils/kbn';\r\n\r\nconst tileServers = {\r\n  'CartoDB Dark': {url: 'http://10.1.128.3:8088/styles/dark-matter/{z}/{x}/{y}.png', attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>', subdomains: 'abcd'},\r\n  'CartoDB Positron': { url: 'http://10.1.128.3:8088/styles/dark-matter/{z}/{x}/{y}.png', attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>', subdomains: 'abcd'}\r\n};\r\nvar that;\r\nexport default class WorldMap {\r\n  constructor(ctrl, mapContainer) {\r\n    this.ctrl = ctrl;\r\n    this.mapContainer = mapContainer;\r\n    this.createMap();\r\n    this.circles = [];\r\n    that = this;\r\n  }\r\n\r\n  createMap() {\r\n    if (this.ctrl.panel.thePositronUrl) {\r\n      tileServers['CartoDB Positron'].url = this.ctrl.panel.thePositronUrl;\r\n    }\r\n    if (this.ctrl.panel.theDarkUrl) {\r\n      tileServers['CartoDB Dark'].url = this.ctrl.panel.theDarkUrl;\r\n    }\r\n    const mapCenter = window.L.latLng(parseFloat(this.ctrl.panel.mapCenterLatitude), parseFloat(this.ctrl.panel.mapCenterLongitude));\r\n    this.map = window.L.map(this.mapContainer, {worldCopyJump: true, center: mapCenter})\r\n      .fitWorld()\r\n      .zoomIn(parseInt(this.ctrl.panel.initialZoom, 10));\r\n    this.map.panTo(mapCenter);\r\n\r\n    const selectedTileServer = tileServers[this.ctrl.tileServer];\r\n    window.L.tileLayer(selectedTileServer.url, {\r\n      maxZoom: 18,\r\n      subdomains: selectedTileServer.subdomains,\r\n      reuseTiles: true,\r\n      detectRetina: true\r\n      // attribution: selectedTileServer.attribution\r\n    }).addTo(this.map);\r\n  }\r\n\r\n  createLegend() {\r\n    this.legend = window.L.control({position: 'bottomleft'});\r\n    this.legend.onAdd = () => {\r\n      this.legend._div = window.L.DomUtil.create('div', 'info legend');\r\n      this.legend.update();\r\n      return this.legend._div;\r\n    };\r\n\r\n    this.legend.update = () => {\r\n      const thresholds = this.ctrl.data.thresholds;\r\n      let legendHtml = '';\r\n      legendHtml += '<i style=\"background:' + this.ctrl.panel.colors[0] + '\"></i> ' +\r\n          '&lt; ' + thresholds[0] + '<br>';\r\n      for (let index = 0; index < thresholds.length; index += 1) {\r\n        legendHtml +=\r\n          '<i style=\"background:' + this.getColor(thresholds[index] + 1) + '\"></i> ' +\r\n          thresholds[index] + (thresholds[index + 1] ? '&ndash;' + thresholds[index + 1] + '<br>' : '+');\r\n      }\r\n      this.legend._div.innerHTML = legendHtml;\r\n    };\r\n    this.legend.addTo(this.map);\r\n  }\r\n\r\n  needToRedrawCircles(data) {\r\n    if (this.circles.length === 0 && data.length > 0) return true;\r\n\r\n    if (this.circles.length !== data.length) return true;\r\n    const locations = _.map(_.map(this.circles, 'options'), 'location').sort();\r\n    const dataPoints = _.map(data, 'key').sort();\r\n    return !_.isEqual(locations, dataPoints);\r\n  }\r\n\r\n  filterEmptyAndZeroValues(data) {\r\n    return _.filter(data, (o) => { return !(this.ctrl.panel.hideEmpty && _.isNil(o.value)) && !(this.ctrl.panel.hideZero && o.value === 0); });\r\n  }\r\n\r\n  clearCircles() {\r\n    if (this.circlesLayer) {\r\n      this.circlesLayer.clearLayers();\r\n      this.removeCircles(this.circlesLayer);\r\n      this.circles = [];\r\n    }\r\n  }\r\n\r\n  drawCircles() {\r\n    const data = this.filterEmptyAndZeroValues(this.ctrl.data);\r\n    if (this.needToRedrawCircles(data)) {\r\n      this.clearCircles();\r\n      this.createCircles(data);\r\n    } else {\r\n      this.updateCircles(data);\r\n    }\r\n  }\r\n\r\n  createCircles(data) {\r\n    const circles = [];\r\n    data.forEach((dataPoint) => {\r\n      if (!dataPoint.locationName) return;\r\n      circles.push(this.createCircle(dataPoint));\r\n    });\r\n    this.circlesLayer = this.addCircles(circles);\r\n    this.circles = circles;\r\n  }\r\n\r\n  updateCircles(data) {\r\n    data.forEach((dataPoint) => {\r\n      if (!dataPoint.locationName) return;\r\n\r\n      const circle = _.find(this.circles, (cir) => { return cir.options.location === dataPoint.key; });\r\n\r\n      if (circle) {\r\n        circle.setRadius(this.calcCircleSize(dataPoint.value || 0));\r\n        circle.setStyle({\r\n          color: this.getColor(dataPoint.value),\r\n          fillColor: this.getColor(dataPoint.value),\r\n          fillOpacity: 0.5,\r\n          location: dataPoint.key,\r\n        });\r\n        circle.unbindPopup();\r\n        this.createPopup(circle, dataPoint.locationName, dataPoint.valueRounded);\r\n        this.clickTrun(circle);\r\n      }\r\n    });\r\n  }\r\n\r\n  createCircle(dataPoint) {\r\n    const circle = window.L.circleMarker([dataPoint.locationLatitude, dataPoint.locationLongitude], {\r\n      radius: this.calcCircleSize(dataPoint.value || 0),\r\n      color: this.getColor(dataPoint.value),\r\n      fillColor: this.getColor(dataPoint.value),\r\n      fillOpacity: 0.5,\r\n      location: dataPoint.key\r\n    });\r\n\r\n    this.createPopup(circle, dataPoint.locationName, dataPoint.valueRounded);\r\n    this.clickTrun(circle);\r\n    return circle;\r\n  }\r\n\r\n  calcCircleSize(dataPointValue) {\r\n    const circleMinSize = parseInt(this.ctrl.panel.circleMinSize, 10) || 2;\r\n    const circleMaxSize = parseInt(this.ctrl.panel.circleMaxSize, 10) || 30;\r\n\r\n    if (this.ctrl.data.valueRange === 0) {\r\n      return circleMaxSize;\r\n    }\r\n\r\n    const dataFactor = (dataPointValue - this.ctrl.data.lowestValue) / this.ctrl.data.valueRange;\r\n    const circleSizeRange = circleMaxSize - circleMinSize;\r\n\r\n    return (circleSizeRange * dataFactor) + circleMinSize;\r\n  }\r\n\r\n  createPopup(circle, locationName, value) {\r\n    const unit = value && value === 1 ? this.ctrl.panel.unitSingular : this.ctrl.panel.unitPlural;\r\n    const label = (locationName + ': ' + value + ' ' + (unit || '')).trim();\r\n    circle.bindPopup(label, {'offset': window.L.point(0, -2), 'className': 'worldmap-popup', 'closeButton': this.ctrl.panel.stickyLabels});\r\n\r\n    circle.on('mouseover', function onMouseOver(evt) {\r\n      const layer = evt.target;\r\n      layer.bringToFront();\r\n      this.openPopup();\r\n    });\r\n\r\n    if (!this.ctrl.panel.stickyLabels) {\r\n      circle.on('mouseout', function onMouseOut() {\r\n        circle.closePopup();\r\n      });\r\n    }\r\n  }\r\n  clickTrun(circle) {\r\n    circle.on('click', function onClickDown() {\r\n      for (let i = 0; i < that.ctrl.panel.deciEveryUrl.length; i++) {\r\n        if (that.ctrl.panel.deciEveryUrl[i].currentPoint) {\r\n          var regexOne = kbn.stringToJsRegex(that.ctrl.panel.deciEveryUrl[i].currentPoint);\r\n          var dataTypeOne = that.ctrl.panel.deciEveryUrl[i].theUseName;\r\n          for (let j = 0; j < that.ctrl.dataList[0].datapoints.length;j++) {\r\n            if (that.ctrl.dataList[0].datapoints[j][dataTypeOne].match(regexOne)) {\r\n              if (circle.options.location === that.ctrl.dataList[0].datapoints[j].location) {\r\n                if (that.ctrl.panel.deciEveryUrl[i].link.type && (that.ctrl.panel.deciEveryUrl[i].link.type === 'dashboard')) {\r\n                  if (that.ctrl.panel.deciEveryUrl[i].link.dashUri === undefined || that.ctrl.panel.deciEveryUrl[i].link.dashUri === '') {\r\n                    that.ctrl.panel.deciEveryUrl[i].link.url = '';\r\n                    return;\r\n                  }\r\n                } else if (that.ctrl.panel.deciEveryUrl[i].link.type && (that.ctrl.panel.deciEveryUrl[i].link.type === 'absolute')) {\r\n                  if (that.ctrl.panel.deciEveryUrl[i].link.url === undefined || that.ctrl.panel.deciEveryUrl[i].link.url === '') {\r\n                    that.ctrl.panel.deciEveryUrl[i].link.dashUri = '';\r\n                    return;\r\n                  }\r\n                }\r\n                var str;\r\n                var wordCut = that.ctrl.panel.deciEveryUrl[i].wordCut;\r\n                var reg = eval(that.ctrl.panel.deciEveryUrl[i].theUrlRegex);\r\n                var arr;\r\n                if ((reg === undefined) || (that.ctrl.data.length === 0) || !that.ctrl.dataList[0].datapoints[j][wordCut]) {\r\n                  arr = [];\r\n                } else {\r\n                  //有问题，正则验证的是什么\r\n                  str = that.ctrl.dataList[0].datapoints[j][wordCut];\r\n                  arr = reg.exec(str);\r\n                }\r\n                var inputParams = that.ctrl.panel.deciEveryUrl[i].link.paramsOne;\r\n                var exceParams = [];\r\n                let paramsReplace;\r\n                exceParams[0] = inputParams;\r\n                if((inputParams === '') || (arr === null) || (arr.length === 0)) {\r\n                } else {\r\n                  for (var n = 0;n < arr.length; n++) {\r\n                    var ind = n + 1;\r\n                    var text = '$' + ind;\r\n                    if (arr[ind] === undefined) {\r\n                    } else {\r\n                      paramsReplace = arr[ind].toUpperCase();\r\n                    }        \r\n                    exceParams[n+1] = exceParams[n].replace(text, paramsReplace);\r\n                  }\r\n                  that.ctrl.panel.deciEveryUrl[i].link.params = exceParams[n];\r\n                }\r\n                var theTemplates = that.ctrl.templateSrv.variables;\r\n                var linkInfo = that.ctrl.linkSrv.getPanelLinkAnchorInfo(that.ctrl.panel.deciEveryUrl[i].link, theTemplates);\r\n                var paramsNum = linkInfo.href.indexOf('?');\r\n                var paramsNew = '';\r\n                var theTemplatesSectences = '';\r\n                if (paramsNum !== -1) {\r\n                  if (linkInfo.href.length - paramsNum > 1) {\r\n                    paramsNew = '&';\r\n                  }\r\n                } else {\r\n                  paramsNew = '?';\r\n                }\r\n                window.open( linkInfo.href + paramsNew, linkInfo.target);\r\n              }\r\n            }\r\n          }\r\n        } else {\r\n\r\n        }\r\n      }\r\n    })\r\n  }\r\n  getColor(value) {\r\n    for (let index = this.ctrl.data.thresholds.length; index > 0; index -= 1) {\r\n      if (value >= this.ctrl.data.thresholds[index - 1]) {\r\n        return this.ctrl.panel.colors[index];\r\n      }\r\n    }\r\n    return _.first(this.ctrl.panel.colors);\r\n  }\r\n\r\n  resize() {\r\n    this.map.invalidateSize();\r\n  }\r\n\r\n  panToMapCenter() {\r\n    this.map.panTo([parseFloat(this.ctrl.panel.mapCenterLatitude), parseFloat(this.ctrl.panel.mapCenterLongitude)]);\r\n    this.ctrl.mapCenterMoved = false;\r\n  }\r\n\r\n  removeLegend() {\r\n    this.legend.removeFrom(this.map);\r\n    this.legend = null;\r\n  }\r\n\r\n  addCircles(circles) {\r\n    return window.L.layerGroup(circles).addTo(this.map);\r\n  }\r\n\r\n  removeCircles() {\r\n    this.map.removeLayer(this.circlesLayer);\r\n  }\r\n\r\n  setZoom(zoomFactor) {\r\n    this.map.setZoom(parseInt(zoomFactor, 10));\r\n  }\r\n\r\n  remove() {\r\n    this.circles = [];\r\n    if (this.circlesLayer) this.removeCircles();\r\n    if (this.legend) this.removeLegend();\r\n    this.map.remove();\r\n  }\r\n}\r\n"]}