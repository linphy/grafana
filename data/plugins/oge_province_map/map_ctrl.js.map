{"version":3,"sources":["../../src/map_ctrl.js"],"names":["MetricsPanelCtrl","_","$","echarts","panelOptionDefaults","bgColor","province","points","sourceP","description","link","url","targetBlank","currentName","currentJson","pointStyle","showLabel","labelColor","areaColor","borderColor","emShowLabel","emLabelColor","emAreaColor","emBorderColor","symbolStyle","symbolSize","symbolColor","emSymbolColor","loadPoint","sourcePonits","columns","ProvinceMapPanelCtrl","$scope","$injector","templateSrv","defaults","panel","cityMap","symbol","name","value","mapElem","data","events","on","onInitEditMode","bind","onDataReceived","onRender","addEditorTab","dataList","rows","i","length","push","text","changeSourcePoint","changeProvince","render","row","obj","sourcePoint","replaceVariable","str","sourcePNoVar","replace","match","key","indexOf","trim","replaceWithText","that","initChart","get","mapJson","registerAndsetOption","myChart","dispose","init","find","param","componentType","cityId","bool","currentBool","newPonits","concat","filter","item","parseFloat","toString","registerMap","setOption","backgroundColor","tooltip","trigger","formatter","params","legend","selectedMode","geo","map","itemStyle","normal","borderWidth","emphasis","roam","label","show","color","series","type","coordinateSystem","resize","addImage","innerHTML","position","convertToPixel","newDiv","document","createElement","style","backgroundImage","backgroundRepeat","backgroundSize","href","target","descriP","textContent","display","addEventListener","appendChild","index","splice","changeScatterData","point","window","open","scope","elem","attrs","ctrl","templateUrl"],"mappings":"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","file":"map_ctrl.js","sourcesContent":["import {\r\n\tMetricsPanelCtrl\r\n}\r\nfrom 'app/plugins/sdk';\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport './css/map-panel.css!';\r\nimport echarts from './libs/echarts';\r\n\r\nvar panelOptionDefaults = {\r\n\tbgColor:'#404a59',\r\n\tprovince: 'china',\r\n\tpoints: [],\r\n\tsourceP: {\r\n\t\tdescription: '',\r\n\t\tlink:{\r\n\t\t\turl: '',\r\n\t\t\ttargetBlank: true\r\n\t\t}\r\n\t},\r\n\tcurrentName:'',\r\n\tcurrentJson:'',\r\n\tpointStyle:'',\r\n\tshowLabel: true,\r\n\tlabelColor: '#ccc',\r\n\tareaColor: '#323c48',\r\n\tborderColor: '#111',\r\n\temShowLabel: true,\r\n\temLabelColor: '#ccc',\r\n\temAreaColor: '#2a333d',\r\n\temBorderColor: '#2a333d',\r\n\tsymbolStyle: 'pin',\r\n\tsymbolSize: 20,\r\n\tsymbolColor: 'blue',\r\n\temSymbolColor:'blue'\r\n};\r\nvar myChart;\r\nvar loadPoint = false;\r\nvar sourcePonits = [];\r\nvar columns = [];\r\nexport class ProvinceMapPanelCtrl extends MetricsPanelCtrl {\r\n\r\n\t/** @ngInject */\r\n\tconstructor($scope, $injector, templateSrv) {\r\n\t\tsuper($scope, $injector);\r\n\t\tthis.templateSrv = templateSrv;\r\n\t\t_.defaults(this.panel, panelOptionDefaults);\r\n\t\tthis.cityMap= {\r\n\t\t\t\"全国\":\"china\",\r\n\t\t\t\"安徽\": \"340000\",\r\n\t\t\t\"澳门\": '820000',\r\n\t\t\t\"北京\": '110000',\r\n\t\t\t\"重庆\":'500000',\r\n\t\t\t\"福建\": '350000',\r\n\t\t\t\"甘肃\": '620000',\r\n\t\t\t\"广东\": '440000',\r\n\t\t\t\"广西\": \"450000\",\r\n\t\t\t\"贵州\": '520000',\r\n\t\t\t\"海南\": '460000',\r\n\t\t\t\"河北\": '130000',\r\n\t\t\t\"黑龙江\": '230000',\r\n\t\t\t\"河南\": '410000',\r\n\t\t\t\"湖北\": '420000',\r\n\t\t\t\"湖南\": '430000',\r\n\t\t\t\"江苏\": '320000',\r\n\t\t\t\"江西\": '360000',\r\n\t\t\t\"吉林\": '220000',\r\n\t\t\t\"辽宁\": '210000',\r\n\t\t\t\"内蒙古\": '150000',\r\n\t\t\t\"宁夏\": '640000',\r\n\t\t\t\"青海\": '630000',\r\n\t\t\t\"山东\": '370000',\r\n\t\t\t\"上海\": '310000',\r\n\t\t\t\"山西\": '140000',\r\n\t\t\t\"四川\": '510000',\r\n\t\t\t\"台湾\": '710000',\r\n\t\t\t\"天津\": '120000',\r\n\t\t\t\"新疆\": '650000',\r\n\t\t\t\"陕西\": '610000',\r\n\t\t\t\"西藏\": '540000',\r\n\t\t\t\"云南\": '530000',\r\n\t\t\t\"浙江\": '330000',\r\n\t\t\t\"香港\": '810000'\r\n\t\t};\r\n\t\tthis.symbol = [\r\n\t\t\t{name:'圆形', value:'circle'}, \r\n\t\t\t{name:'矩形', value:'rect'}, \r\n\t\t\t{name:'圆角矩形', value:'roundRect'},\r\n\t\t\t{name:'三角形', value:'triangle'},\r\n\t\t\t{name:'菱形', value:'diamond'},\r\n\t\t\t{name:'钉形', value:'pin'},\r\n\t\t\t{name:'箭头', value:'arrow'},\r\n\t\t\t{name:'自定义',value:'none'}\r\n\t\t];\r\n\t\tthis.mapElem = [];\r\n\t\tthis.data= [];\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('render', this.onRender.bind(this));\r\n\r\n\t}\r\n\r\n\tonInitEditMode() {\r\n\t\tthis.addEditorTab('Options',\r\n\t\t\t'public/plugins/oge_province_map/editor.html', 2);\r\n\t}\r\n\r\n\tonDataReceived(dataList) {\r\n\t\tif (dataList && dataList[0] && dataList[0].rows) {\r\n\t\t\tthis.data = dataList[0];\r\n\t\t\tcolumns = [];\r\n\t\t\tfor(let i=0; i<this.data.columns.length; i++) {\r\n\t\t\t\tcolumns.push(this.data.columns[i].text)\r\n\t\t\t}\r\n\t\t\tthis.changeSourcePoint();\r\n\t\t}\r\n\t\tthis.changeProvince();\r\n\t\tloadPoint = false;\r\n\t\tthis.render();\r\n\t}\r\n\tchangeSourcePoint() {\r\n\t\tsourcePonits = [];\r\n\t\tfor (let i=0;i<this.data.rows.length;i++) {\r\n\t\t\tlet row = this.data.rows[i];\r\n\t\t\tlet obj= {\r\n\t\t\t\tname: row[0],\r\n\t\t\t\tvalue: [row[1]-0, row[2]-0],\r\n\t\t\t\tsourcePoint: true,\r\n\t\t\t\tdescription: this.replaceVariable(this.panel.sourceP.description,row),\r\n\t\t\t\tlink:{\r\n\t\t\t\t\turl: this.replaceVariable(this.panel.sourceP.link.url,row),\r\n\t\t\t\t\ttargetBlank: this.panel.sourceP.link.targetBlank\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tsourcePonits.push(obj);\r\n\t\t}\r\n\t}\r\n\r\n\treplaceVariable (str,row) {\r\n\t\tlet sourcePNoVar = str.replace(/\\$\\{(.*?)\\}/g, (match, key) => columns.indexOf(key.trim())>-1?row[columns.indexOf(key.trim())]:'');\r\n\t\tsourcePNoVar = this.templateSrv.replaceWithText(sourcePNoVar, null);\r\n\t\tlet text = sourcePNoVar.replace(/\\#/g, \"%23\");\r\n\t\treturn text;\r\n\t}\r\n\r\n\tchangeProvince (key) {\r\n\t\tlet that = this;\r\n\t\tthis.initChart ();\r\n\t\tif (this.panel.province === 'china') {\r\n\t\t\t$.get('./public/plugins/oge_province_map/libs/json/china.json', function (mapJson) {\r\n\t\t\t\tthat.registerAndsetOption(myChart, 'china', mapJson, true);\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\t$.get('./public/plugins/oge_province_map/libs/json/province/' + this.panel.province + '.json', function (mapJson) {\r\n\t\t\t\tthat.registerAndsetOption(myChart, key, mapJson, false);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tinitChart () {\r\n\t\tlet that = this;\r\n\t\tif (myChart) {\r\n\t\t\tmyChart.dispose();\r\n\t\t}\r\n\t\tmyChart = echarts.init(this.mapElem.find('.chinamain')[0]);\r\n\t\tmyChart.on('click', function (param) {\r\n\t\t\tif (param && param.componentType === 'geo') {\r\n\t\t\t\tvar cityId = that.cityMap[param.name];\r\n\t\t\t\tif (cityId) {//代表有下级地图\r\n\t\t\t\t\t$.get('./public/plugins/oge_province_map/libs/json/province/' + cityId + '.json', function (mapJson) {\r\n\t\t\t\t\t\tthat.registerAndsetOption(myChart, param.name, mapJson, false);\r\n\t\t\t\t\t\tthat.panel.province = cityId;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthat.url(param);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\tregisterAndsetOption(myChart, name, mapJson, bool) {\r\n\t\tlet that = this;\r\n\t\tthis.panel.currentName = name?name:this.panel.currentName;\r\n\t\tthis.panel.currentJson = mapJson?mapJson:this.panel.currentJson;\r\n\t\tthis.panel.currentBool = bool?bool:this.panel.currentBool;\r\n\t\tlet newPonits = (that.panel.points.concat(sourcePonits)).filter(item=>{\r\n\t\t\treturn item.name && item.value && (parseFloat(item.value[0]).toString() != \"NaN\") && (parseFloat(item.value[1]).toString() != \"NaN\")\r\n\t\t})\r\n\t\techarts.registerMap(name, mapJson);\r\n\t\tmyChart.setOption({\r\n\t\t\tbackgroundColor: that.panel.bgColor,\r\n\t\t\ttooltip: {\r\n\t\t\t\ttrigger: 'item',\r\n\t\t\t\tformatter: function (params) {\r\n\t\t\t\t\treturn params.data.description?params.name+':'+params.data.description:params.name;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tlegend: {\r\n\t\t\t  \tselectedMode: bool\r\n\t\t\t},\r\n\t\t\tgeo: {\r\n\t\t\t\tmap: name,\r\n\t\t\t\titemStyle: {\r\n\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\tareaColor: that.panel.areaColor,\r\n\t\t\t\t\t\tborderColor: that.panel.borderColor,\r\n\t\t\t\t\t\tborderWidth: 1,\r\n\t\t\t\t\t},\r\n\t\t\t\t\temphasis: {\r\n\t\t\t\t\t\tareaColor: that.panel.emAreaColor,\r\n\t\t\t\t\t\tborderColor: that.panel.emBorderColor,\r\n\t\t\t\t\t\tborderWidth: 1,\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\troam: true,  //是否开启鼠标缩放和平移漫游\r\n\t\t\t\tlabel: {\r\n\t\t\t\t\tnormal:{\r\n\t\t\t\t\t\tshow: that.panel.showLabel,\r\n\t\t\t\t\t\tcolor: that.panel.labelColor\r\n\t\t\t\t\t},\r\n\t\t\t\t\temphasis: {\r\n\t\t\t\t\t\tshow: that.panel.emShowLabel,\r\n\t\t\t\t\t\tcolor: that.panel.emLabelColor\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tseries: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: '',\r\n\t\t\t\t\ttype: 'scatter',\r\n\t\t\t\t\tcoordinateSystem: 'geo',\r\n\t\t\t\t\tdata: newPonits,\r\n\t\t\t\t\tsymbol: that.panel.symbolStyle,\r\n\t\t\t\t\tsymbolSize: that.panel.symbolSize,\r\n\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\tshow: false\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\temphasis: {\r\n\t\t\t\t\t\t\tshow: false\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\temphasis: {\r\n\t\t\t\t\t\t\tcolor:that.panel.emSymbolColor,\r\n\t\t\t\t\t\t\tborderColor: '#fff',\r\n\t\t\t\t\t\t\tborderWidth: 1\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\tcolor:that.panel.symbolColor,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t});\r\n\t\tmyChart.resize();\r\n\t\tloadPoint = true;\r\n\t\tif (this.panel.symbolStyle=='none') {\r\n\t\t\tthis.addImage ();\r\n\t\t}\r\n\t}\r\n\r\n\t//改变参数时调用\r\n\tchangeLabelStyle () {\r\n\t\tmyChart.setOption(\r\n\t\t\t{\r\n\t\t\t\tbackgroundColor: this.panel.bgColor,\r\n\t\t\t\tgeo:{\r\n\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\tnormal:{\r\n\t\t\t\t\t\t\tshow: this.panel.showLabel,\r\n\t\t\t\t\t\t\tcolor: this.panel.labelColor\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\temphasis: {\r\n\t\t\t\t\t\t\tshow: this.panel.emShowLabel,\r\n\t\t\t\t\t\t\tcolor: this.panel.emLabelColor\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t)\r\n\t}\r\n\r\n\tchangeitemStyle () {\r\n\t\tmyChart.setOption(\r\n\t\t\t{\r\n\t\t\t\tgeo:{\r\n\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\tareaColor: this.panel.areaColor,\r\n\t\t\t\t\t\t\tborderColor: this.panel.borderColor,\r\n\t\t\t\t\t\t\tborderWidth: 1,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\temphasis: {\r\n\t\t\t\t\t\t\tareaColor: this.panel.emAreaColor,\r\n\t\t\t\t\t\t\tborderColor: this.panel.emBorderColor,\r\n\t\t\t\t\t\t\tborderWidth: 1,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t)\r\n\t}\r\n\r\n\tchangePointLabelStyle() {\r\n\t\tif (this.panel.symbolStyle == 'none') {\r\n\t\t\tmyChart.setOption({\r\n\t\t\t\tseries: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: 'scatter',\r\n\t\t\t\t\t\tcoordinateSystem: 'geo',\r\n\t\t\t\t\t\tsymbol: 'none',\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t});\r\n\t\t\tthis.addImage ();\r\n\t\t} else {\r\n\t\t\tmyChart.setOption({\r\n\t\t\t\tseries: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: 'scatter',\r\n\t\t\t\t\t\tcoordinateSystem: 'geo',\r\n\t\t\t\t\t\tsymbol: this.panel.symbolStyle,\r\n\t\t\t\t\t\tsymbolSize: this.panel.symbolSize,\r\n\t\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\t\temphasis: {\r\n\t\t\t\t\t\t\t\tcolor: this.panel.emSymbolColor,\r\n\t\t\t\t\t\t\t\tborderColor: '#fff',\r\n\t\t\t\t\t\t\t\tborderWidth: 1\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\t\tcolor: this.panel.symbolColor,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\taddImage () {\r\n\t\tthis.mapElem.find('.imagePoints')[0].innerHTML = '';\r\n\t\tlet newPonits = (this.panel.points.concat(sourcePonits)).filter(item=>{\r\n\t\t\treturn item.name && item.value && (parseFloat(item.value[0]).toString() != \"NaN\") && (parseFloat(item.value[1]).toString() != \"NaN\")\r\n\t\t});\r\n\t\tfor (let i=0; i<newPonits.length; i++) {\r\n\t\t\tlet position = myChart.convertToPixel('geo',newPonits[i].value);\r\n\t\t\tlet newDiv = document.createElement(\"a\");\r\n\t\t\tnewDiv.style = \"position:absolute;left:\"+position[0]+\"px;top:\"+position[1]+\"px;width:\"+this.panel.symbolSize+\"px;height:\"+this.panel.symbolSize+\"px;\";\r\n\t\t\tnewDiv.style.backgroundImage = \"url(public/plugins/oge_province_map/img/fengji.gif)\";\r\n\t\t\tnewDiv.style.backgroundRepeat = \"no-repeat\";\r\n\t\t\tnewDiv.style.backgroundSize = \"100% 100%\";\r\n\t\t\tnewDiv.href = newPonits[i].link.url;\r\n\t\t\tnewDiv.target = newPonits[i].link.targetBlank?'_blank':'_self';\r\n\t\t\tlet descriP = document.createElement(\"p\");\r\n\t\t\tdescriP.style = \"position:absolute;left:\"+((position[0]-0)+(this.panel.symbolSize-0))+\"px;top:\"+position[1]+\"px;\";\r\n\t\t\tdescriP.textContent = newPonits[i].description?newPonits[i].name+':'+newPonits[i].description:newPonits[i].name;\r\n\t\t\tdescriP.style.display = \"none\";\r\n\t\t\tdescriP.style.backgroundColor = \"rgba(55,55,64,0.75)\";\r\n\t\t\tnewDiv.addEventListener(\"mouseover\",function(){\r\n\t\t\t\tdescriP.style.display = \"block\";\r\n\t\t\t},false);\r\n\t\t\tnewDiv.addEventListener(\"mouseleave\",function(){\r\n\t\t\t\tdescriP.style.display = \"none\";\r\n\t\t\t},false);\r\n\t\t\tthis.mapElem.find('.imagePoints')[0].appendChild(newDiv);\r\n\t\t\tthis.mapElem.find('.imagePoints')[0].appendChild(descriP);\r\n\t\t}\r\n\t}\r\n\r\n\tchangeScatterData () {\r\n\t\tthis.changeSourcePoint();\r\n\t\tlet newPonits = (this.panel.points.concat(sourcePonits)).filter(item=>{\r\n\t\t\treturn item.name && item.value && (parseFloat(item.value[0]).toString() != \"NaN\") && (parseFloat(item.value[1]).toString() != \"NaN\")\r\n\t\t});\r\n\t\tmyChart.setOption({\r\n\t\t\tseries: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'scatter',\r\n\t\t\t\t\tcoordinateSystem: 'geo',\r\n\t\t\t\t\tdata: newPonits\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t});\r\n\t}\r\n\r\n\taddPoint() {\r\n\t\tlet obj= {\r\n\t\t\tname:'',\r\n\t\t\tvalue:[],\r\n\t\t\tsourcePoint: false,\r\n\t\t\tdescription:'',\r\n\t\t\tlink:{\r\n\t\t\t\turl: '',\r\n\t\t\t\ttargetBlank:true\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.panel.points.push(obj);\r\n\t}\r\n\r\n\tremovePoint(index) {\r\n\t\tthis.panel.points.splice(index, 1);\r\n\t\tthis.changeScatterData();\r\n\t}\r\n\r\n\tonRender() {\r\n\t}\r\n\r\n\turl(point){\r\n\t\tlet target =point.data.link.targetBlank?'_blank':'_self';\r\n\t\tif(point.data.link.url) {\r\n\t\t\twindow.open(point.data.link.url, target);\r\n\t\t}\r\n\t}\r\n\r\n\tlink(scope, elem, attrs, ctrl) {\r\n\t\tctrl.mapElem = elem;\r\n\t\tctrl.events.on('render', function () {\r\n\t\t\tif(myChart) {\r\n\t\t\t\tmyChart.resize();\r\n\t\t\t\tif (ctrl.panel.symbolStyle=='none' && loadPoint) {\r\n\t\t\t\t\tctrl.addImage ();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\nProvinceMapPanelCtrl.templateUrl = 'module.html';"]}