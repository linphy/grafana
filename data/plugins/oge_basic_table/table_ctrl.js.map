{"version":3,"sources":["../../src/table_ctrl.js"],"names":["OgeAlertMetricsPanelCtrl","moment","_","$","panelOptionDefaults","metrics","includeVars","isShowKKSName","isShowTime","isShowUnit","isShowValue","firstColumnText","secondColumnText","thirdColumnText","fourColumnText","alarmStyle","colors","fontFamily","fontSize","fontStyle","dataPrecise","colorOption","name","value","colorMode","costumeAlert","mode","threshold","TablePanelCtrl","$scope","$injector","$rootScope","backendSrv","linkSrv","searchDashboards","queryStr","callback","search","query","then","hits","dashboards","map","dash","title","defaults","panel","options","events","on","onInitEditMode","bind","onDataReceived","onRender","addEditorTab","dataList","tmpMetrics","isEmpty","i","length","item","meta","sql","datapoints","alarm","level","time","angular","copy","target","indexOf","split","refId","refIdNew","link","type","url","dashboard","dashUri","unit","data","render","max","dat","Fdata","toFixed","Number","parseInt","format","num","precise","fixedData","scope","elem","attrs","ctrl","pageCount","getTableHeight","panelHeight","height","fixed","ogeAlertEnabled","color","getAlertLevelColor","str","j","push","CO","rootElem","find","css","linkInfo","getPanelLinkAnchorInfo","scopedVars","href","reverse","uri","templateUrl"],"mappings":"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","file":"table_ctrl.js","sourcesContent":["import {\r\n\tOgeAlertMetricsPanelCtrl\r\n}\r\nfrom 'app/plugins/sdk';\r\nimport moment from 'moment';\r\nimport _ from 'lodash';\r\nimport './css/clock-panel.css!';\r\nimport $ from 'jquery';\r\n\r\nvar panelOptionDefaults = {\r\n\tmetrics: {},\r\n\tincludeVars: true,\r\n\tisShowKKSName: true,\r\n\tisShowTime: true,\r\n\tisShowUnit: false,\r\n\tisShowValue: true,\r\n\tfirstColumnText: '名称',\r\n\tsecondColumnText: '时间',\r\n\tthirdColumnText: '值',\r\n\tfourColumnText: '单位',\r\n\talarmStyle: 'none',\r\n\tcolors: [\"rgba(50, 172, 45, 0.97)\", \"rgba(237, 129, 40, 0.89)\",\r\n\t\t\"rgba(245, 54, 54, 0.9)\"\r\n\t],\r\n\tfontFamily: '微软雅黑',\r\n\tfontSize: '100%',\r\n\tfontStyle: 'normal',\r\n\tdataPrecise: 2,\r\n\tcolorOption: [{\r\n\t\tname: '禁用',\r\n\t\tvalue: 'Null'\r\n\t}, {\r\n\t\tname: '单元格',\r\n\t\tvalue: 'cell'\r\n\t}, {\r\n\t\tname: '值',\r\n\t\tvalue: 'value'\r\n\t}, {\r\n\t\tname: '行',\r\n\t\tvalue: 'row'\r\n\t}],\r\n\tcolorMode: 'Null',\r\n\tcostumeAlert: true,\r\n\tmode:'alarmInfo',\r\n\tthreshold:[],\r\n};\r\n\r\nexport class TablePanelCtrl extends OgeAlertMetricsPanelCtrl {\r\n\r\n\t/** @ngInject */\r\n\tconstructor($scope, $injector, $rootScope, backendSrv, linkSrv) {\r\n\t\tsuper($scope, $injector);\r\n\t\t$scope.searchDashboards = function (queryStr, callback) {\r\n\t\t\tthis.backendSrv.search({\r\n\t\t\t\tquery: queryStr\r\n\t\t\t}).then(function (hits) {\r\n\t\t\t\tvar dashboards = _.map(hits, function (dash) {\r\n\t\t\t\t\treturn dash.title;\r\n\t\t\t\t});\r\n\t\t\t\tcallback(dashboards);\r\n\t\t\t});\r\n\t\t};\r\n\t\tthis.backendSrv = backendSrv;\r\n\t\tthis.linkSrv = linkSrv;\r\n\r\n\t\t_.defaults(this.panel, {\r\n\t\t\toptions: {}\r\n\t\t}); //将panelDefaults属性附加到this.panel上\r\n\t\t_.defaults(this.panel.options, panelOptionDefaults);\r\n\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('render', this.onRender.bind(this));\r\n\t}\r\n\r\n\tonInitEditMode() {\r\n\t\tthis.addEditorTab('Options',\r\n\t\t\t'public/plugins/oge_basic_table/editor.html', 2);\r\n\t}\r\n\r\n\tonDataReceived(dataList) {\r\n\t\tvar tmpMetrics = this.panel.options.metrics;\r\n\t\tthis.panel.options.metrics = {};\r\n\r\n\t\tif (_.isEmpty(dataList)) return;\r\n\t\tfor (var i = 0; i < dataList.length; i++) {\r\n\t\t\tvar item = dataList[i];\r\n\t\t\tif (item.meta && item.meta.sql && item.meta.sql.length>0) {\r\n\t\t\t\t//只针对现场报警数据和value一起放在dataPoints中的pg数据源,将报警数据提出，重新组装数据，假设第一个是alert数据\r\n\t\t\t\tif (item.datapoints.length%2==0 && item.datapoints[0][1]==item.datapoints[1][1]) {\r\n\t\t\t\t\tvar alarm = {\r\n\t\t\t\t\t\tlevel: item.datapoints[0][0],\r\n\t\t\t\t\t\ttime: item.datapoints[0][1],\r\n\t\t\t\t\t\tvalue: item.datapoints[1][0]\r\n\t\t\t\t\t};\r\n\t\t\t\t\titem.datapoints = [angular.copy(item.datapoints[1])];\r\n\t\t\t\t\titem['alarm'] = alarm;\r\n\t\t\t\t\titem['target'] = item.target.indexOf('_')>0?item.target.split('_')[1]:item.target;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (item.refId) {\r\n\t\t\t\titem.refIdNew = item.refId;\r\n\t\t\t} else {\r\n\t\t\t\titem.refIdNew = item.target;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.panel.options.metrics[item.refIdNew] = tmpMetrics[item.refIdNew] || {\r\n\t\t\t\tlink: {\r\n\t\t\t\t\ttype: 'none',\r\n\t\t\t\t\turl: null,\r\n\t\t\t\t\tdashboard: null,\r\n\t\t\t\t\tdashUri: null\r\n\t\t\t\t},\r\n\t\t\t\tunit: null,\r\n\t\t\t\tthreshold: '',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tthis.data = dataList;\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tonRender() {\r\n\t}\r\n\r\n\tfixed() {\r\n\t\tfor (var i = 0; i < this.data.length; i++) {\r\n\t\t\tif (this.data[i].value == null && this.data[i].max == null) {\r\n\t\t\t\tthis.data[i].name = this.data[i].target;\r\n\t\t\t\tvar dat = this.data[i];\r\n\t\t\t\t// 设置 Fdata 和 Time\r\n\t\t\t\tdat.Fdata = '-';\r\n\t\t\t\tdat.time = '-';\r\n\t\t\t\tif (!_.isEmpty(dat.datapoints)) {\r\n\t\t\t\t\tvar value = dat.datapoints[dat.datapoints.length - 1][0].toFixed(this.panel.options.dataPrecise);\r\n\t\t\t\t\tif (value !== -9999) dat.Fdata = value;\r\n\r\n\t\t\t\t\tvar time = dat.datapoints[dat.datapoints.length - 1][1];\r\n\t\t\t\t\tif (Number.parseInt(time) > 0)\r\n\t\t\t\t\t\tdat.time = moment(Number.parseInt(time)).format(\"YYYY-MM-DD HH:mm:ss\");\r\n\t\t\t\t}\r\n\t\t\t\tthis.panel.options.mode = \"commonData\";\r\n\t\t\t} else if (this.data[i].value != null && this.data[i].max == null) {\r\n\t\t\t\tvar num = this.data[i].value;\r\n\t\t\t\tif (this.data[i].precise == null) {\r\n\t\t\t\t\tvar fixedData = num.toFixed(this.panel.dataPrecise);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar fixedData = num.toFixed(this.data[i].precise);\r\n\t\t\t\t}\r\n\t\t\t\tif (fixedData == -9999) {\r\n\t\t\t\t\tfixedData = \"-\";\r\n\t\t\t\t}\r\n\t\t\t\tthis.data[i].Fdata = fixedData;\r\n\t\t\t\tthis.panel.options.mode = \"relativeInfo\";\r\n\t\t\t} else {\r\n\t\t\t\tthis.panel.options.mode = \"alarmInfo\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tlink(scope, elem, attrs, ctrl) {\r\n\r\n\t\tvar pageCount = 0;\r\n\t\t//table高度\r\n\t\tfunction getTableHeight() {\r\n\t\t\tvar panelHeight = ctrl.height;\r\n\t\t\tif (pageCount > 1) {\r\n\t\t\t\tpanelHeight -= 26;\r\n\t\t\t}\r\n\t\t\treturn panelHeight + 'px';\r\n\t\t}\r\n\t\tctrl.events.on('render', function () {\r\n\t\t\tif (_.isEmpty(ctrl.data)) return;\r\n\t\t\tctrl.fixed();\r\n\t\t\tfor (var i = 0; i < ctrl.data.length; i++) {\r\n\t\t\t\tif (ctrl.panel.ogeAlertEnabled && !ctrl.panel.options.costumeAlert) {\r\n\t\t\t\t\tif (ctrl.data[i].alarm == null) {\r\n\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tctrl.data[i].color = ctrl.getAlertLevelColor(ctrl.data[i].alarm.level);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctrl.data[i].threshold = [];\r\n\t\t\t\t\tif (ctrl.panel.options.threshold == null || ctrl.panel.options.threshold[ctrl.data[i].refIdNew] == null) {\r\n\t\t\t\t\t\tctrl.data[i].threshold = [25, 50];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar str = ctrl.panel.options.threshold[ctrl.data[i].refIdNew].split(\",\");\r\n\t\t\t\t\t\tfor (var j = 0; j < 2; j++) {\r\n\t\t\t\t\t\t\tctrl.data[i].threshold.push(Number(str[j]));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (ctrl.data[i].Fdata < ctrl.data[i].threshold[0]) {\r\n\t\t\t\t\t\tctrl.data[i].CO = ctrl.panel.options.colors[0];\r\n\t\t\t\t\t} else if (ctrl.data[i].threshold[0] <= ctrl.data[i].Fdata && ctrl.data[i].Fdata < ctrl.data[i].threshold[1]) {\r\n\t\t\t\t\t\tctrl.data[i].CO = ctrl.panel.options.colors[1];\r\n\t\t\t\t\t} else if (ctrl.data[i].threshold[1] <= ctrl.data[i].Fdata && ctrl.data[i].Fdata) {\r\n\t\t\t\t\t\tctrl.data[i].CO = ctrl.panel.options.colors[2];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar rootElem = elem.find('.table-panel-scroll'); //表格需要处理高度\r\n\t\t\tpageCount = ctrl.data.length;\r\n\t\t\trootElem.css({\r\n\t\t\t\t'max-height': getTableHeight()\r\n\t\t\t})\r\n\t\t});\r\n\t}\r\n\r\n\tformatLinkHref(link) {\r\n\t\tif (link.type === 'none') {\r\n\t\t\treturn '###';\r\n\t\t}\r\n\r\n\t\tlink.includeVars = this.panel.options.includeVars;\r\n\t\tvar linkInfo = this.linkSrv.getPanelLinkAnchorInfo(link, this.panel.scopedVars);\r\n\t\treturn linkInfo.href;\r\n\t}\r\n\r\n\r\n\tinvertColorOrder() {\r\n\t\tthis.panel.options.colors.reverse();\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tdashboardChanged(link) {\r\n\t\tthis.backendSrv.search({\r\n\t\t\tquery: link.dashboard\r\n\t\t}).then(function (hits) {\r\n\t\t\tvar dashboard = _.find(hits, {\r\n\t\t\t\ttitle: link.dashboard\r\n\t\t\t});\r\n\t\t\tif (dashboard) {\r\n\t\t\t\tlink.dashUri = dashboard.uri;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tsearchDashboards(queryStr, callback) {\r\n\t\tthis.backendSrv.search({\r\n\t\t\tquery: queryStr\r\n\t\t}).then(function (hits) {\r\n\t\t\tvar dashboards = _.map(hits, function (dash) {\r\n\t\t\t\treturn dash.title;\r\n\t\t\t});\r\n\t\t\tcallback(dashboards);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nTablePanelCtrl.templateUrl = 'module.html';"]}