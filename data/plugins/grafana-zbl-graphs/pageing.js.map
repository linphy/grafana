{"version":3,"sources":["../src/pageing.js"],"names":["link","scope","elem","attrs","ctrl","pageCount","getTableHeight","panelHeight","height","showGauge","value","unit","alarmInfo","flag","length","min","minInput","maxInput","maxAndLength","colorInfo","param","i","max","push","panel","alarmColor","index","option","tooltip","formatter","series","name","startAngle","endAngle","radius","type","axisLine","lineStyle","color","axisLabel","values","indexOf","split","toFixed","splitNumber","detail","offsetCenter","title","textStyle","fontWeight","fontSize","fontStyle","shadowColor","shadowBlur","pointer","width","data","obj","find","css","myChart","echarts","init","setOption","getTimesByLongTime","time","myDate","Date","times","fullTime","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","number","fixData","precise","events","on","mode","startTimes","changeTime","kpi","rootElem","kdmUrl","encodeURI","datasource","pluginUrl","url","_","$"],"mappings":"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","file":"pageing.js","sourcesContent":["import _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport 'jquery.flot';\r\nimport 'jquery.flot.pie';\r\nimport echarts from 'vendor/echarts/echarts.min.js';\r\n\r\nexport default function link(scope, elem, attrs, ctrl) {\r\n\tvar pageCount = 0;\r\n\t//table高度\r\n\tfunction getTableHeight() {\r\n\t  var panelHeight = ctrl.height;\r\n\t  if (pageCount > 1) {\r\n\t\tpanelHeight -= 26;\r\n\t  }\r\n\t  return (panelHeight - 31) + 'px';\r\n\t}\r\n\t\r\n\tfunction showGauge(value, unit, alarmInfo){\r\n\t\t//1、判断越大越危险(默认)，还是越小越危险\r\n\t\tvar flag = true;\r\n\t\tif(alarmInfo[alarmInfo.length - 1].min < alarmInfo[0].min){\r\n\t\t\tflag = false;\r\n\t\t}\r\n\t\t\r\n\t\tvar minInput = alarmInfo[0].min;\r\n\t\tvar maxInput = alarmInfo[alarmInfo.length - 1].min * 1.2; //max特别大，不可取\r\n\t\t\t\r\n\t\tif(!flag){\r\n\t\t\tminInput =  alarmInfo[alarmInfo.length - 1].min;\r\n\t\t\tmaxInput =  alarmInfo[0].min * 1.2;\r\n\t\t}\r\n\t\t\r\n\t\tvar maxAndLength = maxInput - minInput; //所有数据\r\n\t\t\t\r\n\t\tvar colorInfo = [];\r\n\t\tvar param = 0;\r\n\t\tfor(var i=0; i<alarmInfo.length; i++){\r\n\t\t\tif(flag){\r\n\t\t\t\tparam += (alarmInfo[i].max - alarmInfo[i].min)/maxAndLength;\r\n\t\t\t\tif(i == alarmInfo.length - 1){\r\n\t\t\t\t\tparam = 1;\r\n\t\t\t\t}\r\n\t\t\t\tcolorInfo.push([param, ctrl.panel.alarmColor[i]]);\r\n\t\t\t}else{\r\n\t\t\t\tvar index = alarmInfo.length - 1 - i;\r\n\t\t\t\tparam += (alarmInfo[index].max - alarmInfo[index].min)/maxAndLength;\r\n\t\t\t\tif(i == alarmInfo.length - 1){\r\n\t\t\t\t\tparam = 1;\r\n\t\t\t\t}\r\n\t\t\t\tcolorInfo.push([param, ctrl.panel.alarmColor[index]]);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t\tvar option = {\r\n\t\t\t\ttooltip: {\r\n\t\t\t\t\tformatter: \"{a} <br/>{c} {b}\"\r\n\t\t\t\t},\r\n\t\t\t\tseries: [{\r\n\t\t\t\t\tname: '',\r\n\t\t\t\t\tmin: minInput,\r\n\t\t\t\t\tmax: maxInput,\r\n\t\t\t\t\tstartAngle: 180,\r\n\t\t\t\t\tendAngle: 0,\r\n\t\t\t\t\tradius:'90%',\r\n\t\t\t\t\ttype: 'gauge',\r\n\t\t\t\t\tlength:'80%',\r\n\t\t\t\t\taxisLine: {\r\n\t\t\t\t\t\tlineStyle: {\r\n\t\t\t\t\t\t\tcolor: colorInfo\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\taxisLabel:{\r\n\t\t\t\t\t\tformatter: function (value) {\r\n\t\t\t\t\t\t\tvar values = value + \"\";\r\n\t\t\t\t\t\t\tif(values.indexOf('.') == -1){ //没有小数点\r\n\t\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar length = values.split(\".\")[1].length; //有小数点，看本来有几位\r\n\t\t\t\t\t\t\tif(length >= 2){\r\n\t\t\t\t\t\t\t\treturn value.toFixed(2);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsplitNumber: alarmInfo.length * 2,\r\n\t\t\t\t\tdetail: { \r\n\t\t\t\t\t\tformatter: '{value}',\r\n\t\t\t\t\t\toffsetCenter: [0, 20],       // x, y，单位px\r\n\t\t\t\t\t},\r\n\t\t\t\t\ttitle : {\r\n\t\t\t\t\t\ttextStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE\r\n\t\t\t\t\t\t\tfontWeight: 'bolder',\r\n\t\t\t\t\t\t\tfontSize: 20,\r\n\t\t\t\t\t\t\tfontStyle: 'italic',\r\n\t\t\t\t\t\t\tcolor: '#fff',\r\n\t\t\t\t\t\t\tshadowColor : '#fff', //默认透明\r\n\t\t\t\t\t\t\tshadowBlur: 10\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tpointer: {           // 分隔线\r\n\t\t\t\t\t\twidth:5,\r\n\t\t\t\t\t\tlength:'60%'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdata: [{ value: value, name: unit }]\r\n\t\t\t\t}]\r\n\t\t\t};\r\n\t\r\n\t\tvar obj = elem.find('.singleGraph');\r\n\t\tobj.css(\"min-height\", (ctrl.height + 150) + \"px\")\r\n\t\tvar myChart = echarts.init(obj[0]);\r\n\t\tmyChart.setOption(option, true);\r\n\t}\r\n\t\r\n\tfunction getTimesByLongTime(time){\r\n\t\tvar myDate = new Date(time);\r\n\t\tvar times = fullTime(myDate.getFullYear());\r\n\t\ttimes += \"-\" + fullTime(myDate.getMonth()+1);\r\n\t\ttimes += \"-\" + fullTime(myDate.getDate());\r\n\t\ttimes += \" \" + fullTime(myDate.getHours());\r\n\t\ttimes += \":\" + fullTime(myDate.getMinutes());\r\n\t\ttimes += \":\" + fullTime(myDate.getSeconds());\r\n\t\treturn times;\r\n\t}\r\n\t\r\n\tfunction fullTime(number){\r\n\t\tif(number < 10){\r\n\t\t\treturn \"0\" + number;\r\n\t\t}else{\r\n\t\t\treturn number;\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction fixData(value, precise){\r\n\t\tif(value && precise && typeof(value) != \"string\"){\r\n\t\t\tvalue = value.toFixed(precise);\r\n\t\t}\r\n\t\tif(value == -9999){\r\n\t\t\tvalue = \"-\";\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tctrl.events.on('render', function() {\r\n\t\tif(!ctrl.data){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (\"kpi\" == ctrl.panel.mode){ //echart画仪表盘\r\n\t\t\tif(ctrl.data.time){\r\n\t\t\t\tctrl.data.times = getTimesByLongTime(ctrl.data.time);\r\n\t\t\t}\r\n\t\t\tctrl.data.value = fixData(ctrl.data.value, ctrl.data.precise);\r\n\t\t\tvar startTimes = getTimesByLongTime(ctrl.data.time - 86400 * 1000);\r\n\t\t\tctrl.changeTime(startTimes, ctrl.data.times);\r\n\t\t}else if (\"kpiGauge\" == ctrl.panel.mode){ //echart画仪表盘\r\n\t\t\tvar alarmInfo = ctrl.data.alarmInfo;\r\n\t\t\tctrl.data.kpi.value = fixData(ctrl.data.kpi.value, ctrl.data.kpi.precise);\r\n\t\t\tshowGauge(ctrl.data.kpi.value, ctrl.data.kpi.unit, alarmInfo);\r\n\t\t}else if(\"relativeInfo\" == ctrl.panel.mode){\r\n\t\t\tvar rootElem = elem.find('.table-panel-scroll'); //表格需要处理高度\r\n\t\t\tfor(var i=0; i<ctrl.data.length; i++){\r\n\t\t\t\tctrl.data[i].value = fixData(ctrl.data[i].value, ctrl.data[i].precise);\r\n\t\t\t}\r\n\t\t\tpageCount = ctrl.data.length;\r\n\t\t\trootElem.css({'max-height': getTableHeight()});\r\n\t\t}else if(\"kpiWebUrl\" == ctrl.panel.mode){\r\n\t\t\t//console.log(ctrl.data);\r\n\t\t\tctrl.data.kdmUrl = encodeURI(ctrl.datasource.kdmUrl);\r\n\t\t\tctrl.data.pluginUrl = encodeURI(ctrl.datasource.url);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n"]}