{"version":3,"sources":["../src/selector_ctrl.js"],"names":["MetricsPanelCtrl","moment","_","TimeSeries","$","panelDefaults","selectTargets","manageA1A2Value","manageANValue","facilityF0Value","likeSearch","kksType","waveType","selectedWaveTime","isInit","tempInfo","renderType","queryVariable","SelectCtrl","$scope","$injector","$rootScope","$timeout","defaults","panel","manageA1A2ValueOptions","manageANValueOptions","facilityF0ValueOptions","waterfallWaveValueOptions","waterfallFloatValueOptions","kksOption","name","value","events","on","onInitEditMode","bind","onDataReceived","onRemoveCache","variable","multi","search","variableObj","oldVariableText","selectedValues","query","dropdownVisible","timeVariable","current","options","KKS_SPACE_NAMES","kks","optional","KKS_AIRGAP_NAMES","type5WaveTimeList","type5FloatTimeList","dataList","datasource","type","initKDMLinkThreeSelect","onDataReceivedImpl","initKDMPluginThreeSelect","then","unitData","data","initKDMThreeSelect","done","initKDMThreeSelectData","KKSTreeNodes","catch","err","console","error","manageA1A2Arr","manageA1A2","split","manageANArr","manageAN","facilityF0Arr","facilityF0","a","length","b","c","push","postData","kdmUrl","init","getAjaxPromise","url","method","arr","i","obj","codeName","code","children","val","obj2","val2","val3","obj3","changeA1A2","changeAN","render","timeOption","freshPage","addEditorTab","templateSrv","searchKKS","setSelectInfo","xids","kksArr","getAirgapKKS","doImpl","start","timeSrv","timeRange","from","_d","getTime","end","to","idResult","id","timesList","result","getTimesByLongTime","timeList","getAirORSpaceQuery","dealKDMData","getChooseBoxData","kksList","kksData","items","obj1","xid","log","key","kksCode","kksName","indexOf","checked","getTimeList","$apply","kksA","newkks","replace","rql","warn","kksCodes","targets","item","target","join","ajax","dataType","strinVal","selectedArr","texts","text","textArr","getKPITimeList","timesListA","d3_model_times","time","datetime","curVal","waterfallWaveValue","waterfallFloatValue","getWaveTimeListH","RTDataSets","RTDataValues","Time","dealType5Time","searchKDMkks","KKSInfos","reg","test","newArr","sortArr","j","slice","forEach","timeW","minArr","Math","abs","minInd","that","minVal","min","wave_kks","wave_time","dataTime","page_name","dashboard","meta","slug","refreshDashboard","kksStart","kksOther","results","POSITION","index","viewIndex","myDate","Date","times","fullTime","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","number","kksInfo","startTimes","endTimes","kksIn","startTime","endTime","resultType","requestUrl","headers","filter","selected","openDropdown","each","option","selectionsChanged","commitChange","map","commitChanges","event","setAllExceptCurrentTo","other","newValue","switchToLink","getSelectValue","css","max","width","show","hide","focus","document","ready","body","click","e","bodyOnClick","has","location","pathname","uid","scope","elem","attrs","ctrl","find","html","templateUrl"],"mappings":"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","file":"selector_ctrl.js","sourcesContent":["import {\r\n\tMetricsPanelCtrl\r\n} from 'app/plugins/sdk';\r\nimport moment from 'moment';\r\nimport _ from 'lodash';\r\nimport TimeSeries from 'app/core/time_series';\r\nimport $ from 'jquery';\r\n\r\nvar panelDefaults = {\r\n\tselectTargets: [],\r\n\tmanageA1A2Value: \"\", //省份\r\n\tmanageANValue: \"\", //电厂\r\n\tfacilityF0Value: \"\", //机组\r\n\tlikeSearch: \"\", //普通查询\r\n\tkksType: 0, //见kksOption\r\n\twaveType: 0, //波形类型\r\n\tselectedWaveTime: \"\", //已选择波形时间\r\n\tisInit: true, //是否初始化页面（没有刷新页面）\r\n\ttempInfo: \"请选择数据\",\r\n\trenderType: -1, //刷新事件，-1不刷新数据，0重新取kdm kks，1获取model， 2 获取波形时间, 3 先获取kdm kks然后在获取波形时间, 4获取模型时间\r\n\tqueryVariable: \"\"\r\n}\r\n\r\nexport class SelectCtrl extends MetricsPanelCtrl {\r\n\tconstructor($scope, $injector, $rootScope, $timeout) {\r\n\t\tsuper($scope, $injector);\r\n\t\tthis.$rootScope = $rootScope;\r\n\t\tthis.$timeout = $timeout;\r\n\t\tthis.$scope = $scope;\r\n\t\t_.defaults(this.panel, panelDefaults);\r\n\r\n\t\tthis.panel.manageA1A2ValueOptions = [];\r\n\t\tthis.panel.manageANValueOptions = [];\r\n\t\tthis.panel.facilityF0ValueOptions = [];\r\n\t\tthis.panel.waterfallWaveValueOptions = [];\r\n\t\tthis.panel.waterfallFloatValueOptions = [];\r\n\r\n\t\tthis.panel.kksOption = [\r\n\t\t\t{ name: \"数值分析\", value: 0 },\r\n\t\t\t{ name: \"3D模型分析\", value: 1 },\r\n\t\t\t{ name: \"频谱分析\", value: 2 },\r\n\t\t\t{ name: \"气隙分析\", value: 3 },\r\n\t\t\t{ name: \"轴线分析\", value: 4 },\r\n\t\t\t{ name: \"瀑布模型分析\", value: 5 }\r\n\t\t];\r\n\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('panel-teardown', this.onRemoveCache.bind(this)); //卸载\r\n\t\tthis.panel.isInit = true;\r\n\r\n\t\tthis.variable = {\"current\": {}, \"options\": [], multi: true, search: {}};\r\n\t\tthis.variableObj = {\r\n\t\t\toldVariableText: \"\",\r\n\t\t\tselectedValues: [],\r\n\t\t\tsearch:{\r\n\t\t\t\tquery:''\r\n\t\t\t},\r\n\t\t\tdropdownVisible:false,\r\n\t\t};\r\n\t\tthis.timeVariable = {\"current\": {}, \"options\": [], multi: true, search: {}};\r\n\t\tif(this.panel.kksType == 1){\r\n\t\t\tthis.variable = {\"current\": {}, \"options\": [], search: {}};\r\n\t\t}\r\n\t\tthis.variable.current = {\"text\":\"请选择kks\", \"value\": \"\"};\r\n\t\tthis.variable.options = [];\r\n\t\tthis.timeVariable.current = {\"text\":\"请选择kks\", \"value\": \"\"};\r\n\t\tthis.timeVariable.options = [];\r\n\t\tthis.KKS_SPACE_NAMES = [\r\n\t\t\t{ name: \"上导轴承X向摆度波形\", kks: \"EB000HP1MKC01MK012BL01J1CC001CA01\", optional: false },\r\n\t\t\t{ name: \"上导轴承Y向摆度波形\", kks: \"EB000HP1MKC01MK012BN01J1CC001CA01\", optional: false },\r\n\t\t\t{ name: \"下导轴承X向摆度波形\", kks: \"EB000HP1MKD01MK012BL01J1CC001CA01\", optional: false },\r\n\t\t\t{ name: \"下导轴承Y向摆度波形\", kks: \"EB000HP1MKD01MK012BN01J1CC001CA01\", optional: false },\r\n\t\t\t{ name: \"水导轴承X向摆度波形\", kks: \"EB000HP1MEC01ME010BL01J1CC001CA01\", optional: false },\r\n\t\t\t{ name: \"水导轴承Y向摆度波形\", kks: \"EB000HP1MEC01ME010BN01J1CC001CA01\", optional: false },\r\n\t\t\t{ name: \"上机架X向振动波形\", kks: \"EB000HP1MKC01MK011BL01J1CB001CA01\", optional: true },\r\n\t\t\t{ name: \"上机架Y向振动波形\", kks: \"EB000HP1MKC01MK011BN01J1CB001CA01\", optional: true },\r\n\t\t\t{ name: \"下机架X向振动波形\", kks: \"EB000HP1MKD01MK011BL01J1CB001CA01\", optional: true },\r\n\t\t\t{ name: \"下机架Y向振动波形\", kks: \"EB000HP1MKD01MK011BN01J1CB001CA01\", optional: true },\r\n\t\t\t{ name: \"顶盖X向振动波形\", kks: \"EB000HP1MEJ01ME029BL01J1CB001CA01\", optional: true },\r\n\t\t\t{ name: \"顶盖Y向振动波形\", kks: \"EB000HP1MEJ01ME029BN01J1CB001CA01\", optional: true }\r\n\t\t  ];\r\n\t\tthis.KKS_AIRGAP_NAMES = [\r\n\t\t\t{ name: \"+X方向气隙波形\", kks: \"EB000HP1MKA01MK016BL01J1CA004CA01\", optional: false },\r\n\t\t\t{ name: \"+X+Y方向气隙波形\", kks: \"EB000HP1MKA01MK016BM01J1CA004CA01\", optional: true },\r\n\t\t\t{ name: \"+Y方向气隙波形\", kks: \"EB000HP1MKA01MK016BN01J1CA004CA01\", optional: false },\r\n\t\t\t{ name: \"-X+Y方向气隙波形\", kks: \"EB000HP1MKA01MK016BP01J1CA004CA01\", optional: true },\r\n\t\t\t{ name: \"-X方向气隙波形\", kks: \"EB000HP1MKA01MK016BR01J1CA004CA01\", optional: false },\r\n\t\t\t{ name: \"-X-Y方向气隙波形\", kks: \"EB000HP1MKA01MK016BQ01J1CA004CA01\", optional: true },\r\n\t\t\t{ name: \"-Y方向气隙波形\", kks: \"EB000HP1MKA01MK016BS01J1CA004CA01\", optional: false },\r\n\t\t\t{ name: \"+X-Y方向气隙波形\", kks: \"EB000HP1MKA01MK016BT01J1CA004CA01\", optional: true }\r\n\t\t];\r\n\t\tthis.type5WaveTimeList = [];\r\n\t\tthis.type5FloatTimeList = [];\r\n\t}\r\n\r\n\tonDataReceived(dataList) {\r\n\t\tif (!this.panel.isInit) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//从kdm link数据源获取机组数据\r\n\t\tif(this.datasource.type === \"kdm-link\"){\r\n\t\t\tthis.initKDMLinkThreeSelect();\r\n\t\t\tthis.onDataReceivedImpl();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//从kdm数据源获取数据（兼容老版本kdm数据源）\r\n\t\tif (this.datasource.type === \"oge-rtdata\") {\r\n\t\t\tthis.initKDMPluginThreeSelect().then(unitData => {\r\n\t\t\t\tthis.panel.manageA1A2ValueOptions = unitData.data;\r\n\t\t\t\tthis.onDataReceivedImpl();\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//新版kdm数据源（新版本数据源；推荐）\r\n\t\tif (this.datasource.type === \"oge-kdm\") {\r\n\t\t\tthis.initKDMThreeSelect().done(unitData => {\r\n\t\t\t\t// this.panel.manageA1A2ValueOptions = unitData.data;\r\n\t\t\t\tthis.initKDMThreeSelectData(unitData.KKSTreeNodes);\r\n\t\t\t\tthis.onDataReceivedImpl();\r\n\t\t\t}).catch(function( err ) {\r\n\t\t\t\t\tconsole.error(\"请确认连接的是kdm网关，否则会产生跨域问题\");\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\t//初始化三个下拉框数据\r\n\tinitKDMLinkThreeSelect(){\r\n\t\tvar manageA1A2Arr = this.datasource.manageA1A2.split(\",\");\r\n\t\tvar manageANArr = this.datasource.manageAN.split(\",\");\r\n\t\tvar facilityF0Arr = this.datasource.facilityF0.split(\",\");\r\n\t\tvar data = [];\r\n\t\tfor(var a=0; a<manageA1A2Arr.length; a++){\r\n\t\t\tvar manageA1A2 = {\"myself\": manageA1A2Arr[a].split(\":\")[0], \"value\": manageA1A2Arr[a].split(\":\")[1], data:[]};\r\n\t\t\tfor(var b=0; b<manageANArr.length; b++){\r\n\t\t\t\tvar manageAN =  {\"myself\": manageANArr[b].split(\":\")[0], \"value\": manageANArr[b].split(\":\")[1], data:[]};\r\n\t\t\t\tfor(var c=0; c<facilityF0Arr.length; c++){\r\n\t\t\t\t\tvar facilityF0 = {\"myself\": facilityF0Arr[c].split(\":\")[0], \"value\": facilityF0Arr[c].split(\":\")[1]};\r\n\t\t\t\t\tmanageAN.data.push(facilityF0);\r\n\t\t\t\t}\r\n\t\t\t\tmanageA1A2.data.push(manageAN);\r\n\t\t\t}\r\n\t\t\tdata.push(manageA1A2);\r\n\t\t}\r\n\t\tthis.panel.manageA1A2ValueOptions = data;\r\n\t}\r\n\r\n\tinitKDMPluginThreeSelect(){\r\n\t\tvar postData = {\r\n\t\t\tkdmUrl: this.datasource.kdmUrl,\r\n\t\t\tinit: \"true\"\r\n\t\t};\r\n\t\treturn this.getAjaxPromise(postData, this.datasource.url + '/trend/getChooseBoxData');\r\n\t}\r\n\r\n\tinitKDMThreeSelect(){\r\n\t\tvar postData = {\r\n\t\t\tmethod: 'getKKSTreeByField',\r\n\t\t\t\"field\": \"facilityF0\"\r\n\t\t};\r\n\t\t// return this.getAjaxPromise(postData, this.datasource.url + '/kdmService/rest/1.0/kksInfo');\r\n\t\treturn this.getAjaxPromise(postData, this.datasource.url + '/kksInfo');\r\n\t}\r\n\r\n\t//初始化KDM数据\r\n\tinitKDMThreeSelectData(data) {\r\n\t\tlet arr = [];\r\n\t\tfor(let i = 0;i<data.length;i++) {\r\n\t\t\tlet obj = {\"myself\": data[i].codeName, \"value\": data[i].code, data:[]};\r\n\t\t\tif(!data[i].children) continue;\r\n\t\t\tfor(let a=0;a<data[i].children.length;a++) {\r\n\t\t\t\tlet val = data[i].children[a];\r\n\t\t\t\tlet obj2 = {\"myself\": val.codeName, \"value\": val.code, data:[]};\r\n\t\t\t\tif(!val.children) continue;\r\n\t\t\t\tfor(let b=0;b<val.children.length;b++) {\r\n\t\t\t\t\tlet val2 = val.children[b];\r\n\t\t\t\t\tif(!val2.children) continue;\r\n\t\t\t\t\tfor(let c=0; c<val2.children.length; c++) {\r\n\t\t\t\t\t\tlet val3 = val2.children[c];\r\n\t\t\t\t\t\tlet obj3 = {\"myself\": val3.codeName, \"value\": val3.code};\r\n\t\t\t\t\t\tobj2.data.push(obj3);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tobj.data.push(obj2);\r\n\t\t\t}\r\n\t\t\tarr.push(obj);\r\n\t\t}\r\n\t\tthis.panel.manageA1A2ValueOptions = arr;\r\n\t}\r\n\r\n\tonDataReceivedImpl(){\r\n\t\t//回显下拉框数据\r\n\t\tif (this.panel.manageA1A2Value != null) {\r\n\t\t\tthis.changeA1A2();\r\n\t\t}\r\n\t\tif (this.panel.manageANValue != null) {\r\n\t\t\tthis.changeAN();\r\n\t\t}\r\n\r\n\t\tthis.render();\r\n\r\n\t\t//刷新其他控件（使用参数避免一直刷新）\r\n\t\tif (this.panel.isInit) {\r\n\t\t\tthis.panel.selectTargets = [];// 初始化不限时任何点\r\n\t\t\tthis.panel.timeOption = [];\r\n\t\t\tthis.freshPage();\r\n\t\t\tthis.panel.isInit = false;\r\n\t\t}\r\n\t}\r\n\r\n\tonInitEditMode() {\r\n\t\tthis.addEditorTab('Options', 'public/plugins/oge-kdm-selector/editor.html', 2);\r\n\t}\r\n\r\n\tonRemoveCache() {\r\n\t\tthis.templateSrv.selectTargets = [];\r\n\t}\r\n\r\n\tonRender() {\r\n\r\n\t}\r\n\r\n\t//改变省，获得电站\r\n\tchangeA1A2() {\r\n\t\tfor (var i = 0; i < this.panel.manageA1A2ValueOptions.length; i++) {\r\n\t\t\tif (this.panel.manageA1A2Value == this.panel.manageA1A2ValueOptions[i].value) {\r\n\t\t\t\tthis.panel.manageANValueOptions = this.panel.manageA1A2ValueOptions[i].data;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t//改变电站，获得机组\r\n\tchangeAN() {\r\n\t\tfor (var i = 0; i < this.panel.manageANValueOptions.length; i++) {\r\n\t\t\tif (this.panel.manageANValue == this.panel.manageANValueOptions[i].value) {\r\n\t\t\t\tthis.panel.facilityF0ValueOptions = this.panel.manageANValueOptions[i].data;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t//改变机组，获取kks\r\n\tqueryData() {\r\n\t\tthis.searchKKS();\r\n\t\tthis.setSelectInfo();\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tsearchKDMkks(query) {\r\n\t\tvar postData = {\r\n\t\t\tmethod: 'searchKKSInfos',\r\n\t\t\t\"fields\": \"kksCode,kksName\",\r\n\t\t\t\"orderby\": \"[('kksCode', 'DESC')]\",\r\n\t\t\t\"query\":query,\r\n\t\t\t\"offset\": 1,\r\n\t\t\t\"limit\": 2000\r\n\t\t};\r\n\t\treturn this.getAjaxPromise(postData, this.datasource.url + '/kksInfo');\r\n\t}\r\n\r\n\tsearchKKS() {\r\n\t\tvar obj = this;\r\n\t\tthis.panel.selectTargets = [];\r\n\t\tif(!this.panel.manageA1A2Value || !this.panel.manageANValue || !(this.panel.facilityF0Value>=0)) return;\r\n\t\t//气隙，直接通过kksStart获取时间列表\r\n\t\tif(this.panel.kksType === 3 && this.datasource.type === \"kdm-link\"){\r\n\t\t\tvar xids =  this.panel.manageA1A2Value + this.panel.manageANValue + this.panel.facilityF0Value;\r\n\t\t\tvar kksArr = this.getAirgapKKS(xids);\r\n\t\t\tthis.panel.selectTargets.push(xids);\r\n\t\t\tthis.datasource.doImpl(\"getPointId\", kksArr[0]).then(idResult => {\r\n\t\t\t\tvar start = obj.timeSrv.timeRange().from._d.getTime();\r\n\t\t\t\tvar end = obj.timeSrv.timeRange().to._d.getTime(); //link link区间查询\r\n\t\t\t\tvar options = {\"id\": idResult.data.id, \"start\": start, \"end\": end};\r\n\r\n\t\t\t\tobj.datasource.doImpl('searchWaveTime', options).then(result => {\r\n\t\t\t\t\tvar timesList = [];\r\n\t\t\t\t\tfor(var i=0; i<result.data.length; i++){\r\n\t\t\t\t\t\ttimesList[i] = \tobj.getTimesByLongTime(result.data[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tobj.timeList = timesList;\r\n\t\t\t\t\tobj.render();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(this.datasource.type === \"oge-kdm\") {\r\n\t\t\tlet query='';\r\n\t\t\tif(this.panel.kksType == 0 || (this.panel.kksType == 5 && this.panel.waterfallWaveValueOptions.length>0)) {\r\n\t\t\t\tquery = \"['&', '&', ('valueB1B2', '!=', 'CB'), ('valueB1B2', '!=', 'CA') ,'&', ('manageA1A2', '=', '\"+this.panel.manageA1A2Value+\"'), '&', ('manageAN', '=', '\"+this.panel.manageANValue+\"'), ('facilityF0', '=', '\"+this.panel.facilityF0Value+\"')]\";\r\n\t\t\t} else if(this.panel.kksType == 1) {\r\n\t\t\t\tquery = \"['&', '|', ('kksCode','like','%模型%'),('kksName','like','%模型'), '&', ('manageA1A2', '=', '\"+this.panel.manageA1A2Value+\"'), '&', ('manageAN', '=', '\"+this.panel.manageANValue+\"'), ('facilityF0', '=', '\"+this.panel.facilityF0Value+\"')]\";\r\n\t\t\t} else if(this.panel.kksType == 2 || this.panel.kksType == 5) {\r\n\t\t\t\tquery = \"['&', '|', ('valueB1B2', '=', 'CB'), ('valueB1B2', '=', 'CA') ,'&', ('manageA1A2', '=', '\"+this.panel.manageA1A2Value+\"'), '&', ('manageAN', '=', '\"+this.panel.manageANValue+\"'), ('facilityF0', '=', '\"+this.panel.facilityF0Value+\"')]\";\r\n\t\t\t} else if(this.panel.kksType == 3) {\r\n\t\t\t\tquery = this.getAirORSpaceQuery(this.KKS_AIRGAP_NAMES);\r\n\t\t\t}else{\r\n\t\t\t\tquery = this.getAirORSpaceQuery(this.KKS_SPACE_NAMES);\r\n\t\t\t}\r\n\t\t\tthis.dealKDMData(query);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis.getChooseBoxData().then(kksList => {\r\n\t\t\tif (kksList == null) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(this.datasource.type === \"kdm-link\" && (this.panel.kksType === 0 || this.panel.kksType === 2)) {\r\n\t\t\t\tvar kksData = [];\r\n\t\t\t\tfor (var i = 0; i < kksList.data.items.length; i++) {\r\n\t\t\t\t\tvar obj1 = {\"kksCode\":kksList.data.items[i].xid, \"kksName\":kksList.data.items[i].name};\r\n\t\t\t\t\tkksData.push(obj1);\r\n\t\t\t\t}\r\n\t\t\t\tkksList.data = kksData;\r\n\t\t\t\tconsole.log(\"read kdm link data == \" + kksList.data.length);\r\n\t\t\t}else if (this.datasource.type === \"kdm-link\" &&  this.panel.kksType === 4){\r\n\t\t\t\t\t//与kdm 接口返回一致，不处理\r\n\t\t\t}\r\n\r\n\t\t\tif (this.panel.kksType !== 3 && this.panel.kksType != 4 && this.panel.selectTargets.length > 0) {\r\n\t\t\t\tvar kksData = kksList.data;\r\n\t\t\t\tfor (var i = 0; i < kksData.length; i++) {\r\n\t\t\t\t\tvar key = \"\";\r\n\t\t\t\t\tif (this.panel.kksType == 2) { //模型\r\n\t\t\t\t\t\tkey = kksData[i].name;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tkey = kksData[i].kksCode + \"_\" + kksData[i].kksName;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.panel.selectTargets.indexOf(key) != -1) {\r\n\t\t\t\t\t\tkksList.data[i].checked = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//继续选择kks，getSelectValue\r\n\t\t\tvar kksData = kksList.data;\r\n\t\t\tif (this.panel.kksType <= 2) {\r\n\t\t\t\tvar options = [];\r\n\t\t\t\tfor (var i = 0; i < kksData.length; i++) {\r\n\t\t\t\t\toptions[i] = {\r\n\t\t\t\t\t\t\"text\": kksData[i].kksName,\r\n\t\t\t\t\t\t\"value\": kksData[i].kksCode,\r\n\t\t\t\t\t\t\"selected\": false\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tthis.variable.options = options;\r\n\t\t\t\tthis.render();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t//直接选择kks，获取时间\r\n\t\t\tthis.panel.selectTargets = [];\r\n\t\t\tif(this.datasource.type === \"kdm-link\"){\r\n\t\t\t\tfor (let i = 0; i < kksData.length; i++) {\r\n\t\t\t\t\tlet kks = kksData[i].kks;\r\n\t\t\t\t\tthis.panel.selectTargets.push(kks);\r\n\t\t\t\t}\r\n\t\t\t\tvar start = this.timeSrv.timeRange().from._d.getTime();\r\n\t\t\t\tvar end = this.timeSrv.timeRange().to._d.getTime(); //link link区间查询\r\n\t\t\t\tvar options = {\"id\": kksData[0].id, \"start\": start, \"end\": end};\r\n\r\n\t\t\t\tthis.datasource.doImpl('searchWaveTime', options).then(result => {\r\n\t\t\t\t\tvar timesList = [];\r\n\t\t\t\t\tfor(var i=0; i<result.data.length; i++){\r\n\t\t\t\t\t\ttimesList[i] = \tthis.getTimesByLongTime(result.data[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.timeList = timesList;\r\n\t\t\t\t\tthis.render();\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tfor (let i = 0; i < kksData.length; i++) {\r\n\t\t\t\t\tlet kks = kksData[i].kksCode;\r\n\t\t\t\t\tthis.panel.selectTargets.push(kks);\r\n\t\t\t\t}\r\n\t\t\t\tthis.getTimeList(this.panel.selectTargets, \"getWaveTimeList\").done(result => {\r\n\t\t\t\t\tobj.$scope.$apply(() => {\r\n\t\t\t\t\t\tthis.timeList = result;\r\n\t\t\t\t\t\tthis.render();\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t//获取编码的条件query\r\n\tgetAirORSpaceQuery(kksA) {\r\n\t\tlet start = this.panel.manageA1A2Value+this.panel.manageANValue;\r\n\t\tlet query = \"['|'\"\r\n\t\tfor(let i=0;i<kksA.length; i++) {\r\n\t\t\tlet newkks = kksA[i].kks.replace(/^(\\w{0})\\w{5}(.*)$/, '$1'+start+'$2').replace(/^(\\w{7})\\w{1}(.*)$/, '$1'+this.panel.facilityF0Value+'$2');\r\n\t\t\tif(i==1 || i==(kksA.length-1)) {\r\n\t\t\t\tquery +=\",('kksCode','=','\"+newkks+\"')\";\r\n\t\t\t}else {\r\n\t\t\t\tquery +=\",'|', ('kksCode','=','\"+newkks+\"')\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tquery += \"]\";\r\n\t\treturn query;\r\n\t}\r\n\t//kdm获取下拉框数据\r\n\t//kdm kdm-link获取kks清单\r\n\tgetChooseBoxData() {\r\n\t\tvar xids =  this.panel.manageA1A2Value + this.panel.manageANValue + this.panel.facilityF0Value;\r\n\t\tif(this.datasource.type === \"kdm-link\" && (this.panel.kksType === 0 || this.panel.kksType === 2)){\r\n\t\t\tvar rql = '';\r\n\t\t\tif( this.panel.kksType === 0 ){\r\n\t\t\t\trql = '&or(like(name,*非波形*),like(xid,*' + xids + '*))&sort(xid,name)&limit(50)';\r\n\t\t\t} else {\r\n\t\t\t\trql = '&and(like(name,*波形*),like(xid,*' + xids + '*))&sort(xid,name)&limit(50)';\r\n\t\t\t}\r\n\t\t\treturn this.datasource.doImpl('searchPoints', rql);\r\n\t\t}else if(this.datasource.type === \"kdm-link\" && this.panel.kksType === 1){\r\n\t\t\tconsole.warn(\"kdm link数据源不支持获取3d模型数据\");\r\n\t\t\treturn;\r\n\t\t}else if(this.datasource.type === \"kdm-link\" && this.panel.kksType === 4){\r\n\t\t\treturn this.datasource.doImpl('searchSpaceKKS', xids);\r\n\t\t}\r\n\r\n\t\tvar postData = {\r\n\t\t\tkdmUrl: this.datasource.kdmUrl,\r\n\t\t\tkksType: this.panel.kksType\r\n\t\t};\r\n\t\tif (this.panel.facilityF0Value != null) {\r\n\t\t\tpostData.manageA1A2Value = this.panel.manageA1A2Value;\r\n\t\t\tpostData.manageANValue = this.panel.manageANValue;\r\n\t\t\tpostData.facilityF0Value = this.panel.facilityF0Value;\r\n\t\t}\r\n\t\t//获取编码\r\n\t\tif (postData.kksType === 3 || postData.kksType === 4) {\r\n\t\t\tlet kksCodes = [];\r\n\t\t\tfor (let i = 1; i < this.panel.targets.length; i++) {\r\n\t\t\t\tconst item = this.panel.targets[i];\r\n\t\t\t\tkksCodes.push(item.target);\r\n\t\t\t}\r\n\t\t\tpostData.target = kksCodes.join(\",\");\r\n\t\t}\r\n\r\n\t\treturn $.ajax({\r\n\t\t\ttype: 'POST',\r\n\t\t\turl: this.datasource.url + '/trend/getChooseBoxData',\r\n\t\t\tdata: postData,\r\n\t\t\tdataType: 'json'\r\n\t\t});\r\n\t}\r\n\r\n\t//选择完KKS[通道选择],后刷新该事件,kksType 0,1,2; 气隙、波形直接选择时间\r\n\tasync getSelectValue(strinVal) {\r\n\t\tvar selectTargets = [];\r\n\t\tif (this.panel.kksType == 0 || this.panel.kksType == 2) {\r\n\t\t\tvar selectedArr = this.variable.current.value;\r\n\t\t\tvar texts = this.variable.current.text;\r\n\t\t\tvar textArr = texts.split(\" + \");\r\n\t\t\tfor (var i = 0; i < selectedArr.length; i++) {\r\n\t\t\t\tselectTargets[i] = selectedArr[i] + \"_\" + textArr[i];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tselectTargets = [this.variable.current.value + \"_\" + this.variable.current.text];\r\n\t\t}\r\n\t\tthis.panel.selectTargets = selectTargets;\r\n\t\tthis.setSelectInfo();\r\n\r\n\t\tif (this.panel.kksType == 0) {\r\n\t\t\tthis.freshPage();\r\n\t\t\tthis.render();\r\n\t\t\treturn;\r\n\t\t} else if (this.panel.kksType == 1) {\r\n\t\t\tvar obj = this;\r\n\t\t\tthis.getKPITimeList(selectTargets).then(result => {\r\n\t\t\t\tvar timesListA = [];\r\n\t\t\t\tif(result.d3_model_times && result.d3_model_times.time && result.d3_model_times.time.length>0) {\r\n\t\t\t\t\tfor(var i=0; i<result.d3_model_times.time.length; i++){\r\n\t\t\t\t\t\ttimesListA[i] = obj.getTimesByLongTime(result.d3_model_times.time[i].datetime);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tobj.timeList = timesListA;\r\n\t\t\t\tobj.render();\r\n\t\t\t});\r\n\t\t} else if (this.panel.kksType == 2 && this.datasource.type === \"kdm-link\") {\r\n\t\t\tvar obj = this;\r\n\t\t\tvar xid = obj.variable.current.value[0];\r\n\t\t\tthis.datasource.doImpl(\"getPointId\", xid).then(idResult => {\r\n\t\t\t\tvar start = obj.timeSrv.timeRange().from._d.getTime();\r\n\t\t\t\tvar end = obj.timeSrv.timeRange().to._d.getTime(); //link link区间查询\r\n\t\t\t\tvar options = {\"id\": idResult.data.id, \"start\": start, \"end\": end};\r\n\r\n\t\t\t\tobj.datasource.doImpl('searchWaveTime', options).then(result => {\r\n\t\t\t\t\tvar timesList = [];\r\n\t\t\t\t\tfor(var i=0; i<result.data.length; i++){\r\n\t\t\t\t\t\ttimesList[i] = \tobj.getTimesByLongTime(result.data[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tobj.timeList = timesList;\r\n\t\t\t\t\tobj.render();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t} else if (this.datasource.type === \"oge-kdm\") {\r\n\t\t\tvar obj = this;\r\n\t\t\tlet curVal =this.variable.current.value;\r\n\t\t\tif(strinVal == 'wave') {\r\n\t\t\t\tcurVal = [this.panel.waterfallWaveValue];\r\n\t\t\t} else if(strinVal == 'float') {\r\n\t\t\t\tcurVal = [this.panel.waterfallFloatValue];\r\n\t\t\t}\r\n\t\t\t \r\n\t\t\tthis.getWaveTimeListH(curVal).then(data=>{\r\n\t\t\t\tvar timesListA = [];\r\n\t\t\t\tif(data.RTDataSets && data.RTDataSets[0].RTDataValues && data.RTDataSets[0].RTDataValues.length>0) {\r\n\t\t\t\t\tfor(var i=0; i<data.RTDataSets[0].RTDataValues.length; i++){\r\n\t\t\t\t\t\ttimesListA[i] = obj.getTimesByLongTime(data.RTDataSets[0].RTDataValues[i].Time);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(this.panel.kksType == 5) {\r\n\t\t\t\t\tif(strinVal == 'wave') {\r\n\t\t\t\t\t\tobj.type5WaveTimeList = timesListA;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj.type5FloatTimeList = timesListA;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!obj.panel.waterfallWaveValue || !obj.panel.waterfallFloatValue) return;\r\n\t\t\t\t\tobj.dealType5Time()\r\n\t\t\t\t}\r\n\t\t\t\tthis.$scope.$apply(() => {\r\n\t\t\t\t\tobj.timeList = timesListA;\r\n\t\t\t\t\tobj.render();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.getTimeList(selectTargets, \"getWaveTimeList\").done(result => {\r\n\t\t\t\tthis.$scope.$apply(() => {\r\n\t\t\t\t\tthis.timeList = result;\r\n\t\t\t\t\tthis.render();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tdealKDMData(query) {\r\n\t\tthis.searchKDMkks(query).then(data=>{\r\n\t\t\tif (this.panel.kksType !== 3 && this.panel.kksType != 4 && this.panel.selectTargets.length > 0) {\r\n\t\t\t\tvar kksData = data.KKSInfos;\r\n\t\t\t\tfor (var i = 0; i < kksData.length; i++) {\r\n\t\t\t\t\tvar key = \"\";\r\n\t\t\t\t\tif (this.panel.kksType == 2) { //模型\r\n\t\t\t\t\t\tkey = kksData[i].kksName;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tkey = kksData[i].kksCode + \"_\" + kksData[i].kksName;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.panel.selectTargets.indexOf(key) != -1) {\r\n\t\t\t\t\t\tdata.KKSInfos[i].checked = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//继续选择kks，getSelectValue\r\n\t\t\tvar kksData = data.KKSInfos;\r\n\t\t\tif (this.panel.kksType <= 2 || this.panel.kksType==5) {\r\n\t\t\t\tvar options = [];\r\n\t\t\t\tfor (var i = 0; i < kksData.length; i++) {\r\n\t\t\t\t\toptions[i] = {\r\n\t\t\t\t\t\t\"text\": kksData[i].kksName,\r\n\t\t\t\t\t\t\"value\": kksData[i].kksCode,\r\n\t\t\t\t\t\t\"selected\": false\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tif(this.panel.kksType==5) {\r\n\t\t\t\t\tlet reg = /^.{29}[C].{3}$/;\r\n\t\t\t\t\tif(kksData&&kksData[0]&&kksData[0].kksCode&& reg.test(kksData[0].kksCode)) {\r\n\t\t\t\t\t\tthis.panel.waterfallWaveValueOptions = options;\r\n\t\t\t\t\t\tthis.searchKKS();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.panel.waterfallFloatValueOptions = options;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$scope.$apply(() => {\r\n\t\t\t\t\t\tthis.variable.options = options;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tthis.render();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t//直接选择kks，获取时间\r\n\t\t\tthis.panel.selectTargets = [];\r\n\t\t\tvar newArr = [];\r\n\t\t\tvar sortArr = this.KKS_AIRGAP_NAMES;\r\n\t\t\tif (this.panel.kksType === 4) {\r\n\t\t\t\tsortArr = this.KKS_SPACE_NAMES;\r\n\t\t\t}\r\n\t\t\tfor (let j = 0; j < sortArr.length; j++) {\r\n\t\t\t\tfor (let i = 0; i < kksData.length; i++) {\r\n\t\t\t\t\tlet kks = kksData[i].kksCode;\r\n\t\t\t\t\tif(sortArr[j].kks.slice(8) == kks.slice(8)) {\r\n\t\t\t\t\t\tthis.panel.selectTargets.push(kks+'_'+kksData[i].kksName);\r\n\t\t\t\t\t\tnewArr.push(kks);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar obj = this;\r\n\t\t\tthis.getWaveTimeListH(newArr).then(result => {\r\n\t\t\t\tvar timesListA = [];\r\n\t\t\t\tif(result.RTDataSets && result.RTDataSets[0].RTDataValues && result.RTDataSets[0].RTDataValues.length>0) {\r\n\t\t\t\t\tfor(var i=0; i<result.RTDataSets[0].RTDataValues.length; i++){\r\n\t\t\t\t\t\ttimesListA[i] = obj.getTimesByLongTime(result.RTDataSets[0].RTDataValues[i].Time);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tobj.$scope.$apply(() => {\r\n\t\t\t\t\tobj.timeList = timesListA;\r\n\t\t\t\t\tobj.render();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tdealType5Time() {\r\n\t\tlet obj = this;\r\n\t\tif(this.type5WaveTimeList.length>0 && this.type5FloatTimeList.length>0) {\r\n\t\t\tthis.timeVariable.options=[];\r\n\t\t\tthis.type5WaveTimeList.forEach(timeW =>{\r\n\t\t\t\tif(obj.type5FloatTimeList.indexOf(timeW)>=0) {\r\n\t\t\t\t\tobj.timeVariable.options.push({text:timeW,value:timeW});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet minArr = [];\r\n                    for(let i=0;i<obj.type5FloatTimeList.length;i++) {\r\n                        minArr.push(Math.abs(obj.type5FloatTimeList[i]-timeW));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet minInd = that.minVal(minArr);\r\n\t\t\t\t\tobj.timeVariable.options.push({text:obj.type5FloatTimeList[minInd],value:timeW});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tminVal(arr) {\r\n\t\tlet min = arr[0];\r\n\t\tlet minInd = 0;\r\n\t\tfor(let i=0;i<arr.length;i++) {\r\n\t\t\tif(min>arr[i]) {\r\n\t\t\t\tmin = arr[i];\r\n\t\t\t\tminInd = i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn minInd;\r\n\t}\r\n\r\n\tgetSelectTime() {\r\n\t\tthis.templateSrv.wave_kks = this.panel.selectTargets;\r\n\t\tthis.templateSrv.wave_time = this.panel.dataTime;\r\n\t\tthis.templateSrv.page_name = this.dashboard.meta.slug;\r\n\t\tthis.freshPage();\r\n\t}\r\n\r\n\tfreshPage() {\r\n\t\tthis.templateSrv.selectTargets = this.panel.selectTargets;\r\n\t\tthis.timeSrv.refreshDashboard();\r\n\t}\r\n\r\n\tgetAirgapKKS(kksStart) {\r\n      var kksOther = [\"MKA01MK016\", \"01J1CA004CA01\"];\r\n      var results = [];\r\n\t\t\tvar POSITION = [\"BL\", \"BM\", \"BN\", \"BP\", \"BQ\", \"BR\", \"BS\", \"BT\"]; // 气隙部位\r\n      for (var i = 0; i < POSITION.length; i++) {\r\n          results.push(kksStart + kksOther[0] + POSITION[i] + kksOther[1]);\r\n      }\r\n      return results;\r\n   }\r\n\r\n\tsetSelectInfo(){\r\n\t\tif(this.panel.selectTargets.length === 0){\r\n\t\t\tthis.panel.tempInfo = \"请选择数据\";\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(this.panel.kksType === 0 || this.panel.kksType === 2){\r\n\t\t\tthis.panel.tempInfo = \"已选择\" + this.panel.selectTargets.length + \"条数据\";\r\n\t\t}else{\r\n\t\t\tthis.panel.tempInfo = this.variable.current.text;\r\n\t\t}\r\n\t}\r\n\r\n\t//会自动刷新页面\r\n\tchangeViewIndex(index) {\r\n\t\tthis.panel.viewIndex = index;\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tgetTimesByLongTime(time) {\r\n\t\tvar myDate = new Date(time);\r\n\t\tvar times = this.fullTime(myDate.getFullYear());\r\n\t\ttimes += \"-\" + this.fullTime(myDate.getMonth() + 1);\r\n\t\ttimes += \"-\" + this.fullTime(myDate.getDate());\r\n\t\ttimes += \" \" + this.fullTime(myDate.getHours());\r\n\t\ttimes += \":\" + this.fullTime(myDate.getMinutes());\r\n\t\ttimes += \":\" + this.fullTime(myDate.getSeconds());\r\n\t\treturn times;\r\n\t}\r\n\r\n\tfullTime(number) {\r\n\t\tif (number < 10) {\r\n\t\t\treturn \"0\" + number;\r\n\t\t} else {\r\n\t\t\treturn number;\r\n\t\t}\r\n\t}\r\n\r\n\t//getWaveTimeList、getKPITimeList\r\n\tgetTimeList(kksInfo, url) {\r\n\t\tvar postData = {\r\n\t\t\tkdmUrl: this.datasource.kdmUrl\r\n\t\t};\r\n\t\tpostData.startTimes = this.getTimesByLongTime(this.timeSrv.timeRange().from._d);\r\n\t\tpostData.endTimes = this.getTimesByLongTime(this.timeSrv.timeRange().to._d);\r\n\t\tpostData.kksInfo = kksInfo.join(\",\");\r\n\r\n\t\treturn $.ajax({\r\n\t\t\ttype: 'POST',\r\n\t\t\turl: this.datasource.url + '/trend/' + url,\r\n\t\t\tdata: postData,\r\n\t\t\tdataType: 'json'\r\n\t\t});\r\n\t}\r\n\r\n\tgetKPITimeList(kksInfo) {\r\n\t\tif(!kksInfo || kksInfo.length<0) return;\r\n\t\tlet startTimes = this.timeSrv.timeRange().from._d.getTime();\r\n\t\tlet endTimes = this.timeSrv.timeRange().to._d.getTime();\r\n\t\tlet kksIn = kksInfo[0].indexOf('_')>0?kksInfo[0].split('_')[0]:kksInfo[0];\r\n\t\treturn $.ajax({\r\n\t\t\ttype: 'GET',\r\n\t\t\turl: this.datasource.url + '/services/kpi_datas/d3model/times/'+kksIn+'/'+startTimes+'/'+endTimes,\r\n\t\t\tdataType: 'json'\r\n\t\t});\r\n\t}\r\n\r\n\tgetWaveTimeListH(kksInfo) {\r\n\t\tvar postData = {\r\n\t\t\tmethod: 'getRTDataHistory',\r\n\t\t\tstartTime: this.timeSrv.timeRange().from._d.getTime(),\r\n\t\t\tendTime: this.timeSrv.timeRange().to._d.getTime(),\r\n\t\t\tkksCodes: kksInfo.join(\",\"),\r\n\t\t\tresultType:1\r\n\t\t};\r\n\t\t// return this.getAjaxPromise(postData, this.datasource.url + '/kdmService/rest/1.0/kksData');\r\n\t\treturn this.getAjaxPromise(postData, this.datasource.url + '/kksData');\r\n\t}\r\n\r\n\tgetAjaxPromise(postData, requestUrl, headers){\r\n\t\treturn $.ajax({\r\n\t\t\ttype: 'POST',\r\n\t\t\turl: requestUrl,\r\n\t\t\tdata: postData,\r\n\t\t\tdataType: \"json\",\r\n\t\t\theaders: headers\r\n\t\t});\r\n\t}\r\n\r\n\tqueryChangedText() {\r\n\t\tlet query = \"['&', '&', ('valueB1B2', '!=', 'CB'), ('valueB1B2', '!=', 'CA') ,'&', ('manageA1A2', '=', '\"+this.panel.manageA1A2Value+\"'), '&', ('manageAN', '=', '\"+this.panel.manageANValue+\"'), ('facilityF0', '=', '\"+this.panel.facilityF0Value+\"')]\";\r\n\t\tif (this.variableObj.search.query ) {\r\n\t\t\tif (this.variableObj.search.query.length>1) {\r\n\t\t\t\tquery = \"['&', '|', ('kksCode','like','%\" + this.variableObj.search.query + \"%'), ('kksName','like','%\" + this.variableObj.search.query + \"%'), '&', ('valueB1B2', '!=', 'CB'), '&', ('valueB1B2', '!=', 'CA') ,'&', ('manageA1A2', '=', '\"+this.panel.manageA1A2Value+\"'), '&', ('manageAN', '=', '\"+this.panel.manageANValue+\"'), ('facilityF0', '=', '\"+this.panel.facilityF0Value+\"')]\";\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.dealKDMData(query);\r\n\t}\r\n\r\n\tshow() {\r\n\t\tthis.variableObj.oldVariableText = this.variable.current.text;\r\n\r\n\t\tthis.variableObj.selectedValues = _.filter(this.variable.options, { selected: true });\r\n\t\r\n\t\tthis.variableObj.search = {\r\n\t\t  query: ''\r\n\t\t};\r\n\t\r\n\t\tthis.variableObj.dropdownVisible = true;\r\n\t\tthis.openDropdown();\r\n\t}\r\n\r\n\tclearSelections() {\r\n\t\t_.each(this.variable.options, option => {\r\n\t\t  option.selected = false;\r\n\t\t});\r\n\t\r\n\t\tthis.selectionsChanged();\r\n\t}\r\n\r\n\tselectionsChanged(commitChange) {\r\n\t\tthis.variableObj.selectedValues = _.filter(this.variable.options, { selected: true });\r\n\t\r\n\t\tif (this.variableObj.selectedValues.length > 1) {\r\n\t\t  if (this.variableObj.selectedValues[0].text === 'All') {\r\n\t\t\tthis.variableObj.selectedValues[0].selected = false;\r\n\t\t\tthis.variableObj.selectedValues = this.variableObj.selectedValues.slice(1, this.variableObj.selectedValues.length);\r\n\t\t  }\r\n\t\t}\r\n\t\r\n\t\tthis.variable.current.value = _.map(this.variableObj.selectedValues, 'value');\r\n\t\tthis.variable.current.text = _.map(this.variableObj.selectedValues, 'text').join(' + ');\r\n\r\n\t\tif (commitChange) {\r\n\t\t\tthis.commitChanges();\r\n\t\t}\r\n\t}\r\n\r\n\tselectValue(option, event) {\r\n\t\tif (!option) {\r\n\t\t  return;\r\n\t\t}\r\n\t\r\n\t\toption.selected =  !option.selected;\r\n\t\r\n\t\tlet commitChange = commitChange || false;\r\n\t\r\n\t\tconst setAllExceptCurrentTo = newValue => {\r\n\t\t  _.each(this.variable.options, other => {\r\n\t\t\tif (option !== other) {\r\n\t\t\t  other.selected = newValue;\r\n\t\t\t}\r\n\t\t  });\r\n\t\t};\r\n\t\r\n\t\r\n\t\tif (option.text === 'All') {\r\n\t\t  setAllExceptCurrentTo(false);\r\n\t\t  commitChange = true;\r\n\t\t}\r\n\t\r\n\t\tthis.selectionsChanged(commitChange);\r\n\t}\r\n\r\n\tcommitChanges() {\r\n\t\t// if we have a search query and no options use that\r\n\t\tif (this.variable.options.length === 0 && this.variableObj.search.query.length > 0) {\r\n\t\t  this.variable.current = { text: this.variableObj.search.query, value: this.variableObj.search.query };\r\n\t\t} else if (this.variable.options.length > 0 && this.variableObj.selectedValues.length === 0) {\r\n\t\t  // make sure one option is selected\r\n\t\t  this.variable.options[0].selected = true;\r\n\t\t  this.selectionsChanged(false);\r\n\t\t}\r\n\t\r\n\t\tthis.variableObj.dropdownVisible = false;\r\n\t\tthis.switchToLink();\r\n\t\r\n\t\t// if (this.variable.current.text !== this.variableObj.oldVariableText) {\r\n\t\t  this.getSelectValue();\r\n\t\t// }\r\n\t}\r\n\r\n\topenDropdown() {\r\n\t\tlet that = this;\r\n\t\t$(\".multi-input-selectorclass\").css('width', Math.max($(\".multi-alink-selectorclass\").width(), 80) + 'px');\r\n\r\n\t\t$(\".multi-input-selectorclass\").show();\r\n\t\t$(\".multi-alink-selectorclass\").hide();\r\n\r\n\t\t$(\".multi-input-selectorclass\").focus();\r\n\t\t$(document).ready(function(){\r\n\t\t\t$(document.body).click(function(e) {\r\n\t\t\t\tthat.bodyOnClick(e);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tswitchToLink() {\r\n\t\t$(\".multi-input-selectorclass\").hide();\r\n\t\t$(\".multi-alink-selectorclass\").show();\r\n\t}\r\n\r\n\tbodyOnClick(e) {\r\n\t\tif ($('.multi-selector-all').has(e.target).length === 0) {\r\n\t\t\tthis.$scope.$apply(() => {\r\n\t\t\t\tif (document.location.pathname.indexOf(this.dashboard.uid) > -1) {\r\n\t\t\t\t\tthis.commitChanges();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tlink(scope, elem, attrs, ctrl) {\r\n\t\t\r\n\t\tctrl.events.on('render', function () {\r\n\t\t\telem.find(\".variable-value-link\").html(ctrl.panel.tempInfo + \" <i class='fa fa-caret-down'></i>\");\r\n\t\t\t\r\n\t\t\tif (ctrl.timeList) {\r\n\t\t\t\tctrl.panel.timeOption = ctrl.timeList;\r\n\t\t\t}\r\n\r\n\t\t\telem.find(\".variable-link-wrapper\").css({\r\n\t\t\t\t\"width\": \"100%\"\r\n\t\t\t});\r\n\t\t\telem.find(\".variable-value-link\").css({\r\n\t\t\t\t\"background-color\": \"#333\",\r\n\t\t\t\t\"margin-right\": \"0px\"\r\n\t\t\t});\r\n\t\t\telem.find(\".fa-caret-down\").css({\r\n\t\t\t\t\"float\": \"right\",\r\n\t\t\t\t\"margin-right\": \"-4px\"\r\n\t\t\t});\r\n\t\t\t//elem.find(\".gf-form-input\").css({\"width\":\"100%\"});\r\n\t\t});\r\n\t}\r\n}\r\n\r\nSelectCtrl.templateUrl = 'module.html';\r\n"]}