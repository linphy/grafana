{"version":3,"sources":["../../src/polarscatter_ctrl.js"],"names":["MetricsPanelCtrl","_","panelOptionDefaults","bgColor","axis","lineColor","lineWidth","textColor","scatter","color","r","centerScatter","circleLine","line","theMaxValue","tickSpace","tickColour","canvasArr","ctxArr","height","width","size","scatterDate","centerDate","multi","max","PolScatPanelCtrl","$scope","$injector","defaults","panel","events","on","onInitEditMode","bind","onDataReceived","onRender","addEditorTab","dataList","isEmpty","length","rows","push","render","target","panelHeight","html","i","canvas","find","getContext","drawAxis","drawScatter","context","strokeStyle","beginPath","moveTo","lineTo","closePath","stroke","drawAxisTicks","themultiple","num","lastSpace","Math","floor","tick","fillStyle","bool","x","fillText","toFixed","y","setLineDash","lineDashOffset","arc","PI","that","pixelArr","fill","j","addEventListener","doMouseMove","pointData","showDetail","showPointDetail","drawLine","clearRect","bbox","getBoundingClientRect","event","pageX","left","pageY","top","checkPoint","xmax","xmin","ymax","ymin","canvasPanel","parent","remove","tip","$","css","appendTo","arrayNum","join","split","reduce","a","b","abs","scope","elem","attrs","ctrl","$panelContainer","initChart","templateUrl"],"mappings":"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","file":"polarscatter_ctrl.js","sourcesContent":["import {\r\n\tMetricsPanelCtrl\r\n}\r\nfrom 'app/plugins/sdk';\r\nimport _ from 'lodash';\r\nimport './css/polarscatter-panel.css!';\r\n\r\nvar panelOptionDefaults = {\r\n\tbgColor: null,\r\n\taxis: {\r\n\t\tlineColor: '#8d8f8d',\r\n\t\tlineWidth: 1,\r\n\t\ttextColor: '#ccc'\r\n\t},\r\n\tscatter: {\r\n\t\tcolor: 'rgb(126, 178, 109)',\r\n\t\tr: 4\r\n\t},\r\n\tcenterScatter: {\r\n\t\tcolor: 'red',\r\n\t\tr: 2\r\n\t},\r\n\tcircleLine: {\r\n\t\tcolor: 'rgb(126, 178, 109)',\r\n\t\tr: 30\r\n\t},\r\n\tline: {\r\n\t\tlineColor: 'red',\r\n\t\tlineWidth: 1\r\n\t},\r\n\ttheMaxValue:null,\r\n\ttickSpace: 20,\r\n\ttickColour: '#ccc'\r\n};\r\nvar canvasArr = [];\r\nvar ctxArr = [];\r\nvar height = 200;\r\nvar width = 400;\r\nvar size = 0;\r\n\r\nvar scatterDate = [];\r\nvar centerDate = [];\r\nvar multi = 1;\r\nvar max = 1;\r\nvar canvasPanel;\r\n\r\nexport class PolScatPanelCtrl extends MetricsPanelCtrl {\r\n\r\n\t/** @ngInject */\r\n\tconstructor($scope, $injector) {\r\n\t\tsuper($scope, $injector);\r\n\r\n\t\t_.defaults(this.panel, panelOptionDefaults);\r\n\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('render', this.onRender.bind(this));\r\n\t}\r\n\r\n\tonInitEditMode() {\r\n\t\tthis.addEditorTab('Options',\r\n\t\t\t'public/plugins/oge_polar_scatter/editor.html', 2);\r\n\t}\r\n\r\n\tonDataReceived(dataList) {\r\n\t\tif (_.isEmpty(dataList)) return;\r\n\t\t//目前规定传入的值是table类型，并且第一个值为圆心，第二个值是散点\r\n\t\tif (dataList.length>1 && dataList[0].rows && dataList[1].rows) {\r\n\t\t\tscatterDate = dataList[1].rows;\r\n\t\t\tif(dataList[0].rows.length == 1) {\r\n\t\t\t\tcenterDate = [[0,0]];\r\n\t\t\t\tcenterDate.push(dataList[0].rows[0]);\r\n\t\t\t} else {\r\n\t\t\t\tcenterDate = dataList[0].rows;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tonRender() {\r\n\t}\r\n\r\n\tinitChart(target, panelHeight) {\r\n        height = panelHeight;\r\n        width = target.width();\r\n\r\n        var html = \"<div style='z-index:0; position: absolute; top: 0;'><canvas class='canvas-0'></canvas></div>\";\r\n        html += \"<div style='z-index:1; position: absolute; top: 0;'><canvas class='canvas-1'></canvas></div>\";\r\n\t\thtml += \"<div style='z-index:3; position: absolute; top: 0;'><canvas class='canvas-2'></canvas></div>\";\r\n\t\thtml += \"<div style='z-index:2; position: absolute; top: 0;'><canvas class='canvas-3'></canvas></div>\";\r\n        target.html(html);\r\n\r\n        for (var i = 0; i < 4; i++) {\r\n            var canvas = target.find('.canvas-' + i)[0];\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n\r\n            canvasArr[i] = canvas;\r\n            ctxArr[i] = canvas.getContext(\"2d\");\r\n        }\r\n\r\n\t\tthis.drawAxis();\r\n\t\tthis.circleLine();\r\n\t\tthis.drawScatter();\r\n\t}\r\n\t//轴线\r\n\tdrawAxis() {\r\n\t\tlet context = ctxArr[0];\r\n\t\tsize = width>height?height-20:width-20;//轴线的长度,上下左右留10px;\r\n\t\tcontext.strokeStyle = this.panel.axis.lineColor;\r\n\t\tcontext.lineWidth = this.panel.axis.lineWidth;\r\n\t\t//横轴\r\n\t\tcontext.beginPath();\r\n\t\tcontext.moveTo(width/2-size/2, height/2);\r\n\t\tcontext.lineTo(width/2+size/2, height/2);\r\n\t\tcontext.closePath();\r\n\t\tcontext.stroke();\r\n\t\t//箭头\r\n\t\tcontext.beginPath();\r\n\t\tcontext.moveTo(width/2+size/2, height/2);\r\n\t\tcontext.lineTo(width/2+size/2-10, height/2+10);\r\n\t\tcontext.closePath();\r\n\t\tcontext.stroke();\r\n\t\tcontext.beginPath();\r\n\t\tcontext.moveTo(width/2+size/2, height/2);\r\n\t\tcontext.lineTo(width/2+size/2-10, height/2-10);\r\n\t\tcontext.closePath();\r\n\t\tcontext.stroke();\r\n\t\t//纵轴\r\n\t\tcontext.beginPath();\r\n\t\tcontext.moveTo(width/2, height/2-size/2);\r\n\t\tcontext.lineTo(width/2, height/2+size/2);\r\n\t\tcontext.closePath();\r\n\t\tcontext.stroke();\r\n\t\t//箭头\r\n\t\tcontext.beginPath();\r\n\t\tcontext.moveTo(width/2, height/2-size/2);\r\n\t\tcontext.lineTo(width/2-10, height/2-size/2+10);\r\n\t\tcontext.closePath();\r\n\t\tcontext.stroke();\r\n\t\tcontext.beginPath();\r\n\t\tcontext.moveTo(width/2, height/2-size/2);\r\n\t\tcontext.lineTo(width/2+10, height/2-size/2+10);\r\n\t\tcontext.closePath();\r\n\t\tcontext.stroke();\r\n\t\t//刻度\r\n\t\tthis.drawAxisTicks(context);\r\n\t}\r\n\r\n\t/**\r\n     * 绘制刻度\r\n     */\r\n    drawAxisTicks(context) {\r\n\t\tthis.themultiple();\r\n\t\tvar num = size/2*0.9 / this.panel.tickSpace;\r\n\t\tlet lastSpace =(num-Math.floor(num))*this.panel.tickSpace;//最后一个间隔距离\r\n\t\tvar tick = this.panel.tickSpace/multi;\r\n\t\tcontext.strokeStyle = this.panel.tickColour\r\n        context.fillStyle = this.panel.axis.textColor;\r\n\t\t\r\n        for (var i = 1; i < num+1; i++) {\r\n\t\t\tif(i==Math.floor(num)) continue;\r\n\t\t\t// 正向X轴\r\n\t\t\tcontext.beginPath();\r\n\t\t\tlet bool = i==Math.floor(num+1);\r\n\t\t\tvar x = width/2 + i * this.panel.tickSpace;\r\n\t\t\tif(bool) {\r\n\t\t\t\tx = width/2 + (i-1) * this.panel.tickSpace + lastSpace;\r\n\t\t\t}\r\n            context.moveTo(x, height/2);\r\n            context.lineTo(x, height/2 - 6);\r\n            context.fillText((bool?max:(tick*i).toFixed(1)), x - 2.5, height/2 - 6 - 10);\r\n\t\t\tcontext.stroke();\r\n\t\t\t// 负向X轴\r\n\t\t\tcontext.beginPath();\r\n\t\t\tvar x = width/2 - i * this.panel.tickSpace;\r\n\t\t\tif(bool) {\r\n\t\t\t\tx = width/2 - ((i-1) * this.panel.tickSpace + lastSpace);\r\n\t\t\t}\r\n            context.moveTo(x, height/2);\r\n            context.lineTo(x, height/2 - 6);\r\n            context.fillText('-'+(bool?max:(tick*i).toFixed(1)), x - 2.5, height/2 - 6 - 10);\r\n\t\t\tcontext.stroke();\r\n\t\t\t\r\n\t\t\t// 正向Y轴\r\n            context.beginPath();\r\n\t\t\tvar y = height/2 - i * this.panel.tickSpace;\r\n\t\t\tif(bool) {\r\n\t\t\t\ty = height/2 - ((i-1) * this.panel.tickSpace + lastSpace);\r\n\t\t\t}\r\n            context.moveTo(width/2, y);\r\n            context.lineTo(width/2+6, y);\r\n            context.fillText((bool?max:(tick*i).toFixed(1)), width/2+6+10, y+2.5);\r\n\t\t\tcontext.stroke();\r\n\t\t\t// 负向Y轴\r\n\t\t\tcontext.beginPath();\r\n\t\t\tvar y = height/2 + i * this.panel.tickSpace;\r\n\t\t\tif(bool) {\r\n\t\t\t\ty = height/2 + (i-1) * this.panel.tickSpace + lastSpace;\r\n\t\t\t}\r\n            context.moveTo(width/2, y);\r\n            context.lineTo(width/2+6, y);\r\n            context.fillText('-'+(bool?max:(tick*i).toFixed(1)), width/2+6+10, y+2.5);\r\n            context.stroke();\r\n\t\t}\r\n\r\n    }\r\n\t\r\n\tcircleLine() {\r\n\t\tlet context = ctxArr[1];\r\n\t\tthis.themultiple();\r\n\t\tcontext.strokeStyle = this.panel.circleLine.color;\r\n\t\tcontext.setLineDash([20, 5]);  // [实线长度, 间隙长度]\r\n    \tcontext.lineDashOffset = -0;\r\n\t\tcontext.beginPath();\r\n\t\tcontext.arc(width/2, height/2, this.panel.circleLine.r*multi, 0, 2 * Math.PI);\r\n\t\tcontext.stroke();\r\n\t}\r\n\r\n\tdrawScatter() {\r\n\t\tvar that = this;\r\n\t\tlet context = ctxArr[2];\r\n\t\t// if (scatterDate.length==0) {\r\n\t\t// \tcontext.clearRect(0,0,width,height);\r\n\t\t// } else {\r\n\t\t\tcontext.strokeStyle = this.panel.scatter.color;\r\n\t\t\tcontext.fillStyle = this.panel.scatter.color;\r\n\t\t\tthis.themultiple();\r\n\t\t\tvar pixelArr = [];\r\n\t\t\tfor(let i=0; i< scatterDate.length; i++) {\r\n\t\t\t\tlet x = scatterDate[i][0]*multi+width / 2;\r\n\t\t\t\tlet y = scatterDate[i][1]*multi+height /2-(scatterDate[i][1]*2*multi);\r\n\t\t\t\tcontext.beginPath();\r\n\t\t\t\tcontext.arc(x, y, this.panel.scatter.r, 0, 2 * Math.PI);\r\n\t\t\t\tcontext.fill();\r\n\t\t\t\tcontext.stroke();\r\n\t\t\t\tpixelArr.push([x, y,scatterDate[i][0], scatterDate[i][1]]);\r\n\t\t\t}\r\n\t\t\t//中心点\r\n\t\t\tcontext.strokeStyle = this.panel.centerScatter.color;\r\n\t\t\tcontext.fillStyle = this.panel.centerScatter.color;\r\n\t\t\tfor(let j=0; j< centerDate.length; j++) {\r\n\t\t\t\tlet x = centerDate[j][0]*multi+width / 2;\r\n\t\t\t\tlet y = centerDate[j][1]*multi+height /2-(centerDate[j][1]*2*multi);\r\n\t\t\t\tcontext.beginPath();\r\n\t\t\t\tcontext.arc(x, y, this.panel.centerScatter.r, 0, 2 * Math.PI);\r\n\t\t\t\tcontext.fill();\r\n\t\t\t\tcontext.stroke();\r\n\t\t\t\tpixelArr.push([x, y,centerDate[j][0], centerDate[j][1]]);\r\n\t\t\t}\r\n\t\t\tcanvasArr[2].addEventListener(\"mousemove\", that.doMouseMove, false);\r\n\t\t\tcanvasArr[2].pointData = pixelArr;\r\n\t\t\tcanvasArr[2].r = this.panel.scatter.r;\r\n\t\t\tcanvasArr[2].showDetail = this.showPointDetail;\r\n\t\t// }\r\n\t\tthis.drawLine();\r\n\t}\r\n\r\n\tdrawLine() {\r\n\t\tlet context = ctxArr[3];\r\n\t\tif (centerDate.length==0) {\r\n\t\t\tcontext.clearRect(0,0,width,height);\r\n\t\t} else {\r\n\t\t\tcontext.strokeStyle = this.panel.line.lineColor;\r\n\t\t\tcontext.lineWidth = this.panel.line.lineWidth;\r\n\t\t\t//横轴\r\n\t\t\tcontext.beginPath();\r\n\t\t\tcontext.moveTo(centerDate[0][0]*multi+width/2, centerDate[0][1]*multi+height /2-(centerDate[0][1]*2*multi));\r\n\t\t\tcontext.lineTo(centerDate[1][0]*multi+width/2, centerDate[1][1]*multi+height /2-(centerDate[1][1]*2*multi));\r\n\t\t\tcontext.closePath();\r\n\t\t\tcontext.stroke();\r\n\t\t}\r\n\t}\r\n\r\n\tdoMouseMove() {\r\n        var pixelArr = this.pointData;//['x位置','y位置','x值','y值']\r\n        var bbox = this.getBoundingClientRect();\r\n        var x = (event.pageX - bbox.left) * (this.width / bbox.width);\r\n        var y = (event.pageY - bbox.top) * (this.height / bbox.height);\r\n        \r\n        var checkPoint = false;\r\n        var r = this.r;\r\n        for(var i=0; i<pixelArr.length; i++){\r\n            var xmax = pixelArr[i][0] + r;\r\n            var xmin = pixelArr[i][0] - r;\r\n            var ymax = pixelArr[i][1] + r;\r\n            var ymin = pixelArr[i][1] - r;\r\n            if( x <= xmax && x >= xmin && y <= ymax && y >= ymin){\r\n                this.showDetail(pixelArr[i][2], pixelArr[i][3], event.pageY - bbox.top, event.pageX - bbox.left);\r\n                checkPoint = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if(!checkPoint){\r\n            canvasPanel.parent().find(\".tip\").remove();\r\n        }\r\n\t}\r\n\t\r\n\tshowPointDetail(x, y, top, left){\r\n        canvasPanel.parent().find(\".tip\").remove();\r\n        var tip = $(\"<div class='tip' style='z-index:4;background-color:#4d4e52e6'> x: \" + x + \" y: \" + y + \"</div>\")\r\n        tip.css({\r\n            'top' : top-17 + 'px',\r\n            'left': left+8 + 'px'\r\n        });\r\n        tip.appendTo(canvasPanel.parent());\r\n    }\r\n\r\n\r\n\r\n\tthemultiple() {\r\n\t\t//取最大值\r\n\t\tvar arrayNum =scatterDate.join(\",\").split(\",\");\r\n\t\tmax = arrayNum.reduce(function(a , b){ \r\n\t\t\treturn Math.abs(b-0) > Math.abs(a-0) ? Math.abs(b-0) : Math.abs(a-0); \r\n\t\t\t});\r\n\t\tif(this.panel.circleLine.r && this.panel.circleLine.r>max) {\r\n\t\t\tmax = this.panel.circleLine.r;\r\n\t\t}\r\n\t\tif(this.panel.theMaxValue && this.panel.theMaxValue>0) {\r\n\t\t\tmax = this.panel.theMaxValue;\r\n\t\t}\r\n\t\tmulti =size/2*0.9/max;//缩放倍数\r\n\t}\r\n\r\n\tlink(scope, elem, attrs, ctrl) {\r\n\t\tctrl.events.on('render', function () {\r\n\t\t\tconst $panelContainer = elem.find('.panel-container');\r\n\t\t\tif (ctrl.panel.bgColor) {\r\n\t\t\t\t$panelContainer.css('background-color', ctrl.panel.bgColor);\r\n\t\t\t} else {\r\n\t\t\t\t$panelContainer.css('background-color', '');\r\n\t\t\t}\r\n\t\t\tcanvasPanel = elem.find('.canvas-panel');\r\n\t\t\tctrl.initChart(canvasPanel, ctrl.height);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nPolScatPanelCtrl.templateUrl = 'module.html';"]}